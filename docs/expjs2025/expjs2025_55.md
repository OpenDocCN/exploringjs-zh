# 46 æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegExpï¼‰

> åŸæ–‡ï¼š[`exploringjs.com/js/book/ch_regexps.html`](https://exploringjs.com/js/book/ch_regexps.html)

1.  46.1 åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼

    1.  46.1.1 å­—é¢é‡ä¸æ„é€ å‡½æ•°

    1.  46.1.2 å°è´´å£«ï¼šä½¿ç”¨ `String.raw` å­—é¢é‡ä¸ `new RegExp()`

    1.  46.1.3 å…‹éš†å’Œä¸å¯ç ´ååœ°ä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼

1.  46.2 è¯­æ³•å­—ç¬¦å’Œè½¬ä¹‰

    1.  46.2.1 è¯­æ³•å­—ç¬¦

    1.  46.2.2 éæ³•é¡¶å±‚è½¬ä¹‰

    1.  [46.2.3 å­—ç¬¦ç±»å†…éƒ¨è½¬ä¹‰ (`[Â·Â·Â·]`)](#escaping-inside-character-classes)

1.  46.3 æ­£åˆ™è¡¨è¾¾å¼ï¼šå­—ç¬¦çš„æ¦‚å¿µ

1.  46.4 è¯­æ³•ï¼šåŒ¹é…å•ä¸ªå­—ç¬¦

1.  46.5 è¯­æ³•ï¼šå­—ç¬¦ç±»è½¬ä¹‰

    1.  46.5.1 åŸºæœ¬å­—ç¬¦ç±»è½¬ä¹‰ï¼ˆä»£ç å•å…ƒé›†åˆï¼‰ï¼š`\d \D \s \S \w \W`

    1.  46.5.2 Unicode å±æ€§è½¬ä¹‰ï¼š`\p{}` å’Œ `\P{}`

    1.  46.5.3 Unicode å­—ç¬¦å±æ€§è½¬ä¹‰ ^(ES2018)

    1.  46.5.4 Unicode å­—ç¬¦ä¸²å±æ€§è½¬ä¹‰ ^(ES2024)

1.  46.6 è¯­æ³•ï¼šå­—ç¬¦ç±»

    1.  46.6.1 å­—ç¬¦ç±»ä¸­çš„ç ç‚¹åºåˆ— ^(ES2024)

    1.  46.6.2 å­—ç¬¦ç±»é›†åˆæ“ä½œ ^(ES2024)

1.  46.7 è¯­æ³•ï¼šæ•è·ç»„

1.  46.8 è¯­æ³•ï¼šé‡è¯

1.  46.9 è¯­æ³•ï¼šæ–­è¨€

    1.  46.9.1 å‰ç»æ–­è¨€

    1.  46.9.2 åç»æ–­è¨€ ^(ES2018)

1.  46.10 è¯­æ³•ï¼šæå–ï¼ˆ`|`ï¼‰

1.  46.11 æ­£åˆ™è¡¨è¾¾å¼æ ‡å¿—

    1.  46.11.1 å¦‚ä½•æ’åºæ­£åˆ™è¡¨è¾¾å¼æ ‡å¿—ï¼Ÿ

    1.  46.11.2 æ²¡æœ‰ Unicode æ ‡å¿— `/u` å’Œ `/v`ï¼šå­—ç¬¦æ˜¯ UTF-16 ç å•å…ƒ

    1.  46.11.3 æ ‡å¿— `/u`ï¼šå­—ç¬¦æ˜¯ç ç‚¹ ^(ES6)

    1.  46.11.4 æ ‡å¿— `/v`ï¼šå¯¹å¤šç ç‚¹å›¾å½¢ç°‡çš„æœ‰é™æ”¯æŒ ^(ES2024)

1.  46.12 æ¨¡å¼ä¿®é¥°ç¬¦ï¼ˆå†…è”æ ‡å¿—ï¼‰^(ES2025)

    1.  46.12.1 æ¨¡å¼ä¿®é¥°ç¬¦çš„è¯­æ³•

    1.  46.12.2 å“ªäº›æ ‡å¿—è¢«æ”¯æŒï¼Ÿ

    1.  46.12.3 ä½¿ç”¨æ¡ˆä¾‹ï¼šæ”¹å˜æ­£åˆ™è¡¨è¾¾å¼éƒ¨åˆ†æ ‡å¿—

    1.  46.12.4 ä½¿ç”¨æ¡ˆä¾‹ï¼šå†…è”æ ‡å¿—

    1.  46.12.5 ä½¿ç”¨æ¡ˆä¾‹ï¼šæ”¹å˜æ ‡å¿—çš„æ­£åˆ™è¡¨è¾¾å¼ç‰‡æ®µ

1.  46.13 æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡å±æ€§

    1.  46.13.1â€ƒå±æ€§ä½œä¸ºå±æ€§

    1.  46.13.2â€ƒå…¶ä»–å±æ€§

1.  46.14â€ƒåŒ¹é…å¯¹è±¡

    1.  46.14.1â€ƒåŒ¹é…å¯¹è±¡ä¸­çš„ç´¢å¼•^(ES2022)

1.  46.15â€ƒå¤„ç†æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹æ³•

    1.  46.15.1â€ƒé»˜è®¤æƒ…å†µä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼åœ¨å­—ç¬¦ä¸²çš„ä»»ä½•ä½ç½®è¿›è¡ŒåŒ¹é…

    1.  46.15.2â€ƒ`string.match(regExp)` ä¸å¸¦ `/g`ï¼šè·å–ç¬¬ä¸€ä¸ªåŒ¹é…çš„åŒ¹é…å¯¹è±¡

    1.  46.15.3â€ƒ`string.match(regExp)` å¸¦æœ‰ `/g`ï¼šè·å–æ‰€æœ‰ç»„ 0 æ•è·^(ES3)

    1.  46.15.4â€ƒ`string.matchAll(regExp)`ï¼šè·å–æ‰€æœ‰åŒ¹é…å¯¹è±¡çš„è¿­ä»£å™¨^(ES2020)

    1.  46.15.5â€ƒ`regExp.exec(str)`ï¼šæ•è·ç»„^(ES3)

    1.  46.15.6â€ƒ`string.match()` ä¸ `string.matchAll()` ä¸ `regExp.exec()`

    1.  46.15.7â€ƒä½¿ç”¨ `string.replace()` å’Œ `string.replaceAll()` è¿›è¡Œæ›¿æ¢

    1.  46.15.8â€ƒ`regExp.test(str)`ï¼šæ˜¯å¦æœ‰åŒ¹é…ï¼Ÿ^(ES3)

    1.  46.15.9â€ƒ`string.search(regExp)`ï¼šåŒ¹é…åœ¨ä»€ä¹ˆç´¢å¼•å¤„ï¼Ÿ^(ES3)

    1.  46.15.10â€ƒ`string.split(separator, limit?)`ï¼šåˆ†å‰²å­—ç¬¦ä¸²^(ES3)

1.  46.16â€ƒæ ‡å¿— `/g` å’Œ `/y`ï¼Œä»¥åŠå±æ€§ `.lastIndex`ï¼ˆé«˜çº§ï¼‰

    1.  46.16.1â€ƒæ ‡å¿— `/g` å’Œ `/y`

    1.  46.16.2â€ƒ`/g` å’Œ `/y` å¦‚ä½•å½±å“æ–¹æ³•ï¼Ÿ

    1.  46.16.3â€ƒ`/g` å’Œ `/y` çš„å››ä¸ªé™·é˜±ä»¥åŠå¦‚ä½•å¤„ç†å®ƒä»¬

    1.  46.16.4â€ƒ`.lastIndex` çš„ç”¨æ³•ï¼šä»æŒ‡å®šç´¢å¼•å¼€å§‹åŒ¹é…

    1.  46.16.5â€ƒ`.lastIndex` çš„ç¼ºç‚¹å’Œä¼˜ç‚¹

1.  46.17â€ƒ`RegExp.escape()`ï¼šè½¬ä¹‰æ–‡æœ¬ä»¥ä¾¿åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨^(ES2025)

    1.  46.17.1â€ƒ`RegExp.escape()` çš„ç”¨æ³•ï¼šæ›¿æ¢æ‰€æœ‰æ–‡æœ¬å‡ºç°

    1.  46.17.2â€ƒ`RegExp.escape()` çš„ç”¨æ³•ï¼šæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†å¿…é¡»åŒ¹é…ç»™å®šçš„æ–‡æœ¬

1.  46.18â€ƒåŒ¹é…æ‰€æœ‰å†…å®¹æˆ–æ— å†…å®¹

1.  46.19â€ƒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æŠ€å·§

    1.  46.19.1â€ƒæŠ€å·§ï¼šä½¿ç”¨æ ‡å¿— `/v`

    1.  46.19.2â€ƒæŠ€å·§ï¼šæŒ‰å­—æ¯é¡ºåºæ’åˆ—æ ‡å¿—

    1.  46.19.3â€ƒæŠ€å·§ï¼šä½¿ç”¨å‘½åæ•è·ç»„

    1.  46.19.4â€ƒæŠ€å·§ï¼šé€šè¿‡ `#` ä½¿ç”¨ä¸é‡è¦çš„ç©ºç™½å’Œè¡Œæ³¨é‡Š

    1.  46.19.5â€ƒæŠ€å·§ï¼šä¸ºä½ çš„æ­£åˆ™è¡¨è¾¾å¼ç¼–å†™æµ‹è¯•

    1.  46.19.6 æç¤ºï¼šåœ¨æ‚¨çš„æ–‡æ¡£ä¸­æåŠç¤ºä¾‹

    1.  46.19.7 å¥–åŠ±æç¤ºï¼šä½¿ç”¨æ’å€¼æ¥é‡ç”¨æ¨¡å¼

    1.  46.19.8 å¥–åŠ±æç¤ºï¼šæ— éœ€åº“çš„æ— æ„ä¹‰ç©ºç™½

    1.  46.19.9 ç»“è®ºï¼šè¿™å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼åº”è¯¥è¢«ç¼–å†™çš„æ–¹å¼

1.  46.20 å¿«é€Ÿå‚è€ƒï¼šæ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½

    1.  46.20.1 æ‘˜è¦ï¼š`.global` (`/g`) å’Œ `.sticky` (`/y`)

    1.  46.20.2 `String.prototype.*`: åŒ¹é…å’Œæœç´¢

    1.  46.20.3 `String.prototype.*`: åˆ†å‰²å’Œæ›¿æ¢

    1.  46.20.4 `RegExp.prototype.*`

![å›¾æ ‡â€œé˜…è¯»â€](img/0fb62b2fc33a72829ae9fb174dedd0d2.png) **åŠŸèƒ½å¯ç”¨æ€§**

é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½è‡ª ES3 ä»¥æ¥éƒ½å¯ç”¨ã€‚

### 46.1 åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼

#### 46.1.1 å­—é¢é‡ä¸æ„é€ å‡½æ•°

åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼çš„ä¸¤ç§ä¸»è¦æ–¹å¼æ˜¯ï¼š

+   å­—é¢é‡ï¼šåœ¨åŠ è½½æ—¶é™æ€ç¼–è¯‘ã€‚

    ```js
    /abc/iv

    ```

+   æ„é€ å‡½æ•°ï¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€ç¼–è¯‘ã€‚

    ```js
    new RegExp('abc', 'iv')

    ```

ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼éƒ½æœ‰ç›¸åŒçš„ä¸¤ä¸ªéƒ¨åˆ†ï¼š

+   *ä¸»ä½“* `abc`â€”â€”å®é™…çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚

+   *æ ‡å¿—* `i` å’Œ `v`ã€‚æ ‡å¿—é…ç½®äº†æ¨¡å¼æ˜¯å¦‚ä½•è¢«è§£é‡Šçš„ã€‚ä¾‹å¦‚ï¼Œ`i` å¯ç”¨ä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…ã€‚å¯ç”¨çš„æ ‡å¿—åˆ—è¡¨å°†åœ¨æœ¬ç« åé¢ç»™å‡º æ­£åˆ™è¡¨è¾¾å¼æ ‡å¿—ã€‚

![å›¾æ ‡â€œæç¤ºâ€](img/8440b17bb8219cda9f9405ac83c36db0.png) **æ¨èï¼šæ ‡å¿— `/v` ^ï¼ˆES2024ï¼‰**

æ ‡å¿— `/v` å¯ç”¨é‡è¦åŠŸèƒ½ï¼Œå¹¶æ¨èç”¨äºæ‰€æœ‰æ­£åˆ™è¡¨è¾¾å¼ã€‚

#### 46.1.2 æç¤ºï¼šä½¿ç”¨ `String.raw` å­—é¢é‡ä¸ `new RegExp()`

å¦‚æœæˆ‘ä»¬å°†æ™®é€šå­—ç¬¦ä¸²å­—é¢é‡ä½œä¸º `new RegExp()` çš„å‚æ•°ï¼Œåˆ™æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼åæ–œæ éƒ½å¿…é¡»è½¬ä¹‰ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ String.raw ä½œä¸ºæ¨¡æ¿æ ‡ç­¾ï¼Œåˆ™ä¸éœ€è¦è¿™æ ·åšã€‚ä»¥ä¸‹ä¸‰ä¸ªæ­£åˆ™è¡¨è¾¾å¼éƒ½æ˜¯ç­‰æ•ˆçš„ï¼š

```js
> /^\*$/.test('*')
true
> new RegExp('^\\*$', 'v').test('*')
true
> new RegExp(String.raw`^\*$`, 'v').test('*')
true

```

å¦‚æœæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ `String.raw`ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç¼©å†™ï¼š

```js
// â€œImportâ€ from namespace `String`
const {raw} = String;

const regExp = new RegExp(raw`^\*$`, 'v');

```

#### 46.1.3 å…‹éš†å’Œä¸å¯ç ´ååœ°ä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼

`RegExp()` æ„é€ å‡½æ•°æœ‰ä¸¤ç§å˜ä½“ï¼š

+   `new RegExp(pattern : string, flags = '')` ^ï¼ˆES3ï¼‰

    æ ¹æ®é€šè¿‡ `pattern` æŒ‡å®šåˆ›å»ºä¸€ä¸ªæ–°çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å¦‚æœ `flags` ç¼ºå¤±ï¼Œåˆ™ä½¿ç”¨ç©ºå­—ç¬¦ä¸² `''`ã€‚

+   `new RegExp(regExp : RegExp, flags = regExp.flags)` ^ï¼ˆES6ï¼‰

    `regExp` è¢«å…‹éš†ã€‚å¦‚æœæä¾›äº† `flags`ï¼Œåˆ™å®ƒç¡®å®šå…‹éš†çš„æ ‡å¿—ã€‚

ç¬¬äºŒç§å˜ä½“åœ¨å…‹éš†æ­£åˆ™è¡¨è¾¾å¼æ—¶å¾ˆæœ‰ç”¨ï¼Œå¯é€‰åœ°åŒæ—¶ä¿®æ”¹å®ƒä»¬ã€‚æ ‡å¿—æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ˜¯æ›´æ”¹å®ƒä»¬çš„å”¯ä¸€æ–¹æ³•â€”â€”ä¾‹å¦‚ï¼š

```js
function copyAndAddFlags(regExp, flagsToAdd='') {
  // The constructor doesnâ€™t allow duplicate flags;
  // make sure there arenâ€™t any:
  const newFlags = Array.from(
    new Set(regExp.flags + flagsToAdd)
  ).join('');
  return new RegExp(regExp, newFlags);
}
assert.equal(/abc/i.flags, 'i');
assert.equal(copyAndAddFlags(/abc/i, 'g').flags, 'gi');

```

`new Set()`éå†å…¶å‚æ•°ï¼Œè¿™æ„å‘³ç€å­—ç¬¦ä¸²è¢«åˆ†å‰²æˆç ç‚¹ã€‚è¿™äº›ç ç‚¹æˆä¸º Set å…ƒç´ ï¼Œä»è€Œæ¶ˆé™¤äº†é‡å¤ã€‚åœ¨æˆ‘ä»¬èƒ½å¤Ÿå°†å®ƒä»¬è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å°†å®ƒä»¬è½¬æ¢æˆä¸€ä¸ªæ•°ç»„ï¼Œå¹¶é€šè¿‡`Array.from()`æ¥å®ç°ã€‚

### 46.2â€ƒè¯­æ³•å­—ç¬¦å’Œè½¬ä¹‰

#### 46.2.1â€ƒè¯­æ³•å­—ç¬¦

åœ¨æ­£åˆ™è¡¨è¾¾å¼çš„é¡¶çº§ï¼Œä»¥ä¸‹[*è¯­æ³•å­—ç¬¦*](https://tc39.es/ecma262/#prod-SyntaxCharacter)æ˜¯ç‰¹æ®Šçš„ã€‚å®ƒä»¬é€šè¿‡åœ¨å‰é¢åŠ åæ–œæ ï¼ˆ`\`ï¼‰æ¥è½¬ä¹‰ã€‚

```js
^ $ \ . * + ? ( ) [ ] { } |

```

è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

```js
> /\*/v.test('*')
true

```

åœ¨æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è½¬ä¹‰æ–œæ ï¼š

```js
> /\//v.test('/')
true

```

åœ¨`new RegExp()`çš„å‚æ•°ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦è½¬ä¹‰æ–œæ ï¼š

```js
> new RegExp('/', 'v').test('/')
true

```

#### 46.2.2â€ƒéæ³•é¡¶çº§è½¬ä¹‰

ä½¿ç”¨ Unicode æ ‡å¿—ï¼ˆ`/u`æˆ–`/v`ï¼‰ï¼Œåœ¨é¡¶çº§è½¬ä¹‰éè¯­æ³•å­—ç¬¦æ˜¯ä¸€ä¸ªè¯­æ³•é”™è¯¯ã€‚è¿™å…è®¸ä½¿ç”¨åƒ`\p{Â·Â·Â·}`è¿™æ ·çš„è¯­æ³•ã€‚

```js
assert.throws(
  () => eval(String.raw`/\a/v`),
  {
    name: 'SyntaxError',
    message: 'Invalid regular expression: /\\a/v: Invalid escape',
  }
);
assert.throws(
  () => eval(String.raw`/\-/v`),
  {
    name: 'SyntaxError',
    message: 'Invalid regular expression: /\\-/v: Invalid escape',
  }
);

```

æ²¡æœ‰æ ‡å¿—`/u`å’Œ`/v`ï¼Œé¡¶çº§è½¬ä¹‰çš„éè¯­æ³•å­—ç¬¦åŒ¹é…è‡ªèº«ï¼š

```js
> /\a/.test('a')
true

```

#### [46.2.3â€ƒåœ¨å­—ç¬¦ç±»å†…éƒ¨è½¬ä¹‰(`[Â·Â·Â·]`)](#escaping-inside-character-classes)

å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ¨èçš„æ ‡å¿—`/v`ï¼Œåˆ™å­—ç¬¦ç±»å†…éƒ¨è½¬ä¹‰çš„è§„åˆ™æ˜¯ä¸åŒçš„ã€‚æˆ‘ä»¬åœ¨æŸ¥çœ‹æ²¡æœ‰ Unicode æ ‡å¿—ï¼ˆæ—¢ä¸æ˜¯`/u`ä¹Ÿä¸æ˜¯`/v`ï¼‰çš„æ­£åˆ™è¡¨è¾¾å¼è§„åˆ™ä¹‹å‰ï¼Œå…ˆæŸ¥çœ‹è¿™äº›è§„åˆ™ã€‚

##### 46.2.3.1â€ƒåœ¨å­—ç¬¦ç±»å†…éƒ¨è½¬ä¹‰ï¼šæ ‡å¿—`/v`

ä»¥ä¸‹å­—ç¬¦å¯ä»¥é€šè¿‡åæ–œæ è½¬ä¹‰ï¼š

+   [*è¯­æ³•å­—ç¬¦*](https://tc39.es/ecma262/#prod-SyntaxCharacter):

    ```js
    ^ $ \ . * + ? ( ) [ ] { } |

    ```

+   æ–œæ ï¼š

    ```js
    /

    ```

+   [*ç±»é›†ä¿ç•™åŒæ ‡ç‚¹ç¬¦å·*](https://tc39.es/ecma262/#prod-ClassSetReservedDoublePunctuator):

    ```js
    & - ! # % , : ; < = > @ ` ~

    ```

æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸æ€»æ˜¯éœ€è¦è½¬ä¹‰è¿™äº›å­—ç¬¦ã€‚åªæœ‰ä»¥ä¸‹å­—ç¬¦åºåˆ—ä¸åŒ¹é…è‡ªèº«å¹¶ä¸”å¿…é¡»è½¬ä¹‰ï¼š

+   å•ä¸ª`^`åªæœ‰åœ¨å®ƒæ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦æ—¶æ‰éœ€è¦è½¬ä¹‰ã€‚

+   [*ç±»é›†è¯­æ³•å­—ç¬¦*](https://tc39.es/ecma262/#prod-ClassSetSyntaxCharacter)å¿…é¡»å§‹ç»ˆè½¬ä¹‰ï¼š

    ```js
    ( ) [ ] { } / - \ |

    ```

+   [*ç±»é›†ä¿ç•™åŒæ ‡ç‚¹ç¬¦å·*](https://tc39.es/ecma262/#prod-ClassSetReservedDoublePunctuator)å¿…é¡»å§‹ç»ˆè½¬ä¹‰ï¼ˆè‡³å°‘æœ‰ä¸€ä¸ªï¼‰ï¼š

    ```js
    && !! ## $$ %% ** ++ ,, .. :: ;; << == >> ?? @@ ^^ `` ~~

    ```

##### 46.2.3.2â€ƒåœ¨å­—ç¬¦ç±»å†…éƒ¨è½¬ä¹‰ï¼šæ²¡æœ‰ Unicode æ ‡å¿—ï¼ˆæ—¢ä¸æ˜¯`/u`ä¹Ÿä¸æ˜¯`/v`ï¼‰

+   æˆ‘ä»¬æ€»æ˜¯å¿…é¡»è½¬ä¹‰ï¼š`\]`

+   ä¸€äº›å­—ç¬¦åªåœ¨æŸäº›ä½ç½®éœ€è¦è½¬ä¹‰ï¼š

    +   `^`åªæœ‰åœ¨å®ƒæ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦æ—¶æ‰éœ€è¦è½¬ä¹‰ã€‚

    +   `-`åªæœ‰åœ¨å®ƒä¸æ˜¯ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå­—ç¬¦æ—¶æ‰éœ€è¦è½¬ä¹‰ã€‚

### 46.3â€ƒæ­£åˆ™è¡¨è¾¾å¼ï¼šå­—ç¬¦çš„æ¦‚å¿µ

åœ¨æ­£åˆ™è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œâ€œå­—ç¬¦â€æ„å‘³ç€â€œæ–‡æœ¬çš„åŸå­å•ä½â€ï¼š

+   æ²¡æœ‰ Unicode æ ‡å¿—ï¼ˆ`/u`å’Œ`/v`ï¼‰ï¼Œä¸€ä¸ªå­—ç¬¦æ˜¯ JavaScript å­—ç¬¦ï¼ˆä¸€ä¸ª UTF-16 ä»£ç å•å…ƒï¼‰ã€‚

+   ä½¿ç”¨ Unicode æ ‡å¿—ï¼Œä¸€ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªç ç‚¹ã€‚

ä¾‹å¦‚ï¼Œä¸€ä¸ªç‚¹ï¼ˆ`.`ï¼‰åŒ¹é…å•ä¸ªå­—ç¬¦ï¼š

```js
> 'ğŸ™‚'.match(/./g) // code point with 2 code units
[ '\uD83D', '\uDE42' ]
> 'ğŸ™‚'.match(/./gv)
[ 'ğŸ™‚' ]

```

### 46.4â€ƒè¯­æ³•ï¼šåŒ¹é…å•ä¸ªå­—ç¬¦

è¿™äº›æ„é€ åŒ¹é…å•ä¸ªå­—ç¬¦ï¼š

+   *æ¨¡å¼å­—ç¬¦* æ˜¯æ‰€æœ‰å­—ç¬¦ *é™¤äº†* è¯­æ³•å­—ç¬¦ï¼ˆ`^`ã€`$` ç­‰ï¼‰ã€‚æ¨¡å¼å­—ç¬¦åŒ¹é…è‡ªèº«ã€‚ä¾‹å¦‚ï¼š`A b % -`

+   `.` åŒ¹é…ä»»ä½•å­—ç¬¦ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ æ ‡å¿— `/s` (`dotAll`) æ¥æ§åˆ¶ç‚¹æ˜¯å¦åŒ¹é…è¡Œç»ˆæ­¢ç¬¦ã€‚

+   *å­—ç¬¦è½¬ä¹‰*ï¼ˆæ¯ä¸ªè½¬ä¹‰åŒ¹é…ä¸€ä¸ªå›ºå®šçš„å­—ç¬¦ï¼‰ï¼š

    +   æ§åˆ¶è½¬ä¹‰ï¼ˆç”¨äºä¸€äº›æ§åˆ¶å­—ç¬¦ï¼‰ï¼š

        +   `\f`: åˆ†é¡µ (FF)

        +   `\n`: æ¢è¡Œ (LF)

        +   `\r`: å›è½¦ (CR)

        +   `\t`: åˆ¶è¡¨ç¬¦

        +   `\v`: æ¢è¡Œåˆ¶è¡¨ç¬¦

    +   æ§åˆ¶å­—ç¬¦ï¼š`\cA` (Ctrl-A), â€¦, `\cZ` (Ctrl-Z)

    +   åå…­è¿›åˆ¶è½¬ä¹‰ï¼ˆå‰ 256 ä¸ª Unicode ä»£ç ç‚¹ï¼‰ï¼š`\x20` (ç©ºæ ¼)

    +   Unicode ä»£ç å•å…ƒè½¬ä¹‰ï¼š`\u00E4` (Ã¤)

    +   Unicode ä»£ç ç‚¹è½¬ä¹‰ï¼ˆéœ€è¦ Unicode æ ‡å¿— `/u` æˆ– `/v`ï¼‰ï¼š`\u{1F642}` (ğŸ™‚)

    +   æ ‡è¯†ç¬¦è½¬ä¹‰åŒ¹é…è½¬ä¹‰å­—ç¬¦ï¼ˆè¿™äº›æ˜¯å¸¦æœ‰ Unicode æ ‡å¿— `/u` æˆ– `/v` çš„è§„åˆ™ï¼›æ²¡æœ‰å®ƒä»¬ï¼Œå¤§å¤šæ•°å­—ç¬¦éƒ½å¯ä»¥è¿›è¡Œæ ‡è¯†ç¬¦è½¬ä¹‰ï¼‰ï¼š

        +   æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å®ƒä»¬å‰é¢åŠ ä¸Šåæ–œæ æ¥è½¬ä¹‰ä»¥ä¸‹ [è¯­æ³•å­—ç¬¦](https://tc39.es/ecma262/#prod-SyntaxCharacter)ï¼š

            ```js
            ^ $ \ . * + ? ( ) [ ] { } |

            ```

        +   æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·è½¬ä¹‰æ–œæ ï¼š`\/`

### 46.5â€ƒè¯­æ³•ï¼šå­—ç¬¦ç±»è½¬ä¹‰

å­—ç¬¦ç±»è½¬ä¹‰åŒ¹é…ä»£ç å•å…ƒé›†åˆã€ä»£ç ç‚¹é›†åˆæˆ–ä»£ç ç‚¹åºåˆ—é›†åˆã€‚

#### 46.5.1â€ƒåŸºæœ¬å­—ç¬¦ç±»è½¬ä¹‰ï¼ˆä»£ç å•å…ƒé›†åˆï¼‰ï¼š`\d \D \s \S \w \W`

ä»¥ä¸‹å­—ç¬¦ç±»è½¬ä¹‰åŠå…¶è¡¥é›†å§‹ç»ˆå—æ”¯æŒï¼š

|  | è½¬ä¹‰ | ç­‰ä»· | è¡¥é›† |
| --- | --- | --- | --- |
| æ•°å­— | `\d` | `[0-9]` | `\D` |
| â€œå•è¯â€å­—ç¬¦ | `\w` | `[a-zA-Z0-9_]` | `\W` |
| ç©ºç™½å­—ç¬¦ | `\s` |  | `\S` |

æ³¨æ„ï¼š

+   ç©ºç™½å­—ç¬¦ï¼š`\s` åŒ¹é…æ‰€æœ‰ç©ºç™½ä»£ç ç‚¹ï¼šç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€è¡Œç»ˆæ­¢ç¬¦ç­‰ã€‚å®ƒä»¬éƒ½é€‚åˆå•ä¸ª UTF-16 ä»£ç å•å…ƒã€‚

+   â€œå•è¯â€å­—ç¬¦ä¸ç¼–ç¨‹è¯­è¨€ä¸­çš„æ ‡è¯†ç¬¦ç›¸å…³ã€‚

ç¤ºä¾‹ï¼š

```js
> 'a7x4'.match(/\d/g)
[ '7', '4' ]
> 'a7x4'.match(/\D/g)
[ 'a', 'x' ]
> 'high - low'.match(/\w+/g)
[ 'high', 'low' ]
> 'hello\t\n everyone'.replaceAll(/\s/g, '-')
'hello---everyone'

```

#### 46.5.2â€ƒUnicode å±æ€§è½¬ä¹‰ï¼š`\p{}` å’Œ `\P{}`

Unicode å±æ€§è½¬ä¹‰çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

+   æ­£è½¬ä¹‰ï¼š`\p{UP}` åŒ¹é…å…·æœ‰ Unicode å±æ€§ `UP` çš„ Unicode å­—ç¬¦æˆ– Unicode å­—ç¬¦ä¸²ã€‚

+   è´Ÿè½¬ä¹‰ï¼š`\P{UP}` åŒ¹é…æ²¡æœ‰ Unicode å±æ€§ `UP` çš„ Unicode å­—ç¬¦ã€‚

æœ‰ä¸¤ç§ Unicode å±æ€§ï¼š

+   *Unicode å­—ç¬¦å±æ€§* æ˜¯ä»£ç ç‚¹çš„å±æ€§ã€‚å®ƒä»¬æŒ‡å®šäº†ä¸€ç»„ä»£ç ç‚¹ã€‚

    +   ç¤ºä¾‹ï¼š`White_Space`

    +   ç”±æ ‡å¿— `/u` å’Œæ ‡å¿— `/v` æ”¯æŒ

    +   åœ¨ ES2018 ä¸­å¼•å…¥

+   *Unicode å­—ç¬¦ä¸²å±æ€§* æ˜¯ä¸€ç³»åˆ—ä»£ç ç‚¹çš„å±æ€§ã€‚å®ƒä»¬æŒ‡å®šäº†ä¸€ç»„ä»£ç ç‚¹å­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²å±æ€§è½¬ä¹‰åªèƒ½ä¸ºæ­£ã€‚

    +   ç¤ºä¾‹ï¼š`RGI_Emoji`

    +   ä»…ç”±æ ‡å¿— `/v` æ”¯æŒ

    +   åœ¨ ES2024 ä¸­å¼•å…¥

åœ¨æˆ‘ä»¬æ›´è¯¦ç»†åœ°æŸ¥çœ‹æ‰€æœ‰å†…å®¹ä¹‹å‰ï¼Œå…ˆå¿«é€Ÿçœ‹ä¸€ä¸‹ç¤ºä¾‹ã€‚è¿™æ˜¯å¦‚ä½•è½¬ä¹‰ Unicode å­—ç¬¦å±æ€§ `White_Space` çš„ï¼š

```js
// Match all code points that are whitespace
assert.deepEqual(
  'a\tb c'.match(/\p{White_Space}/gv),
  ['\t', ' ']
);

// Match all code points that are not whitespace
assert.deepEqual(
  'a\tb c'.match(/\P{White_Space}/gv),
  ['a', 'b', 'c']
);

```

#### 46.5.3â€ƒUnicode å­—ç¬¦å±æ€§è½¬ä¹‰ (ES2018)

ä½¿ç”¨æ ‡å¿— `/u` æˆ–æ ‡å¿— `/v`ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `\p{}` å’Œ `\P{}` é€šè¿‡ *Unicode å­—ç¬¦å±æ€§* æŒ‡å®šä»£ç ç‚¹é›†ï¼ˆæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€å°èŠ‚ä¸­äº†è§£æ›´å¤šå…³äºè¿™äº›å†…å®¹ï¼‰ã€‚è¿™çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š

1.  `\p{prop=value}`: åŒ¹é…æ‰€æœ‰å…¶ Unicode å­—ç¬¦å±æ€§ `prop` çš„å€¼ä¸º `value` çš„å­—ç¬¦ã€‚

1.  `\P{prop=value}`: åŒ¹é…æ‰€æœ‰æ²¡æœ‰ Unicode å­—ç¬¦å±æ€§ `prop` çš„å€¼ä¸º `value` çš„å­—ç¬¦ã€‚

1.  `\P{bin_prop}`: åŒ¹é…æ‰€æœ‰å…¶äºŒè¿›åˆ¶ Unicode å­—ç¬¦å±æ€§ `bin_prop` ä¸º True çš„å­—ç¬¦ã€‚

1.  `\P{bin_prop}`: åŒ¹é…æ‰€æœ‰å…¶äºŒè¿›åˆ¶ Unicode å­—ç¬¦å±æ€§ `bin_prop` ä¸º False çš„å­—ç¬¦ã€‚

æ³¨é‡Šï¼š

+   å½¢å¼ (3) å’Œ (4) å¯ä»¥ç”¨ä½œç¼©å†™ï¼Œå¦‚æœå±æ€§æ˜¯ `General_Category`ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸¤ä¸ªè½¬ä¹‰æ˜¯ç­‰ä»·çš„ï¼š

    ```js
    \p{Uppercase_Letter}
    \p{General_Category=Uppercase_Letter}

    ```

+   æ²¡æœ‰æ ‡å¿— `/u` å’Œ `/v`ï¼Œ`\p` ä¸ `p` ç›¸åŒã€‚

ç¤ºä¾‹ï¼š

+   æ£€æŸ¥ç©ºç™½å­—ç¬¦ï¼š

    ```js
    > /^\p{White_Space}+$/v.test('\t \n\r')
    true

    ```

+   æ£€æŸ¥å¸Œè…Šå­—æ¯ï¼š

    ```js
    > /^\p{Script=Greek}+$/v.test('Î¼ÎµÏ„Î¬')
    true

    ```

+   åˆ é™¤ä»»ä½•å­—æ¯ï¼š

    ```js
    > '1Ï€2Ã¼3Ã©4'.replace(/\p{Letter}/gv, '')
    '1234'

    ```

+   åˆ é™¤å°å†™å­—æ¯ï¼š

    ```js
    > 'AbCdEf'.replace(/\p{Lowercase_Letter}/gv, '')
    'ACE'

    ```

##### 46.5.3.1â€ƒUnicode å­—ç¬¦å±æ€§

åœ¨ Unicode æ ‡å‡†ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½æœ‰ *å±æ€§* â€“ æè¿°å®ƒçš„å…ƒæ•°æ®ã€‚å±æ€§åœ¨å®šä¹‰å­—ç¬¦æ€§è´¨æ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚å¼•ç”¨ [Unicode æ ‡å‡†ç¬¬ 3.3 èŠ‚ï¼ŒD3](http://www.unicode.org/versions/Unicode9.0.0/ch03.pdf)ï¼š

> å­—ç¬¦çš„è¯­ä¹‰ç”±å…¶èº«ä»½ã€è§„èŒƒæ€§å±æ€§å’Œè¡Œä¸ºå†³å®šã€‚

è¿™äº›æ˜¯ä¸€äº›å±æ€§çš„ä¾‹å­ï¼š

+   `Name`: ä¸€ä¸ªå”¯ä¸€åç§°ï¼Œç”±å¤§å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦å’Œç©ºæ ¼ç»„æˆ â€“ ä¾‹å¦‚ï¼š

    +   A: `Name = LATIN CAPITAL LETTER A`

    +   ğŸ™‚: `Name = SLIGHTLY SMILING FACE`

+   `General_Category`: å¯¹å­—ç¬¦è¿›è¡Œåˆ†ç±» â€“ ä¾‹å¦‚ï¼š

    +   x: `General_Category = Lowercase_Letter`

    +   3: `General_Category = Number`

    +   $: `General_Category = Currency_Symbol`

+   `White_Space`: ç”¨äºæ ‡è®°ä¸å¯è§ç©ºæ ¼å­—ç¬¦ï¼Œä¾‹å¦‚ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦å’Œæ¢è¡Œç¬¦ â€“ ä¾‹å¦‚ï¼š

    +   \t: `White_Space = True`

    +   Ï€: `White_Space = False`

+   `Age`: å­—ç¬¦é¦–æ¬¡è¢«å¼•å…¥çš„ Unicode æ ‡å‡†ç‰ˆæœ¬ â€“ ä¾‹å¦‚ï¼šæ¬§å…ƒç¬¦å· â‚¬ è¢«æ·»åŠ åˆ° Unicode æ ‡å‡†çš„ 2.1 ç‰ˆæœ¬ä¸­ã€‚

    +   â‚¬: `Age = 2.1`

+   `Block`: ä¸€ç³»åˆ—è¿ç»­çš„ä»£ç ç‚¹ã€‚å—ä¸é‡å ï¼Œå¹¶ä¸”å®ƒä»¬çš„åç§°æ˜¯å”¯ä¸€çš„ã€‚ä¾‹å¦‚ï¼š

    +   S: `Block = Basic_Latin` (èŒƒå›´ 0x0000..0x007F)

    +   ğŸ™‚: `Block = Emoticons` (èŒƒå›´ 0x1F600..0x1F64F)

+   `Script`: æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªä¹¦å†™ç³»ç»Ÿä½¿ç”¨çš„å­—ç¬¦é›†åˆã€‚

    +   ä¸€äº›è„šæœ¬æ”¯æŒå¤šç§ä¹¦å†™ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œæ‹‰ä¸å­—æ¯è„šæœ¬æ”¯æŒè‹±è¯­ã€æ³•è¯­ã€å¾·è¯­ã€æ‹‰ä¸è¯­ç­‰ä¹¦å†™ç³»ç»Ÿã€‚

    +   ä¸€äº›è¯­è¨€å¯ä»¥ç”¨å¤šç§ç”±å¤šç§è„šæœ¬æ”¯æŒçš„æ›¿ä»£ä¹¦å†™ç³»ç»Ÿæ¥ä¹¦å†™ã€‚ä¾‹å¦‚ï¼ŒåœŸè€³å…¶è¯­åœ¨ 20 ä¸–çºªåˆæœŸè¿‡æ¸¡åˆ°æ‹‰ä¸å­—æ¯è„šæœ¬ä¹‹å‰ä½¿ç”¨äº†é˜¿æ‹‰ä¼¯å­—æ¯è„šæœ¬ã€‚

    +   ç¤ºä¾‹ï¼š

        +   Î±: `Script = Greek`

        +   Ğ”: `Script = Cyrillic`

è¿›ä¸€æ­¥é˜…è¯»ï¼š

+   Unicode å±æ€§åŠå…¶å€¼çš„åˆ—è¡¨ï¼š[â€œUnicode æ ‡å‡†é™„ä»¶ #44ï¼šUnicode å­—ç¬¦æ•°æ®åº“â€](https://unicode.org/reports/tr44/#Properties)ï¼ˆç¼–è¾‘è€…ï¼šMark Davis, LaurenÈ›iu Iancu, Ken Whistlerï¼‰

#### 46.5.4â€ƒUnicode å­—ç¬¦ä¸²å±æ€§è½¬ä¹‰^(ES2024)

åªæœ‰æ ‡å¿—`/v`å…è®¸æˆ‘ä»¬ä½¿ç”¨`\p{}`é€šè¿‡*Unicode å­—ç¬¦ä¸²å±æ€§*æŒ‡å®šä»£ç ç‚¹åºåˆ—çš„é›†åˆï¼ˆé€šè¿‡`\P{}`è¿›è¡Œå¦å®šä¸æ”¯æŒï¼‰ã€‚ä¾‹å¦‚ï¼Œ`RGI_Emoji`æ˜¯ä¸€ä¸ª Unicode å­—ç¬¦ä¸²å±æ€§ï¼š

```js
> /^\p{RGI_Emoji}$/v.test('â›”') // 1 code point (1 code unit)
true
> /^\p{RGI_Emoji}$/v.test('ğŸ™‚') // 1 code point (2 code units)
true
> /^\p{RGI_Emoji}$/v.test('ğŸ˜µâ€ğŸ’«') // 3 code points
true

```

è®©æˆ‘ä»¬çœ‹çœ‹ Unicode å­—ç¬¦å±æ€§`Emoji`å¦‚ä½•å¤„ç†è¿™äº›è¾“å…¥ï¼š

```js
> /^\p{Emoji}$/v.test('â›”') // 1 code point (1 code unit)
true
> /^\p{Emoji}$/v.test('ğŸ™‚') // 1 code point (2 code units)
true
> /^\p{Emoji}$/v.test('ğŸ˜µâ€ğŸ’«') // 3 code points
false

```

å¦‚é¢„æœŸï¼Œå®ƒåªåŒ¹é…å•ä¸ªä»£ç ç‚¹ã€‚

##### 46.5.4.1â€ƒUnicode å­—ç¬¦ä¸²å±æ€§

ç›®å‰ï¼ŒJavaScript åªæ”¯æŒä»¥ä¸‹ Unicode å­—ç¬¦ä¸²å±æ€§ï¼š

+   `Basic_Emoji`ï¼šå•ä¸ªä»£ç ç‚¹

+   `Emoji_Keycap_Sequence`

+   `RGI_Emoji_Modifier_Sequence`

+   `RGI_Emoji_Flag_Sequence`

+   `RGI_Emoji_Tag_Sequence`

+   `RGI_Emoji_ZWJ_Sequence`

+   `RGI_Emoji`ï¼šä¸Šè¿°æ‰€æœ‰é›†åˆçš„å¹¶é›†

Unicode å­—ç¬¦ä¸²å±æ€§çš„è¯­ä¹‰åœ¨[æ–‡æœ¬æ–‡ä»¶](https://www.unicode.org/reports/tr51/#Emoji_Properties_and_Data_Files)ä¸­å®šä¹‰ï¼Œè¯¥æ–‡ä»¶åˆ—ä¸¾äº†å¦‚ä¸‹ä»£ç ç‚¹åºåˆ—ï¼ˆ`\x{23}`æ˜¯`#`ï¼‰ï¼š

```js
0023 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: \x{23}
002A FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: *
0030 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: 0
0031 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: 1
0032 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: 2
0033 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: 3
0034 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: 4
0035 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: 5
0036 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: 6
0037 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: 7
0038 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: 8
0039 FE0F 20E3 ; Emoji_Keycap_Sequence ; keycap: 9

```

è¿›ä¸€æ­¥é˜…è¯»ï¼š

+   â€œUnicode æŠ€æœ¯æŠ¥å‘Š#23ï¼šUnicode å­—ç¬¦å±æ€§æ¨¡å‹â€ä¸­çš„[â€œå­—ç¬¦ä¸²å±æ€§â€éƒ¨åˆ†](https://www.unicode.org/reports/tr23/#PropertyStringsDefinitions)å®šä¹‰äº†å­—ç¬¦ä¸²çš„å±æ€§æ˜¯ä»€ä¹ˆã€‚

+   ECMAScript è§„èŒƒä¸­çš„[â€œäºŒè¿›åˆ¶ Unicode å­—ç¬¦ä¸²å±æ€§è¡¨â€](https://tc39.es/ecma262/#table-binary-unicode-properties-of-strings)åˆ—å‡ºäº† JavaScript æ”¯æŒçš„å­—ç¬¦ä¸²å±æ€§ã€‚

### 46.6â€ƒè¯­æ³•ï¼šå­—ç¬¦ç±»

ä¸€ä¸ª*å­—ç¬¦ç±»*å°†*ç±»èŒƒå›´*æ‹¬åœ¨æ–¹æ‹¬å·ä¸­ã€‚ç±»èŒƒå›´æŒ‡å®šä¸€ç»„å­—ç¬¦ï¼š

+   `[Â«class rangesÂ»]`åŒ¹é…é›†åˆä¸­çš„ä»»ä½•å­—ç¬¦ã€‚

+   `[^Â«class rangesÂ»]`åŒ¹é…é›†åˆä¸­ä¸å­˜åœ¨çš„ä»»ä½•å­—ç¬¦ã€‚

ç±»èŒƒå›´è§„åˆ™ï¼š

+   éè¯­æ³•å­—ç¬¦ä»£è¡¨è‡ªèº«ï¼š`[abc]`

+   å¿…é¡»è½¬ä¹‰å“ªäº›å­—ç¬¦å–å†³äºæ ‡å¿—ï¼š

    +   æ ‡å¿—`/v`ï¼šä»¥ä¸‹ä¸€äº›å­—ç¬¦åªæœ‰åœ¨å‡ºç°ä¸¤æ¬¡æ—¶æ‰éœ€è¦è½¬ä¹‰ï¼Œä½†å§‹ç»ˆè½¬ä¹‰å®ƒä»¬æ›´ç®€å•ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œå­—ç¬¦ç±»å†…çš„è½¬ä¹‰ï¼ˆÂ§46.2.3ï¼‰â€ã€‚

        +   [â€œè¯­æ³•å­—ç¬¦â€](https://tc39.es/ecma262/#prod-SyntaxCharacter):

            ```js
            ^ $ \ . * + ? ( ) [ ] { } |

            ```

        +   æ–œæ ï¼š

            ```js
            /

            ```

        +   [ç±»é›†ä¿ç•™æ ‡ç‚¹ç¬¦å·](https://tc39.es/ecma262/#prod-ClassSetReservedPunctuator):

            ```js
            & - ! # % , : ; < = > @ ` ~

            ```

    +   æ²¡æœ‰ Unicode æ ‡å¿—ï¼ˆæ—¢æ²¡æœ‰`/v`ä¹Ÿæ²¡æœ‰`/u`ï¼‰:

        +   æˆ‘ä»¬å¿…é¡»å§‹ç»ˆè½¬ä¹‰ï¼š`\ ]`

        +   ä¸€äº›å­—ç¬¦åœ¨æŸäº›ä½ç½®æ‰éœ€è¦è½¬ä¹‰ï¼š

            +   `^`åªæœ‰åœ¨å®ƒæ˜¯æœ€å‰é¢çš„å­—ç¬¦æ—¶æ‰éœ€è¦è½¬ä¹‰ã€‚

            +   `-`åªæœ‰åœ¨å®ƒä¸æ˜¯ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå­—ç¬¦æ—¶æ‰éœ€è¦è½¬ä¹‰ã€‚

+   å­—ç¬¦è½¬ä¹‰ç¬¦ï¼ˆ`\n`ï¼Œ`\x20`ï¼Œ`\u{1F44D}`ç­‰ï¼‰å…·æœ‰é€šå¸¸çš„å«ä¹‰ã€‚

    +   æ³¨æ„ï¼š`\b`ä»£è¡¨é€€æ ¼ã€‚åœ¨å…¶ä»–æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå®ƒåŒ¹é…å•è¯è¾¹ç•Œã€‚

+   å­—ç¬¦ç±»è½¬ä¹‰ç¬¦ï¼ˆ`\d`ï¼Œ`\P{White_Space}`ï¼Œ`\p{RGI_Emoji}`ç­‰ï¼‰å…·æœ‰é€šå¸¸çš„å«ä¹‰ã€‚

+   é€šè¿‡è¿å­—ç¬¦æŒ‡å®šå­—ç¬¦èŒƒå›´ï¼š`[a-z]`

#### 46.6.1â€ƒå­—ç¬¦ç±»ä¸­çš„ä»£ç ç‚¹åºåˆ—^(ES2024)

ä½¿ç”¨æ ‡å¿— `/v`ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `\q{}` å‘ç”±å­—ç¬¦ç±»å®šä¹‰çš„é›†åˆä¸­æ·»åŠ ä»£ç ç‚¹åºåˆ—ã€‚è¿™ç§è¯­æ³•ä¹Ÿç§°ä¸ºï¼š

+   *ç±»å­—ç¬¦ä¸²æå–*ï¼ˆç”± [ECMAScript è§„èŒƒ](https://tc39.es/ecma262/#prod-ClassStringDisjunction)ï¼‰

+   *å­—ç¬¦ä¸²å­—é¢é‡*ï¼ˆç”± [ECMAScript å¯¹ `/v` æ ‡å¿—çš„ææ¡ˆ](https://github.com/tc39/proposal-regexp-v-flag)ï¼‰

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ `\q{}` çš„ç¤ºä¾‹ï¼š

```js
> /^[\q{ğŸ˜µâ€ğŸ’«}]$/v.test('ğŸ˜µâ€ğŸ’«')
true

```

æ²¡æœ‰ä½¿ç”¨ `\q{}`ï¼Œå…·æœ‰å¤šä¸ªä»£ç ç‚¹çš„ å›¾å½¢ç¾¤ ä»ç„¶è¢«è§†ä¸ºå¤šä¸ªå­—ç¬¦ï¼š

```js
> /^[ğŸ˜µâ€ğŸ’«]$/v.test('ğŸ˜µâ€ğŸ’«')
false
> /^[\u{1F635}\u{200D}\u{1F4AB}]$/v.test('ğŸ˜µâ€ğŸ’«') // equivalent
false
> /^[ğŸ˜µâ€ğŸ’«]$/v.test('\u{1F635}')
true

```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å•ä¸ª `\q{}` æ·»åŠ å¤šä¸ªä»£ç ç‚¹åºåˆ—â€”â€”å¦‚æœæˆ‘ä»¬ç”¨ç®¡é“ç¬¦åˆ†éš”å®ƒä»¬ï¼š

```js
> /^[\q{abc|def}]$/v.test('abc')
true
> /^[\q{abc|def}]$/v.test('def')
true

```

#### 46.6.2â€ƒå­—ç¬¦ç±»çš„é›†åˆæ“ä½œ^(ES2024)

æ ‡å¿— `/v` å¯ç”¨å­—ç¬¦ç±»çš„é›†åˆæ“ä½œã€‚

##### 46.6.2.1â€ƒåµŒå¥—å­—ç¬¦ç±»

è¦å¯ç”¨å­—ç¬¦ç±»çš„é›†åˆæ“ä½œï¼Œæˆ‘ä»¬å¿…é¡»èƒ½å¤ŸåµŒå¥—å®ƒä»¬ã€‚å­—ç¬¦ç±»è½¬ä¹‰å·²ç»æä¾›äº†ä¸€äº›åµŒå¥—åŠŸèƒ½ï¼š

```js
> /^[\d\w]$/v.test('7')
true
> /^[\d\w]$/v.test('H')
true
> /^[\d\w]$/v.test('?')
false

```

ä½¿ç”¨æ ‡å¿— `/v`ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åµŒå¥—å­—ç¬¦ç±»ï¼ˆä¸‹é¢çš„æ­£åˆ™è¡¨è¾¾å¼ä¸ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ç­‰ä»·ï¼‰ï¼š

```js
> /^[[0-9][A-Za-z0-9_]]$/v.test('7')
true
> /^[[0-9][A-Za-z0-9_]]$/v.test('H')
true
> /^[[0-9][A-Za-z0-9_]]$/v.test('?')
false

```

##### 46.6.2.2â€ƒé€šè¿‡ `--` çš„å­—ç¬¦é›†å‡æ³•

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `--` æ“ä½œç¬¦ä»ç†è®ºä¸Šå‡å»ç”±å­—ç¬¦ç±»æˆ–å­—ç¬¦ç±»è½¬ä¹‰å®šä¹‰çš„å­—ç¬¦é›†ï¼š

```js
> /^[\w--[a-g]]$/v.test('a')
false
> /^[\w--[a-g]]$/v.test('h')
true

> /^[\p{Number}--[0-9]]$/v.test('Ù£')
true
> /^[\p{Number}--[0-9]]$/v.test('3')
false

> /^[\p{RGI_Emoji}--\q{ğŸ˜µâ€ğŸ’«}]$/v.test('ğŸ˜µâ€ğŸ’«') // emoji has 3 code points
false
> /^[\p{RGI_Emoji}--\q{ğŸ˜µâ€ğŸ’«}]$/v.test('ğŸ™‚')
true

```

å•ä¸ªä»£ç ç‚¹ä¹Ÿå¯ä»¥ç”¨äº `--` æ“ä½œç¬¦çš„ä¸¤ä¾§ï¼š

```js
> /^[\w--a]$/v.test('a')
false
> /^[\w--a]$/v.test('b')
true

```

##### 46.6.2.3â€ƒé€šè¿‡ `&&` çš„å­—ç¬¦é›†äº¤é›†

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `&&` æ“ä½œç¬¦ä»ç†è®ºä¸Šäº¤é›†ç”±å­—ç¬¦ç±»æˆ–å­—ç¬¦ç±»è½¬ä¹‰å®šä¹‰çš„å­—ç¬¦é›†ï¼š

```js
> /[\p{ASCII}&&\p{Letter}]/v.test('D')
true
> /[\p{ASCII}&&\p{Letter}]/v.test('Î”')
false

> /^[\p{Script=Arabic}&&\p{Number}]$/v.test('Ù£')
true
> /^[\p{Script=Arabic}&&\p{Number}]$/v.test('Ø¬')
false

```

##### 46.6.2.4â€ƒå­—ç¬¦é›†çš„å¹¶é›†

è¦è®¡ç®—å­—ç¬¦é›†çš„é›†åˆè®ºå¹¶é›†ï¼Œæˆ‘ä»¬åªéœ€åœ¨å­—ç¬¦ç±»å†…éƒ¨å°†å®ƒä»¬çš„å®šä¹‰ç»“æ„å¹¶æ’æ”¾ç½®ï¼š

```js
> /^[\p{Emoji_Keycap_Sequence}[a-z]]+$/v.test('a2ï¸âƒ£c')
true

```

### 46.7â€ƒè¯­æ³•ï¼šæ•è·ç»„

+   ç¼–å·æ•è·ç»„: `(a+)`

    +   å›æº¯å¼•ç”¨ï¼š`\1`ï¼Œ`\2` ç­‰ã€‚

+   å‘½åæ•è·ç»„^(ES2018): `(?<as>a+)`

    +   å›æº¯å¼•ç”¨ï¼š`\k<as>`

+   éæ•è·ç»„: `(?:a+)`

### 46.8â€ƒè¯­æ³•ï¼šé‡è¯

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ä»¥ä¸‹é‡è¯éƒ½æ˜¯ *è´ªå©ªçš„*ï¼ˆå®ƒä»¬å°½å¯èƒ½å¤šåœ°åŒ¹é…å­—ç¬¦ï¼‰ï¼š

+   `?`: åŒ¹é…é›¶æ¬¡æˆ–ä¸€æ¬¡

+   `*`: åŒ¹é…é›¶æ¬¡æˆ–å¤šæ¬¡

+   `+`: åŒ¹é…ä¸€æ¬¡æˆ–å¤šæ¬¡

+   `{n}`: åŒ¹é… `n` æ¬¡

+   `{n,}`: åŒ¹é… `n` æ¬¡æˆ–æ›´å¤šæ¬¡

+   `{n,m}`: è‡³å°‘åŒ¹é… `n` æ¬¡ï¼Œæœ€å¤šåŒ¹é… `m` æ¬¡ã€‚

è¦ä½¿å®ƒä»¬ *çŠ¹è±«ä¸å†³*ï¼ˆä»¥ä¾¿å®ƒä»¬å°½å¯èƒ½å°‘åœ°åŒ¹é…å­—ç¬¦ï¼‰ï¼Œåœ¨å®ƒä»¬åé¢æ”¾ç½®é—®å·ï¼ˆ`?`ï¼‰ï¼š

```js
> /X.*X/.exec('XabcXdefX')[0]  // greedy
'XabcXdefX'
> /X.*?X/.exec('XabcXdefX')[0] // reluctant
'XabcX'

```

### 46.9â€ƒè¯­æ³•ï¼šæ–­è¨€

+   `^` ä»…åŒ¹é…è¾“å…¥çš„å¼€å§‹

+   `$` ä»…åŒ¹é…è¾“å…¥çš„ç»“æŸ

+   `\b` ä»…åœ¨å•è¯è¾¹ç•Œå¤„åŒ¹é…

    +   `\B` ä»…åœ¨éå•è¯è¾¹ç•Œå¤„åŒ¹é…

å¯ç”¨å‰ç»æ–­è¨€æ¦‚è¿°ï¼š

| æ¨¡å¼ | åç§° |  |
| --- | --- | --- |
| `(?=Â«patternÂ»)` | æ­£å‘å‰è§† | ES3 |
| `(?!Â«patternÂ»)` | è´Ÿå‘å‰è§† | ES3 |
| `(?<=Â«patternÂ»)` | æ­£å‘åè§† | ES2018 |
| `(?<!Â«patternÂ»)` | è´Ÿå‘åè§† | ES2018 |

#### 46.9.1â€ƒå‘å‰è§†æ–­è¨€

**æ­£å‘å‰è§†åŒ¹é…:** `(?=Â«patternÂ»)` å¦‚æœ `pattern` åŒ¹é…æ¥ä¸‹æ¥çš„å†…å®¹ï¼Œåˆ™åŒ¹é…ã€‚

ç¤ºä¾‹ï¼šç”± `X` åç¼€çš„å°å†™å­—æ¯åºåˆ—ã€‚

```js
> 'abcX def'.match(/[a-z]+(?=X)/g)
[ 'abc' ]

```

æ³¨æ„ï¼Œ`X` æœ¬èº«ä¸æ˜¯åŒ¹é…å­ä¸²çš„ä¸€éƒ¨åˆ†ã€‚

**è´Ÿå‘å‰è§†åŒ¹é…:** `(?!Â«patternÂ»)` å¦‚æœ `pattern` ä¸åŒ¹é…æ¥ä¸‹æ¥çš„å†…å®¹ï¼Œåˆ™åŒ¹é…ã€‚

ç¤ºä¾‹ï¼šç”± `X` åç¼€çš„å°å†™å­—æ¯åºåˆ—ã€‚

```js
> 'abcX def'.match(/[a-z]+(?!X)/g)
[ 'ab', 'def' ]

```

#### 46.9.2â€ƒå‘åè§†æ–­è¨€ (ES2018)

**æ­£å‘åè§†åŒ¹é…:** `(?<=Â«patternÂ»)` å¦‚æœ `pattern` åŒ¹é…å‰é¢çš„å†…å®¹ï¼Œåˆ™åŒ¹é…ã€‚

ç¤ºä¾‹ï¼šç”± `X` å‰ç¼€çš„å°å†™å­—æ¯åºåˆ—ã€‚

```js
> 'Xabc def'.match(/(?<=X)[a-z]+/g)
[ 'abc' ]

```

**è´Ÿå‘åè§†åŒ¹é…:** `(?<!Â«patternÂ»)` å¦‚æœ `pattern` ä¸åŒ¹é…å‰é¢çš„å†…å®¹ï¼Œåˆ™åŒ¹é…ã€‚

ç¤ºä¾‹ï¼šç”± `X` å‰ç¼€çš„å°å†™å­—æ¯åºåˆ—ã€‚

```js
> 'Xabc def'.match(/(?<!X)[a-z]+/g)
[ 'bc', 'def' ]

```

ç¤ºä¾‹ï¼šå°† â€œ.jsâ€ æ›¿æ¢ä¸º â€œ.htmlâ€ï¼Œä½†ä¸åœ¨ â€œNode.jsâ€ ä¸­æ›¿æ¢ã€‚

```js
> 'Node.js: index.js and main.js'.replace(/(?<!Node)\.js/g, '.html')
'Node.js: index.html and main.html'

```

### 46.10â€ƒè¯­æ³•ï¼šæå–ï¼ˆ`|`ï¼‰

æ³¨æ„ï¼šæ­¤æ“ä½œç¬¦ä¼˜å…ˆçº§ä½ï¼ˆç»‘å®šéå¸¸å¼±ï¼‰ã€‚å¦‚æœ‰å¿…è¦ï¼Œè¯·ä½¿ç”¨åˆ†ç»„ï¼š

+   `^aa|zz$` åŒ¹é…æ‰€æœ‰ä»¥ `aa` å¼€å¤´å’Œ/æˆ–ä»¥ `zz` ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚

    +   æ³¨æ„ï¼Œ`|` çš„ä¼˜å…ˆçº§ä½äº `^` å’Œ `$`ã€‚

+   `^(aa|zz)$` åŒ¹é…ä¸¤ä¸ªå­—ç¬¦ä¸² `'aa'` å’Œ `'zz'`ã€‚

+   `^a(a|z)z$` åŒ¹é…ä¸¤ä¸ªå­—ç¬¦ä¸² `'aaz'` å’Œ `'azz'`ã€‚

### 46.11â€ƒæ­£åˆ™è¡¨è¾¾å¼æ ‡å¿—

| æ–‡å­—æ ‡å¿— | å±æ€§å | ES | æè¿° |
| --- | --- | --- | --- |
| `d` | `hasIndices` | ES2022 | å¼€å¯åŒ¹é…ç´¢å¼• |
| `g` | `global` | ES3 | å¤šæ¬¡åŒ¹é… |
| `i` | `ignoreCase` | ES3 | ä¸åŒºåˆ†å¤§å°å†™åŒ¹é… |
| `m` | `multiline` | ES3 | `^` å’Œ `$` æ¯è¡ŒåŒ¹é… |
| `s` | `dotAll` | ES2018 | ç‚¹å·åŒ¹é…è¡Œç»ˆæ­¢ç¬¦ |
| `u` | `unicode` | ES6 | Unicode æ¨¡å¼ |
| `v` | `unicodeSets` | ES2024 | Unicode é›†åˆæ¨¡å¼ï¼ˆ**æ¨è**ï¼‰ |
| `y` | `sticky` | ES6 | åŒ¹é…ä¹‹é—´æ²¡æœ‰å­—ç¬¦ |

è¡¨ 46.1ï¼šè¿™æ˜¯ JavaScript æ”¯æŒçš„æ­£åˆ™è¡¨è¾¾å¼æ ‡å¿—ã€‚

ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼æ ‡å¿—åœ¨ JavaScript ä¸­å¯ç”¨ï¼ˆè¡¨ 46.1 æä¾›äº†ç´§å‡‘çš„æ¦‚è¿°ï¼‰ï¼š

+   `/d`ï¼ˆ`.hasIndices`ï¼‰ï¼šæŸäº›ä¸ RegExp ç›¸å…³çš„æ–¹æ³•è¿”å› *match å¯¹è±¡*ï¼Œæè¿°æ­£åˆ™è¡¨è¾¾å¼åœ¨è¾“å…¥å­—ç¬¦ä¸²ä¸­çš„åŒ¹é…ä½ç½®ã€‚å¦‚æœæ­¤æ ‡å¿—å¼€å¯ï¼Œæ¯ä¸ª match å¯¹è±¡éƒ½åŒ…å« *match ç´¢å¼•*ï¼Œå‘Šè¯‰æˆ‘ä»¬æ¯ä¸ªåˆ†ç»„æ•è·çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚æ›´å¤šä¿¡æ¯ï¼šâ€œMatch indices in match objects (ES2022)â€ (Â§46.14.1)ã€‚

+   `/g`ï¼ˆ`.global`ï¼‰ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†åç»­æ–¹æ³•çš„å·¥ä½œæ–¹å¼ã€‚

    +   `String.prototype.match()`

    +   `RegExp.prototype.exec()`

    +   `RegExp.prototype.test()`

    è§£é‡Šè§ â€œThe flags `/g` and `/y`, and the property `.lastIndex` (advanced)â€ (Â§46.16)ã€‚ç®€è€Œè¨€ä¹‹ï¼šæ²¡æœ‰ `/g`ï¼Œæ–¹æ³•åªè€ƒè™‘è¾“å…¥å­—ç¬¦ä¸²ä¸­æ­£åˆ™è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªåŒ¹é…ã€‚æœ‰ `/g`ï¼Œå®ƒä»¬è€ƒè™‘æ‰€æœ‰åŒ¹é…ã€‚

+   `/i`ï¼ˆ`.ignoreCase`ï¼‰å¼€å¯ä¸åŒºåˆ†å¤§å°å†™åŒ¹é…ï¼š

    ```js
    > /a/.test('A')
    false
    > /a/i.test('A')
    true

    ```

+   `/m` (`.multiline`): å¦‚æœæ­¤æ ‡å¿—å¼€å¯ï¼Œ`^` åŒ¹é…æ¯ä¸€è¡Œçš„å¼€å§‹ï¼Œ`$` åŒ¹é…æ¯ä¸€è¡Œçš„ç»“æŸã€‚å¦‚æœå…³é—­ï¼Œ`^` åŒ¹é…æ•´ä¸ªè¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ï¼Œ`$` åŒ¹é…æ•´ä¸ªè¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸã€‚

    ```js
    > 'a1\na2\na3'.match(/^a./gm)
    [ 'a1', 'a2', 'a3' ]
    > 'a1\na2\na3'.match(/^a./g)
    [ 'a1' ]

    ```

+   `/s` (`.dotAll`): é»˜è®¤æƒ…å†µä¸‹ï¼Œç‚¹ä¸åŒ¹é…è¡Œç»ˆæ­¢ç¬¦ã€‚ä½¿ç”¨æ­¤æ ‡å¿—æ—¶ï¼Œå®ƒä¼šåŒ¹é…ï¼š

    ```js
    > /./.test('\n')
    false
    > /./s.test('\n')
    true

    ```

    è§£å†³æ–¹æ¡ˆï¼šå¦‚æœ `/s` ä¸å—æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `[^]` ä»£æ›¿ç‚¹ã€‚

    ```js
    > /[^]/.test('\n')
    true

    ```

+   æ›´å¥½çš„ Unicode æ”¯æŒï¼ˆâ€œUnicode æ ‡å¿—â€ï¼‰ï¼š 

    +   `/u` (`.unicode`): é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ¹é…çš„åŸå­å•ä½æ˜¯ JavaScript å­—ç¬¦ï¼ˆUnicode ä»£ç å•å…ƒï¼‰ã€‚æ­¤æ ‡å¿—å°†åŸå­å•ä½åˆ‡æ¢ä¸º Unicode ä»£ç ç‚¹ã€‚è¿™åœ¨â€œæ ‡å¿— `/u`ï¼šå­—ç¬¦æ˜¯ä»£ç ç‚¹ï¼ˆES6ï¼‰â€ï¼ˆÂ§46.11.3ï¼‰ä¸­æœ‰è§£é‡Šã€‚

    +   `/v` (`.unicodeSets`): æ­¤æ ‡å¿—æ”¹è¿›å¹¶å–ä»£äº†æ ‡å¿— `/u`ã€‚å®ƒæ”¯æŒå­—ç¬¦ç±»ä¸­çš„å¤šä»£ç ç‚¹å›¾å½¢ç¾¤é›†å’Œé›†åˆè¿ç®—ã€‚è¿™åœ¨â€œæ ‡å¿— `/v`ï¼šå¯¹å¤šä»£ç ç‚¹å›¾å½¢ç¾¤é›†çš„æœ‰é™æ”¯æŒï¼ˆES2024ï¼‰â€ï¼ˆÂ§46.11.4ï¼‰ä¸­æœ‰è§£é‡Šã€‚**æˆ‘å»ºè®®å¯¹æ‰€æœ‰æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨æ ‡å¿— `/v`**â€”â€”å› ä¸ºå®ƒå¯ç”¨äº†æ‰€æœ‰è¿™äº›åŠŸèƒ½ã€‚

+   `/y` (`.sticky`): è¿™ä¸ªæ ‡å¿—ä¸»è¦ä¸ `/g` ç»“åˆä½¿ç”¨æ‰æœ‰æ„ä¹‰ã€‚å½“ä¸¤è€…éƒ½å¼€å¯æ—¶ï¼Œä»»ä½•åŒ¹é…å¿…é¡»ç›´æ¥è·Ÿåœ¨å…ˆå‰çš„åŒ¹é…ä¹‹åï¼ˆå³ï¼Œå®ƒå¿…é¡»ä»æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡çš„ `.lastIndex` ç´¢å¼•å¤„å¼€å§‹ï¼‰ã€‚å› æ­¤ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…å¿…é¡»ä½äºç´¢å¼• 0ã€‚

    ```js
    > 'a1a2 a3'.match(/a./gy)
    [ 'a1', 'a2' ]
    > '_a1a2 a3'.match(/a./gy) // first match must be at index 0
    null

    > 'a1a2 a3'.match(/a./g)
    [ 'a1', 'a2', 'a3' ]
    > '_a1a2 a3'.match(/a./g)
    [ 'a1', 'a2', 'a3' ]

    ```

    `/y` çš„ä¸»è¦ç”¨ä¾‹æ˜¯æ ‡è®°åŒ–ï¼ˆåœ¨è§£æè¿‡ç¨‹ä¸­ï¼‰ã€‚æœ‰å…³æ­¤æ ‡å¿—çš„æ›´å¤šä¿¡æ¯ï¼šâ€œæ ‡å¿— `/g` å’Œ `/y`ï¼Œä»¥åŠå±æ€§ `.lastIndex`ï¼ˆé«˜çº§ï¼‰â€ï¼ˆÂ§46.16ï¼‰ã€‚

#### 46.11.1 å¦‚ä½•æ’åºæ­£åˆ™è¡¨è¾¾å¼æ ‡å¿—ï¼Ÿ

è€ƒè™‘ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š`/â€œ([^â€]+)â€/vdg`

åœ¨åˆ—å‡ºå…¶æ ‡å¿—çš„é¡ºåºä¸­ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼š

1.  å­—æ¯é¡ºåºï¼š`/dgv`

1.  æŒ‰é‡è¦æ€§æ’åºï¼ˆå¯ä»¥è¯´ `/v` æ˜¯æœ€åŸºç¡€çš„ç­‰ï¼‰ï¼š`/vgd`

ç”±äºï¼ˆ2ï¼‰ä¸æ˜æ˜¾ï¼Œï¼ˆ1ï¼‰æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚JavaScript ä¹Ÿå°†å…¶ç”¨äº RegExp å±æ€§ `.flags`ï¼š

```js
> /-/gymdivs.flags
'dgimsvy'

```

#### 46.11.2 æ²¡æœ‰ Unicode æ ‡å¿— `/u` å’Œ `/v`ï¼šå­—ç¬¦æ˜¯ UTF-16 ä»£ç å•å…ƒ

æ²¡æœ‰ Unicode æ ‡å¿— `/u` å’Œ `/v` æ—¶ï¼Œå¤§å¤šæ•°ç»“æ„ä½¿ç”¨å•ä¸ª UTF-16 ä»£ç å•å…ƒï¼Œè¿™åœ¨å­—ç¬¦æœ‰å¤šä¸ªä»£ç å•å…ƒæ—¶ä¼šæœ‰é—®é¢˜â€”â€”ä¾‹å¦‚ :)ï¼š

```js
> 'ğŸ™‚'.length
2

```

æ²¡æœ‰ Unicode æ ‡å¿—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª*ä»£ç å•å…ƒè½¬ä¹‰*æ¥è½¬ä¹‰æœ€å¤§çš„å­—ç¬¦ï¼Œè¯¥è½¬ä¹‰ç”± `\u` åè·Ÿå››ä¸ªåå…­è¿›åˆ¶æ•°å­—ç»„æˆï¼š

```js
> /^\uD83D\uDE42$/.test('ğŸ™‚')
true

```

ç‚¹æ“ä½œç¬¦ï¼ˆ`.`ï¼‰åŒ¹é…ä»£ç å•å…ƒï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¾—åˆ°ä¸¤ä¸ªåŒ¹é…è€Œä¸æ˜¯ä¸€ä¸ªï¼š

```js
> 'ğŸ™‚'.match(/./g)
[ '\uD83D', '\uDE42' ]

```

é‡è¯é€‚ç”¨äºä»£ç å•å…ƒï¼Œå› æ­¤åªä¼šé‡å¤ :) çš„ååŠéƒ¨åˆ†ï¼š

```js
> /^ğŸ™‚{2}$/.test('\uD83D\uDE42\uDE42')
true
> /^\uD83D\uDE42{2}$/.test('\uD83D\uDE42\uDE42') // equivalent
true

```

å­—ç¬¦ç±»è½¬ä¹‰å®šä¹‰äº†ä¸€ç»„ä»£ç å•å…ƒã€‚å› æ­¤ï¼Œè¡¨ç¤ºâ€œéåè¿›åˆ¶æ•°å­—â€çš„ç±»è½¬ä¹‰ `\D` ä¼šå¾—åˆ°ä¸¤ä¸ªåŒ¹é…ï¼š

```js
> 'ğŸ™‚'.match(/\D/g)
[ '\uD83D', '\uDE42' ]

```

å­—ç¬¦ç±»å®šä¹‰äº†ä¸€ç»„ä»£ç å•å…ƒã€‚å› æ­¤ï¼Œå°† :) æ”¾å…¥å­—ç¬¦ç±»ä¼šæœ‰ä¸ç›´è§‚çš„ç»“æœï¼š

```js
> /^[ğŸ™‚]$/.test('ğŸ™‚')
false
> /^[\uD83D\uDE42]$/.test('\uD83D\uDE42') // equivalent
false
> /^[ğŸ™‚]$/.test('\uD83D')
true

```

#### 46.11.3 æ ‡å¿— `/u`ï¼šå­—ç¬¦æ˜¯ä»£ç ç‚¹ï¼ˆES6ï¼‰

åœ¨å‰é¢çš„å­èŠ‚ä¸­ï¼Œå½“æˆ‘ä»¬æƒ³è¦åŒ¹é…å…·æœ‰å¤šä¸ª UTF-16 ä»£ç å•å…ƒçš„ä»£ç ç‚¹æ—¶ï¼Œæˆ‘ä»¬é‡åˆ°äº†é—®é¢˜ â€“ ä¾‹å¦‚ ğŸ™‚ã€‚æ ‡å¿— `/u` å¯ç”¨äº†å¯¹ä»£ç ç‚¹çš„æ”¯æŒå¹¶è§£å†³äº†è¿™äº›é—®é¢˜ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ *ä»£ç ç‚¹è½¬ä¹‰* æ¥è½¬ä¹‰ä»£ç ç‚¹ â€“ `\u{}`ï¼Œå…¶ä¸­åŒ…å«ä¸€åˆ°å…­ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼š

```js
> /^\u{1F642}$/u.test('ğŸ™‚')
true

```

ç‚¹æ“ä½œç¬¦ (`.`) åŒ¹é…ä»£ç ç‚¹ï¼š

```js
> 'ğŸ™‚'.match(/./gu)
[ 'ğŸ™‚' ]

```

é‡è¯é€‚ç”¨äºä»£ç ç‚¹ï¼š

```js
> /^ğŸ™‚{2}$/u.test('ğŸ™‚ğŸ™‚')
true

```

å­—ç¬¦ç±»è½¬ä¹‰å®šä¹‰äº†ä¸€ç»„ä»£ç ç‚¹ï¼š

```js
> 'ğŸ™‚'.match(/\D/gu)
[ 'ğŸ™‚' ]

```

æ”¯æŒä¸€ç§æ–°çš„å­—ç¬¦ç±»è½¬ä¹‰ â€“ Unicode å­—ç¬¦å±æ€§è½¬ä¹‰æŒ‡å®šäº†ä¸€ç»„ä»£ç ç‚¹ï¼š

```js
> /^\p{Emoji}$/u.test('â›”') // 1 code point (1 code unit)
true
> /^\p{Emoji}$/u.test('ğŸ™‚') // 1 code point (2 code units)
true

```

å­—ç¬¦ç±»ä¹Ÿå®šä¹‰äº†ä¸€ç»„ä»£ç ç‚¹ï¼š

```js
> /^[ğŸ™‚]$/u.test('ğŸ™‚')
true
> /^[ğŸ™‚]$/u.test('\uD83D')
false

```

#### 46.11.4â€ƒæ ‡å¿— `/v`: å¯¹å¤šä»£ç ç‚¹å›¾å½¢ç°‡çš„æœ‰é™æ”¯æŒ^(ES2024)

![å›¾æ ‡â€œæç¤ºâ€](img/8440b17bb8219cda9f9405ac83c36db0.png)â€‚**å°½å¯èƒ½ä½¿ç”¨æ ‡å¿— `/v`**

æ­¤æ ‡å¿—æ”¹è¿›äº† JavaScript æ­£åˆ™è¡¨è¾¾å¼çš„è®¸å¤šæ–¹é¢ï¼Œåº”é»˜è®¤ä½¿ç”¨ã€‚å¦‚æœå¹³å°å°šæœªæ”¯æŒï¼Œè‡³å°‘åº”ä½¿ç”¨ `/u`ã€‚

+   æ ‡å¿— `/v` å»ºç«‹åœ¨æ ‡å¿— `/u` å¸¦æ¥çš„æ”¹è¿›ä¹‹ä¸Šï¼Œå¹¶ä¿®å¤äº†å…¶å‡ ä¸ªç¼ºç‚¹ã€‚

+   æ³¨æ„ï¼Œæ ‡å¿— `/v` å’Œæ ‡å¿— `/u` æ˜¯äº’æ–¥çš„ â€“ æˆ‘ä»¬ä¸èƒ½åŒæ—¶ä½¿ç”¨ä¸¤è€…ï¼š

    ```js
    assert.throws(
      () => eval('/-/uv'),
      SyntaxError
    );

    ```

##### 46.11.4.1â€ƒæ ‡å¿— `/u` çš„é™åˆ¶ï¼šå¤„ç†åŒ…å«å¤šä¸ªä»£ç ç‚¹çš„å›¾å½¢ç°‡

ä¸€äº›å­—ä½“ç¬¦å·ç”±åŒ…å«å¤šä¸ªä»£ç ç‚¹çš„ *å›¾å½¢ç°‡*ï¼ˆä»£ç ç‚¹åºåˆ—ï¼‰è¡¨ç¤º â€“ ä¾‹å¦‚ ğŸ˜µâ€ğŸ’«ï¼š

```js
> Array.from('ğŸ˜µâ€ğŸ’«').length // count code points
3

```

æ ‡å¿— `/u` å¹¶æ²¡æœ‰å¸®åŠ©æˆ‘ä»¬å¤„ç†é‚£äº›ç±»å‹çš„å›¾å½¢ç°‡ï¼š

```js
// Grapheme cluster is not matched by single dot
assert.equal(
  'ğŸ˜µâ€ğŸ’«'.match(/./gu).length, 3
);

// Quantifiers only repeat last code point of grapheme cluster
assert.equal(
  /^ğŸ˜µâ€ğŸ’«{2}$/u.test('ğŸ˜µâ€ğŸ’«ğŸ˜µâ€ğŸ’«'), false
);

// Character class escapes only match single code points
assert.equal(
  /^\p{Emoji}$/u.test('ğŸ˜µâ€ğŸ’«'), false
);

// Character classes only match single code points
assert.equal(
  /^[ğŸ˜µâ€ğŸ’«]$/u.test('ğŸ˜µâ€ğŸ’«'), false
);

```

##### 46.11.4.2â€ƒæ ‡å¿— `/v`: Unicode å­—ç¬¦ä¸²å±æ€§è½¬ä¹‰å’Œå­—ç¬¦ç±»å­—ç¬¦ä¸²å­—é¢é‡

æ ‡å¿— `/v` ä¸æ ‡å¿— `/u` ç±»ä¼¼ï¼Œä½†æä¾›äº†å¯¹å¤šä»£ç ç‚¹å›¾å½¢ç°‡çš„æ›´å¥½æ”¯æŒã€‚å®ƒä¸ä¼šåœ¨æ‰€æœ‰åœ°æ–¹ä»ä»£ç ç‚¹åˆ‡æ¢åˆ°å›¾å½¢ç°‡ï¼Œä½†å®ƒç¡®å®é€šè¿‡æ·»åŠ å¯¹å¤šä»£ç ç‚¹å›¾å½¢ç°‡çš„æ”¯æŒæ¥ä¿®å¤äº†æˆ‘ä»¬ä¹‹å‰å­èŠ‚ä¸­é‡åˆ°çš„æœ€åä¸¤ä¸ªé—®é¢˜ â€“ é€šè¿‡æ·»åŠ æ”¯æŒå¤šä»£ç ç‚¹å›¾å½¢ç°‡åˆ°ï¼š

+   å­—ç¬¦ç±»è½¬ä¹‰ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡ `\p{}` æ¥å¼•ç”¨ Unicode å­—ç¬¦ä¸²å±æ€§ã€‚

    ```js
    > /^\p{RGI_Emoji}$/v.test('â›”') // 1 code point (1 code unit)
    true
    > /^\p{RGI_Emoji}$/v.test('ğŸ™‚') // 1 code point (2 code units)
    true
    > /^\p{RGI_Emoji}$/v.test('ğŸ˜µâ€ğŸ’«') // 3 code points
    true

    ```

+   å­—ç¬¦ç±»ï¼š`\q{}` å…è®¸æˆ‘ä»¬å®šä¹‰ ä»£ç ç‚¹åºåˆ—ã€‚

    ```js
    > /^[\q{ğŸ˜µâ€ğŸ’«}]$/v.test('ğŸ˜µâ€ğŸ’«')
    true

    ```

##### 46.11.4.3â€ƒæ ‡å¿— `/v`: å­—ç¬¦ç±»é›†åˆæ“ä½œ

å­—ç¬¦ç±»å¯ä»¥é€šè¿‡é›†åˆæ“ä½œå‡æ³•å’Œäº¤é›†è¿›è¡ŒåµŒå¥—å’Œç»„åˆ â€“ è¯·å‚é˜…â€œå­—ç¬¦ç±»çš„é›†åˆæ“ä½œ^(ES2024)â€ (Â§46.6.2)ã€‚

##### 46.11.4.4â€ƒæ ‡å¿— `/v`: æ”¹è¿›çš„å¿½ç•¥å¤§å°å†™åŒ¹é…

æ ‡å¿— `/u` åœ¨è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…æ—¶æœ‰ä¸€ä¸ªæ€ªç™–ï¼šä½¿ç”¨ `\P{Â·Â·Â·}` äº§ç”Ÿä¸ `[^\p{Â·Â·Â·}]` ä¸åŒçš„ç»“æœï¼š

```js
> /^\P{Lowercase_Letter}$/iu.test('A')
true
> /^\P{Lowercase_Letter}$/iu.test('a')
true

> /^[^\p{Lowercase_Letter}]$/iu.test('A')
false
> /^[^\p{Lowercase_Letter}]$/iu.test('a')
false

```

è§‚å¯Ÿï¼š

+   ä¸¤ç§å¦å®šæ–¹å¼åº”äº§ç”Ÿç›¸åŒçš„ç»“æœã€‚

+   ç›´è§‚åœ°è®²ï¼Œå¦‚æœæˆ‘ä»¬å‘æ­£åˆ™è¡¨è¾¾å¼æ·»åŠ  `/i`ï¼Œå®ƒåº”è¯¥åŒ¹é…è‡³å°‘ä¸ä¹‹å‰ä¸€æ ·å¤šçš„å­—ç¬¦ä¸² â€“ è€Œä¸æ˜¯æ›´å°‘ã€‚

æ ‡å¿— `/v` ä¿®å¤äº†é‚£ä¸ªæ€ªç™–ï¼š

```js
> /^\P{Lowercase_Letter}$/iv.test('A')
false
> /^\P{Lowercase_Letter}$/iv.test('a')
false

> /^[^\p{Lowercase_Letter}]$/iv.test('A')
false
> /^[^\p{Lowercase_Letter}]$/iv.test('a')
false

```

è¿›ä¸€æ­¥é˜…è¯»ï¼š

+   [2ality åšå®¢æ–‡ç« ](https://2ality.com/2022/11/regexp-v-flag.html#improved-case-insensitive-matching)è§£é‡Šäº†ä¸ºä»€ä¹ˆ`/u`å¯¼è‡´è¿™ç§è¡Œä¸ºã€‚

+   æœ¬èŠ‚æ¥æºï¼š[GitHub é—®é¢˜â€œIgnoreCase vs. complement vs. nested classâ€](https://github.com/tc39/proposal-regexp-v-flag/issues/30)

### 46.12â€ƒæ¨¡å¼ä¿®é¥°ç¬¦ï¼ˆå†…è”æ ‡å¿—ï¼‰^(ES2025)

æ¨¡å¼ä¿®é¥°ç¬¦å…è®¸æˆ‘ä»¬å°†æ ‡å¿—åº”ç”¨äºæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼ˆè€Œä¸æ˜¯æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼‰â€”â€”ä¾‹å¦‚ï¼Œåœ¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæ ‡å¿—`i`ä»…åº”ç”¨äºâ€œHELLOâ€ï¼š

```js
> /^x(?i:HELLO)x$/.test('xHELLOx')
true
> /^x(?i:HELLO)x$/.test('xhellox')
true
> /^x(?i:HELLO)x$/.test('XhelloX')
false

```

#### 46.12.1â€ƒæ¨¡å¼ä¿®é¥°ç¬¦çš„è¯­æ³•

è¿™æ˜¯è¯­æ³•çœ‹èµ·æ¥åƒä»€ä¹ˆï¼š

```js
(?ims-ims:pattern)
(?ims:pattern)
(?-ims:pattern)

```

æ³¨æ„ï¼š

+   åè·Ÿé—®å·(`?`)çš„æ ‡å¿—è¢«æ¿€æ´»ã€‚

+   åè·Ÿè¿å­—ç¬¦(`-`)çš„æ ‡å¿—è¢«å»æ¿€æ´»ã€‚

+   æ ‡å¿—ä¸èƒ½åŒæ—¶å‡ºç°åœ¨â€œæ¿€æ´»éƒ¨åˆ†â€å’Œâ€œå»æ¿€æ´»éƒ¨åˆ†â€ã€‚

+   æ²¡æœ‰ä»»ä½•æ ‡å¿—çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¯­æ³•åªæ˜¯ä¸€ä¸ªéæ•è·ç»„ï¼š`(?:pattern)`

è®©æˆ‘ä»¬æ”¹å˜ä¹‹å‰çš„ä¾‹å­ï¼šç°åœ¨æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼éƒ½æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„â€”â€”é™¤äº†â€œHELLOâ€ï¼š

```js
> /^x(?-i:HELLO)x$/i.test('xHELLOx')
true
> /^x(?-i:HELLO)x$/i.test('XHELLOX')
true
> /^x(?-i:HELLO)x$/i.test('XhelloX')
false

```

#### 46.12.2â€ƒæ”¯æŒå“ªäº›æ ‡å¿—ï¼Ÿ

ä»¥ä¸‹æ ‡å¿—å¯ä»¥åœ¨æ¨¡å¼ä¿®é¥°ç¬¦ä¸­ä½¿ç”¨ï¼š

| æ–‡æœ¬æ ‡å¿— | å±æ€§åç§° | ES | æè¿° |
| --- | --- | --- | --- |
| i | ignoreCase | ES3 | ä¸åŒºåˆ†å¤§å°å†™åŒ¹é… |
| m | multiline | ES3 | `^`å’Œ`$`æŒ‰è¡ŒåŒ¹é… |
| s | dotAll | ES2018 | ç‚¹åŒ¹é…è¡Œç»ˆæ­¢ç¬¦ |

æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œæ­£åˆ™è¡¨è¾¾å¼æ ‡å¿—â€ (Â§46.11)ã€‚

å‰©ä½™çš„æ ‡å¿—ä¸å—æ”¯æŒï¼Œå› ä¸ºå®ƒä»¬è¦ä¹ˆä¼šä½¿æ­£åˆ™è¡¨è¾¾å¼è¯­ä¹‰è¿‡äºå¤æ‚ï¼ˆä¾‹å¦‚æ ‡å¿—`v`ï¼‰ï¼Œè¦ä¹ˆå› ä¸ºå®ƒä»¬åªæœ‰åœ¨åº”ç”¨äºæ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ—¶æ‰æœ‰æ„ä¹‰ï¼ˆä¾‹å¦‚æ ‡å¿—`g`ï¼‰ã€‚

#### 46.12.3â€ƒç”¨ä¾‹ï¼šæ›´æ”¹æ­£åˆ™è¡¨è¾¾å¼éƒ¨åˆ†çš„æ ‡å¿—

æœ‰æ—¶æ›´æ”¹æ­£åˆ™è¡¨è¾¾å¼éƒ¨åˆ†çš„æ ‡å¿—æ˜¯æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼ŒRon Buckton [è§£é‡Š](https://github.com/tc39/proposal-regexp-modifiers/issues/1)è¯´æ›´æ”¹æ ‡å¿—`m`æœ‰åŠ©äºåŒ¹é…æ–‡ä»¶å¼€å¤´çš„ Markdown å‰ç¼€å—ï¼ˆæˆ‘ç¨å¾®ç¼–è¾‘äº†ä»–çš„ç‰ˆæœ¬ï¼‰ï¼š

```js
const re = /(?-m:^)---\r?\n((?:^(?!---$).*\r?\n)*)^---$/m;
assert.equal(re.test('---a'), false);
assert.equal(re.test('---\n---'), true);
assert.equal(
  re.exec('---\n---')[1],
  ''
);
assert.equal(
  re.exec('---\na: b\n---')[1],
  'a: b\n'
);

```

è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

+   é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ‡å¿—`m`æ˜¯å¼€å¯çš„ï¼Œé”šç‚¹`^`åŒ¹é…è¡Œçš„å¼€å§‹ï¼Œé”šç‚¹`$`åŒ¹é…è¡Œçš„ç»“æŸã€‚

+   é¦–ä¸ª`^`æ˜¯ä¸åŒçš„ï¼šå®ƒå¿…é¡»åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨é‚£é‡Œä½¿ç”¨æ¨¡å¼ä¿®é¥°ç¬¦å¹¶å…³é—­æ ‡å¿—`m`çš„åŸå› ã€‚

è¿™æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ ¼å¼åŒ–åå¸¦æœ‰ä¸é‡è¦çš„ç©ºç™½å’Œè§£é‡Šæ€§æ³¨é‡Šï¼š

```js
(?-m:^)---\r?\n  # first line of string
(  # capturing group for the frontmatter
  (?:  # pattern for one line (non-capturing group)
    ^(?!---$)  # line must not start with "---" + EOL (lookahead)
    .*\r?\n
  )*
)
^---$  # closing delimiter of frontmatter

```

#### 46.12.4â€ƒç”¨ä¾‹ï¼šå†…è”æ ‡å¿—

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ ‡å¿—ä½äºå®é™…æ­£åˆ™è¡¨è¾¾å¼ä¹‹å¤–æ˜¯ä¸æ–¹ä¾¿çš„ã€‚è¿™æ—¶æ¨¡å¼ä¿®é¥°ç¬¦å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ä¾‹å¦‚åŒ…æ‹¬ï¼š

+   å°†æ­£åˆ™è¡¨è¾¾å¼å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚ JSON æ ¼å¼ã€‚

+   [Regex+ åº“](https://github.com/slevithan/regex) æä¾›äº†ä¸€ä¸ªæ¨¡æ¿å­—é¢é‡ï¼Œä½¿å¾—åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼å˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚æŒ‡å®šæ ‡å¿—çš„è¯­æ³•å¢åŠ äº†ä¸€äº›æ‚ä¹±ï¼Œå¯ä»¥é€šè¿‡æ¨¡å¼ä¿®é¥°ç¬¦ï¼ˆå¦‚æœå®ƒä»¬æ”¯æŒæ‰€éœ€çš„æ ‡å¿—ï¼‰æ¥é¿å…ï¼š

    ```js
    regex('i')`world`
    regex`(?i:world)`

    ```

#### 46.12.5 ä½¿ç”¨æ¡ˆä¾‹ï¼šæ”¹å˜æ ‡å¿—çš„æ­£åˆ™è¡¨è¾¾å¼ç‰‡æ®µ

åœ¨å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¦‚æœä½ èƒ½å¤Ÿå°†è¾ƒå¤§çš„æ­£åˆ™è¡¨è¾¾å¼ç”±è¾ƒå°çš„æ­£åˆ™è¡¨è¾¾å¼ç»„æˆï¼Œè¿™å°†å¾ˆæœ‰å¸®åŠ©ã€‚ä¸Šè¿° Regex+ åº“æ”¯æŒè¿™ä¸€ç‚¹ã€‚å¦‚æœè¾ƒå°çš„æ­£åˆ™è¡¨è¾¾å¼éœ€è¦ä¸åŒçš„æ ‡å¿—ï¼ˆä¾‹å¦‚ï¼Œå› ä¸ºå®ƒæƒ³è¦å¿½ç•¥å¤§å°å†™ï¼‰ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥é€šè¿‡æ¨¡å¼ä¿®é¥°ç¬¦å®ç°ï¼ˆå¦‚æœå®ƒä»¬æ”¯æŒæ‰€éœ€çš„æ ‡å¿—ï¼‰ï¼š

### 46.13 æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡çš„å±æ€§

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š

+   ä¸¥æ ¼æ¥è¯´ï¼Œåªæœ‰ `.lastIndex` æ˜¯ä¸€ä¸ªçœŸæ­£çš„å®ä¾‹å±æ€§ã€‚æ‰€æœ‰å…¶ä»–å±æ€§éƒ½æ˜¯é€šè¿‡ getter å®ç°çš„ã€‚

+   å› æ­¤ï¼Œ`.lastIndex` æ˜¯å”¯ä¸€çš„å¯å˜å±æ€§ã€‚æ‰€æœ‰å…¶ä»–å±æ€§éƒ½æ˜¯åªè¯»çš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ”¹å˜å®ƒä»¬ï¼Œæˆ‘ä»¬éœ€è¦å¤åˆ¶æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œå…‹éš†å’Œä¸å¯ç ´ååœ°ä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼â€ (Â§46.1.3)ï¼‰ã€‚

#### 46.13.1 æ ‡å¿—ä½œä¸ºå±æ€§

æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ ‡å¿—éƒ½ä½œä¸ºä¸€ä¸ªå…·æœ‰æ›´é•¿ã€æ›´å…·æè¿°æ€§çš„å±æ€§å­˜åœ¨ï¼š

```js
> /a/i.ignoreCase
true
> /a/.ignoreCase
false

```

è¿™æ˜¯æ ‡å¿—å±æ€§çš„å®Œæ•´åˆ—è¡¨ï¼š

+   `.dotAll` (/s)

+   `.global` (/g)

+   `.hasIndices` (/d)

+   `.ignoreCase` (/i)

+   `.multiline` (/m)

+   `.sticky` (/y)

+   `.unicode` (/u)

+   `.unicodeSets` (/v)

#### 46.13.2 å…¶ä»–å±æ€§

æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¿˜å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š

+   `.source` (ES3)ï¼šæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼

    ```js
    > /abc/ig.source
    'abc'

    ```

+   `.flags` (ES6)ï¼šæ­£åˆ™è¡¨è¾¾å¼çš„æ ‡å¿—

    ```js
    > /abc/ig.flags
    'gi'

    ```

+   `.lastIndex` (ES3)ï¼šå½“æ ‡å¿— `/g` è¢«æ‰“å¼€æ—¶ä½¿ç”¨ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œæ ‡å¿— `/g` å’Œ `/y`ï¼Œä»¥åŠå±æ€§ `.lastIndex`ï¼ˆé«˜çº§ï¼‰â€ (Â§46.16)ã€‚

### 46.14 åŒ¹é…å¯¹è±¡

å‡ ä¸ªä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸å…³çš„æ–¹æ³•è¿”å›æ‰€è°“çš„ *åŒ¹é…å¯¹è±¡*ï¼Œä»¥æä¾›æœ‰å…³æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²ä½ç½®çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™äº›æ–¹æ³•æ˜¯ï¼š

+   `RegExp.prototype.exec()` è¿”å› `null` æˆ–ä¸€ä¸ªå•ç‹¬çš„åŒ¹é…å¯¹è±¡ã€‚

+   `String.prototype.match()` è¿”å› `null` æˆ–ä¸€ä¸ªå•ç‹¬çš„åŒ¹é…å¯¹è±¡ï¼ˆå¦‚æœæœªè®¾ç½®æ ‡å¿— `/g`ï¼‰ã€‚

+   `String.prototype.matchAll()` è¿”å›ä¸€ä¸ªåŒ¹é…å¯¹è±¡çš„å¯è¿­ä»£å¯¹è±¡ï¼ˆå¿…é¡»è®¾ç½®æ ‡å¿— `/g`ï¼›å¦åˆ™ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚

è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```js
assert.deepEqual(
  /(a+)b/d.exec('ab aaab'),
  {
    0: 'ab',
    1: 'a',
    index: 0,
    input: 'ab aaab',
    groups: undefined,
    indices: {
      0: [0, 2],
      1: [0, 1],
      groups: undefined
    },
  }
);

```

`.exec()` çš„ç»“æœæ˜¯ç¬¬ä¸€ä¸ªåŒ¹é…çš„ *åŒ¹é…å¯¹è±¡*ï¼Œå…·æœ‰ä»¥ä¸‹å±æ€§ï¼š

+   `[0]`ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å®Œæ•´å­ä¸²

+   `[1]`ï¼šç¼–å·ç»„ 1 çš„æ•è·ï¼ˆç­‰ç­‰ï¼‰

+   `.index`ï¼šåŒ¹é…å‘ç”Ÿçš„ä½ç½®åœ¨å“ªé‡Œï¼Ÿ

+   `.input`ï¼šè¢«åŒ¹é…çš„å­—ç¬¦ä¸²

+   `.groups`ï¼šå‘½åç»„çš„æ•è·ï¼ˆè¯·å‚é˜…â€œå‘½åæ•è·ç»„ (ES2018)â€ (Â§46.15.2.1))

+   `.indices`ï¼šæ•è·ç»„çš„ç´¢å¼•èŒƒå›´

    +   å¦‚æœæ‰“å¼€äº†æ ‡å¿— `/d`ï¼Œåˆ™åˆ›å»ºæ­¤å±æ€§ã€‚

#### 46.14.1â€ƒåŒ¹é…å¯¹è±¡ä¸­çš„åŒ¹é…ç´¢å¼• (ES2022)

*åŒ¹é…ç´¢å¼•* æ˜¯åŒ¹é…å¯¹è±¡çš„ä¸€ä¸ªç‰¹æ€§ï¼šå¦‚æœæˆ‘ä»¬é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ ‡å¿— `/d`ï¼ˆå±æ€§ `.hasIndices`ï¼‰å°†å…¶æ‰“å¼€ï¼Œå®ƒä»¬å°†è®°å½•ç»„è¢«æ•è·çš„èµ·å§‹å’Œç»“æŸç´¢å¼•ã€‚

##### 46.14.1.1â€ƒç¼–å·ç»„çš„åŒ¹é…ç´¢å¼•

è¿™æ˜¯æˆ‘ä»¬å¦‚ä½•è®¿é—®ç¼–å·ç»„çš„æ•è·ï¼š

```js
const matchObj = /(a+)(b+)/d.exec('aaaabb');
assert.equal(
  matchObj[1], 'aaaa'
);
assert.equal(
  matchObj[2], 'bb'
);

```

ç”±äºæ­£åˆ™è¡¨è¾¾å¼æ ‡å¿— `/d`ï¼Œ`matchObj` è¿˜æœ‰ä¸€ä¸ªå±æ€§ `.indices`ï¼Œå®ƒè®°å½•æ¯ä¸ªç¼–å·ç»„åœ¨è¾“å…¥å­—ç¬¦ä¸²ä¸­è¢«æ•è·çš„ä½ç½®ï¼š

```js
assert.deepEqual(
  matchObj.indices[1], [0, 4]
);
assert.deepEqual(
  matchObj.indices[2], [4, 6]
);

```

##### 46.14.1.2â€ƒå‘½åç»„çš„åŒ¹é…ç´¢å¼•

å‘½åç»„çš„æ•è·å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è®¿é—®ï¼š

```js
const matchObj = /(?<as>a+)(?<bs>b+)/d.exec('aaaabb');
assert.equal(
  matchObj.groups.as, 'aaaa'
);
assert.equal(
  matchObj.groups.bs, 'bb'
);

```

å®ƒä»¬çš„ç´¢å¼•å­˜å‚¨åœ¨ `matchObj.indices.groups` ä¸­ï¼š

```js
assert.deepEqual(
  matchObj.indices.groups.as, [0, 4]
);
assert.deepEqual(
  matchObj.indices.groups.bs, [4, 6]
);

```

##### 46.14.1.3â€ƒä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­

åŒ¹é…ç´¢å¼•çš„ä¸€ä¸ªé‡è¦ç”¨ä¾‹æ˜¯è§£æå™¨ï¼Œå®ƒæŒ‡å‘è¯­æ³•é”™è¯¯çš„ç¡®åˆ‡ä½ç½®ã€‚ä»¥ä¸‹ä»£ç è§£å†³äº†ç›¸å…³çš„é—®é¢˜ï¼šå®ƒæŒ‡å‘å¼•å·å†…å®¹çš„å¼€å§‹å’Œç»“æŸä½ç½®ï¼ˆè¯·å‚é˜…æœ«å°¾çš„æ¼”ç¤ºï¼‰ã€‚

```js
const reQuoted = /â€œ([^â€]+)â€/dgv;
function pointToQuotedText(str) {
  const startIndices = new Set();
  const endIndices = new Set();
  for (const match of str.matchAll(reQuoted)) {
    const [start, end] = match.indices[1];
    startIndices.add(start);
    endIndices.add(end);
  }
  let result = '';
  for (let index=0; index < str.length; index++) {
    if (startIndices.has(index)) {
      result += '[';
    } else if (endIndices.has(index+1)) {
      result += ']';
    } else {
      result += ' ';
    }
  }
  return result;
}

assert.equal(
  pointToQuotedText(
    'They said â€œhelloâ€ and â€œgoodbyeâ€.'),
    '           [   ]       [     ]  '
);

```

### 46.15â€ƒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹æ³•

#### 46.15.1â€ƒé»˜è®¤æƒ…å†µä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åœ¨å­—ç¬¦ä¸²çš„ä»»ä½•ä½ç½®è¿›è¡ŒåŒ¹é…

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åœ¨å­—ç¬¦ä¸²çš„ä»»ä½•ä½ç½®è¿›è¡ŒåŒ¹é…ï¼š

```js
> /a/.test('__a__')
true

```

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨æ–­è¨€ï¼Œå¦‚ `^`ï¼ˆæˆ–è€…ä½¿ç”¨æ ‡å¿— `/y`ï¼‰æ¥æ”¹å˜è¿™ä¸€ç‚¹ï¼š

```js
> /^a/.test('__a__')
false
> /^a/.test('a__')
true

```

#### 46.15.2â€ƒæ²¡æœ‰ `/g` çš„ `string.match(regExp)`ï¼šè·å–ç¬¬ä¸€ä¸ªåŒ¹é…çš„åŒ¹é…å¯¹è±¡

æ²¡æœ‰æ ‡å¿— `/g`ï¼Œ`string.match(regExp)` è¿”å› `str` ä¸­ `regExp` çš„ç¬¬ä¸€ä¸ªåŒ¹é…çš„ åŒ¹é…å¯¹è±¡ï¼š

```js
assert.deepEqual(
  'ab aab'.match(/(a+)b/),
  {
    0: 'ab',
    1: 'a',
    index: 0,
    input: 'ab aab',
    groups: undefined,
  }
);

```

##### 46.15.2.1â€ƒå‘½åçš„æ•è·ç»„ (ES2018)

ä¹‹å‰çš„ä¾‹å­åŒ…å«ä¸€ä¸ªç¼–å·ç»„ã€‚ä»¥ä¸‹ä¾‹å­æ¼”ç¤ºäº†å‘½åç»„ï¼š

```js
assert.deepEqual(
  'ab aab'.match(/(?<as>a+)b/),
  {
    0: 'ab',
    1: 'a',
    index: 0,
    input: 'ab aab',
    groups: { as: 'a' },
  }
);

```

åœ¨ `.match()` çš„ç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘½åç»„ä¹Ÿæ˜¯ä¸€ä¸ªç¼–å·ç»„â€”â€”å®ƒçš„æ•è·å­˜åœ¨ä¸¤æ¬¡ï¼š

+   ä¸€æ¬¡ä½œä¸ºç¼–å·æ•è·ï¼ˆå±æ€§ `'1'`ï¼‰ã€‚

+   ä¸€æ¬¡ä½œä¸ºå‘½åæ•è·ï¼ˆå±æ€§ `groups.as`ï¼‰ã€‚

##### 46.15.2.2â€ƒé‡å¤å‘½åçš„æ•è·ç»„ (ES2025)

è‡ªä» ECMAScript 2025 ä»¥æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç»„åä¸¤æ¬¡â€”â€”åªè¦å®ƒåœ¨ä¸åŒçš„å¤‡é€‰æ–¹æ¡ˆä¸­å‡ºç°ï¼š

```js
const RE = /(?<a>a(?<xs>x+))|(?<b>b(?<xs>x+))/v;
assert.deepEqual(
  'axx'.match(RE).groups,
  {
    a: 'axx',
    xs: 'xx',
    b: undefined,
    __proto__: null,
  }
);
assert.deepEqual(
  'bxx'.match(RE).groups,
  {
    a: undefined,
    xs: 'xx',
    b: 'bxx',
    __proto__: null,
  }
);

```

ä»¥ä¸‹æ˜¯ä¸å…è®¸çš„ï¼ˆç»„ `xs` å°†ä¼šåŒ¹é…ä¸¤æ¬¡ï¼‰ï¼š

```js
assert.throws(
  () => eval('/(?<a>a(?<xs>x+))(?<b>b(?<xs>x+))/v'),
  /^SyntaxError:.* Duplicate capture group name$/
);

```

#### 46.15.3â€ƒå¸¦æœ‰ `/g` çš„ `string.match(regExp)`ï¼šè·å–æ‰€æœ‰ç»„ 0 æ•è· (ES3)

ä½¿ç”¨æ ‡å¿— `/g`ï¼Œ`string.match(regExp)` è¿”å› `str` ä¸­ä¸ `regExp` åŒ¹é…çš„æ‰€æœ‰å­å­—ç¬¦ä¸²ï¼š

```js
> 'ab aab'.match(/(a+)b/g)
[ 'ab', 'aab' ]

```

å¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œ`.match()` è¿”å› `null`ï¼š

```js
> 'xyz'.match(/(a+)b/g)
null

```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ (`??`) æ¥ä¿æŠ¤è‡ªå·±å…å— `null` çš„å½±å“ï¼š

```js
const numberOfMatches = (str.match(regExp) ?? []).length;

```

æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ å¯é€‰é“¾ (`?.`) å¹¶å°†å…¶ä¸ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ç»“åˆï¼š

```js
const numberOfMatches = str.match(regExp)?.length ?? 0;

```

#### 46.15.4â€ƒ`string.matchAll(regExp)`: è·å–æ‰€æœ‰åŒ¹é…å¯¹è±¡çš„è¿­ä»£å™¨ (ES2020)

è¿™æ˜¯è°ƒç”¨ `.matchAll()` çš„æ–¹å¼ï¼š

```js
const matchIterable = str.matchAll(regExp);

```

ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œ`.matchAll()` è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œéå†æ‰€æœ‰åŒ¹é…é¡¹çš„åŒ¹é…å¯¹è±¡ã€‚

åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `Array.from()`ï¼ˆch_arrays.html#Array.fromï¼‰å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºæ•°ç»„ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°æ¯”è¾ƒå®ƒä»¬ã€‚

```js
> Array.from('-a-a-a'.matchAll(/-(a)/gv))
[
  { 0:'-a', 1:'a', index: 0, input: '-a-a-a', groups: undefined },
  { 0:'-a', 1:'a', index: 2, input: '-a-a-a', groups: undefined },
  { 0:'-a', 1:'a', index: 4, input: '-a-a-a', groups: undefined },
]

```

å¿…é¡»è®¾ç½®æ ‡å¿— `/g`ï¼š

```js
> Array.from('-a-a-a'.matchAll(/-(a)/v))
TypeError: String.prototype.matchAll called with a non-global
RegExp argument

```

`.matchAll()` ä¸å— `regExp.lastIndex` çš„å½±å“ï¼Œå¹¶ä¸”ä¸ä¼šæ”¹å˜å®ƒã€‚

![å›¾æ ‡â€œç»ƒä¹ â€](img/4fc2ec98bb44cc1f4de7c6a46d9dd043.png)â€‚**ç»ƒä¹ ï¼šé€šè¿‡ `.matchAll()` æå–å¼•å·æ–‡æœ¬**

`exercises/regexps/extract_quoted_test.mjs`

##### 46.15.4.1â€ƒå®ç° `.matchAll()`

`.matchAll()` å¯ä»¥é€šè¿‡ `.exec()` å¦‚ä¸‹å®ç°ï¼š

```js
function* matchAll(str, regExp) {
  if (!regExp.global) {
    throw new TypeError('Flag /g must be set!');
  }
  // Preserve and reset flags
  const localCopy = new RegExp(regExp, regExp.flags);
  let match;
  while (match = localCopy.exec(str)) {
    yield match;
  }
}

```

åˆ›å»ºå±€éƒ¨å‰¯æœ¬ç¡®ä¿ä¸¤ä»¶äº‹ï¼š

+   `regex.lastIndex` ä¸ä¼šæ”¹å˜ã€‚

+   `localCopy.lastIndex` ä¸ºé›¶ã€‚

ä½¿ç”¨ `matchAll()`ï¼š

```js
const str = '"fee" "fi" "fo" "fum"';
const regex = /"([^"]*)"/g;

for (const match of matchAll(str, regex)) {
  console.log(match[1]);
}

```

è¾“å‡ºï¼š

```js
fee
fi
fo
fum

```

#### 46.15.5â€ƒ`regExp.exec(str)`ï¼šæ•è·ç»„ï¼ˆES3ï¼‰

##### 46.15.5.1â€ƒ`regExp.exec(str)` æ²¡æœ‰è®¾ç½® `/g`ï¼šè·å–ç¬¬ä¸€ä¸ªåŒ¹é…å¯¹è±¡çš„åŒ¹é…å¯¹è±¡

æ²¡æœ‰è®¾ç½®æ ‡å¿— `/g` æ—¶ï¼Œ`regExp.exec()` çš„è¡Œä¸ºç±»ä¼¼äº `string.match()` â€“ å®ƒè¿”å›ä¸€ä¸ªå•ç‹¬çš„åŒ¹é…å¯¹è±¡ã€‚

##### 46.15.5.2â€ƒ`regExp.exec(str)` è®¾ç½® `/g`ï¼šéå†æ‰€æœ‰åŒ¹é…é¡¹

![å›¾æ ‡â€œæç¤ºâ€](img/8440b17bb8219cda9f9405ac83c36db0.png)â€‚**æ£€ç´¢æ‰€æœ‰åŒ¹é…é¡¹çš„æ›´å¥½æ›¿ä»£æ–¹æ³•ï¼š`string.matchAll(regExp)`ï¼ˆES2020ï¼‰**

è‡ªä» ECMAScript 2020 ä»¥æ¥ï¼ŒJavaScript æœ‰å¦ä¸€ç§æ£€ç´¢æ‰€æœ‰åŒ¹é…é¡¹çš„æ–¹æ³•ï¼š`string.matchAll(regExp)`ï¼ˆString.prototype.matchAllï¼‰ã€‚è¯¥æ–¹æ³•æ›´å®¹æ˜“ä¸”æ›´å®‰å…¨ä½¿ç”¨ï¼šå®ƒè¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œä¸å— `.lastIndex` çš„å½±å“ï¼Œå¦‚æœç¼ºå°‘æ ‡å¿— `/g`ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

å¦‚æœæˆ‘ä»¬æƒ³è¦æ£€ç´¢æ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰åŒ¹é…é¡¹ï¼ˆè€Œä¸ä»…ä»…æ˜¯ç¬¬ä¸€ä¸ªï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ‡æ¢åˆ°æ ‡å¿— `/g`ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥å¤šæ¬¡è°ƒç”¨ `.exec()` å¹¶æ¯æ¬¡è·å–ä¸€ä¸ªåŒ¹é…é¡¹ã€‚åœ¨æœ€åä¸€ä¸ªåŒ¹é…é¡¹ä¹‹åï¼Œ`.exec()` è¿”å› `null`ã€‚

```js
> const regExp = /(a+)b/g;
> regExp.exec('ab aab')
{ 0: 'ab', 1: 'a', index: 0, input: 'ab aab', groups: undefined }
> regExp.exec('ab aab')
{ 0: 'aab', 1: 'aa', index: 3, input: 'ab aab', groups: undefined }
> regExp.exec('ab aab')
null

```

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹å¾ªç¯éå†æ‰€æœ‰åŒ¹é…é¡¹ï¼š

```js
const regExp = /(a+)b/g;
const str = 'ab aab';

let match;
// Check for null via truthiness
// Alternative: while ((match = regExp.exec(str)) !== null)
while (match = regExp.exec(str)) {
  console.log(match[1]);
}

```

è¾“å‡ºï¼š

```js
a
aa

```

#### 46.15.6â€ƒ`string.match()` ä¸ `string.matchAll()` ä¸ `regExp.exec()`

ä»¥ä¸‹è¡¨æ ¼æ€»ç»“äº†ä¸‰ç§æ–¹æ³•ä¹‹é—´çš„å·®å¼‚ï¼š

|  | æ²¡æœ‰ `/g` | æœ‰ `/g` |
| --- | --- | --- |
| `string.match(regExp)` | ç¬¬ä¸€ä¸ªåŒ¹é…å¯¹è±¡ | ç»„ 0 æ•è·çš„æ•°ç»„ |
| `string.matchAll(regExp)` | `TypeError` | åŒ¹é…å¯¹è±¡çš„è¿­ä»£å™¨ |
| `regExp.exec(string)` | ç¬¬ä¸€ä¸ªåŒ¹é…å¯¹è±¡ | ä¸‹ä¸€ä¸ªåŒ¹é…å¯¹è±¡æˆ– `null` |

#### 46.15.7â€ƒä½¿ç”¨ `string.replace()` å’Œ `string.replaceAll()` æ›¿æ¢

ä¸¤ç§æ›¿æ¢æ–¹æ³•éƒ½æœ‰ä¸¤ä¸ªå‚æ•°ï¼š

+   `string.replace(searchValue, replacementValue)`

+   `string.replaceAll(searchValue, replacementValue)`

`searchValue` å¯ä»¥æ˜¯ï¼š

+   ä¸€ä¸ªå­—ç¬¦ä¸²

+   ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼

`replacementValue` å¯ä»¥æ˜¯ï¼š

+   å­—ç¬¦ä¸²ï¼šç”¨æ­¤å­—ç¬¦ä¸²æ›¿æ¢åŒ¹é…é¡¹ã€‚å­—ç¬¦ `$` æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå…è®¸æˆ‘ä»¬æ’å…¥ç»„çš„æ•è·ä»¥åŠæ›´å¤šï¼ˆè¯¦æƒ…å°†åœ¨åé¢è§£é‡Šï¼‰ã€‚

+   å‡½æ•°ï¼šé€šè¿‡æ­¤å‡½æ•°è®¡ç®—æ›¿æ¢åŒ¹é…é¡¹çš„å­—ç¬¦ä¸²ã€‚

è¿™ä¸¤ç§æ–¹æ³•å¦‚ä¸‹ä¸åŒï¼š

+   `.replace()` æ›¿æ¢å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ï¼ˆæ²¡æœ‰ `/g`ï¼‰ã€‚

+   `.replaceAll()` æ›¿æ¢å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå¸¦æœ‰ `/g`ï¼‰çš„æ‰€æœ‰å‡ºç°ã€‚

æ­¤è¡¨æ€»ç»“äº†å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š

| æœç´¢ï¼šâ†’ | å­—ç¬¦ä¸² | æ²¡æœ‰å¸¦æœ‰ `/g` çš„æ­£åˆ™è¡¨è¾¾å¼ | å¸¦æœ‰ `/g` çš„æ­£åˆ™è¡¨è¾¾å¼ |
| --- | --- | --- | --- |
| `.replace` | ç¬¬ä¸€ä¸ªå‡ºç° | ç¬¬ä¸€ä¸ªå‡ºç° | ï¼ˆæ‰€æœ‰å‡ºç°ï¼‰ |
| `.replaceAll` | æ‰€æœ‰å‡ºç° | `TypeError` | æ‰€æœ‰å‡ºç° |

`.replace()` çš„æœ€åä¸€åˆ—åœ¨æ‹¬å·ä¸­ï¼Œå› ä¸ºæ­¤æ–¹æ³•åœ¨ `.replaceAll()` ä¹‹å‰å°±å·²ç»å­˜åœ¨ï¼Œå› æ­¤æ”¯æŒç°åœ¨åº”è¯¥é€šè¿‡åè€…å¤„ç†çš„åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬èƒ½æ”¹å˜è¿™ä¸€ç‚¹ï¼Œ`.replace()` åœ¨è¿™é‡Œå°†æŠ›å‡º `TypeError`ã€‚

æˆ‘ä»¬é¦–å…ˆæ¢è®¨å½“ `replacementValue` æ˜¯ä¸€ä¸ªç®€å•å­—ç¬¦ä¸²ï¼ˆæ²¡æœ‰ `$` å­—ç¬¦ï¼‰æ—¶ï¼Œ`.replace()` å’Œ `.replaceAll()` å¦‚ä½•å•ç‹¬å·¥ä½œã€‚ç„¶åæˆ‘ä»¬æ£€æŸ¥å®ƒä»¬å¦‚ä½•å—åˆ°æ›´å¤æ‚çš„æ›¿æ¢å€¼çš„å½±å“ã€‚

##### 46.15.7.1â€ƒ`string.replace(searchValue, replacementValue)` (ES3)

`.replace()` çš„æ“ä½œæ–¹å¼å—å…¶ç¬¬ä¸€ä¸ªå‚æ•° `searchValue` çš„å½±å“ï¼š

+   æ²¡æœ‰å¸¦æœ‰ `/g` çš„æ­£åˆ™è¡¨è¾¾å¼ï¼šæ›¿æ¢æ­¤æ­£åˆ™è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ã€‚

    ```js
    > 'aaa'.replace(/a/, 'x')
    'xaa'

    ```

+   å­—ç¬¦ä¸²ï¼šæ›¿æ¢è¿™ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå‡ºç°ï¼ˆå­—ç¬¦ä¸²æŒ‰å­—é¢æ„æ€è§£é‡Šï¼Œè€Œä¸æ˜¯ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚

    ```js
    > 'aaa'.replace('a', 'x')
    'xaa'

    ```

+   å¸¦æœ‰ `/g` çš„æ­£åˆ™è¡¨è¾¾å¼ï¼šæ›¿æ¢æ­¤æ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰åŒ¹é…é¡¹ã€‚

    ```js
    > 'aaa'.replace(/a/g, 'x')
    'xxx'

    ```

    æ¨èï¼šå¦‚æœå¯ç”¨ `.replaceAll()`ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æœ€å¥½ä½¿ç”¨è¯¥æ–¹æ³•â€”â€”å…¶ç›®çš„æ˜¯æ›¿æ¢å¤šä¸ªå‡ºç°ã€‚

å¦‚æœæˆ‘ä»¬æƒ³è¦æ›¿æ¢å­—ç¬¦ä¸²çš„æ¯ä¸ªå‡ºç°ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š

+   æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `.replaceAll()`ï¼ˆå®ƒæ˜¯åœ¨ ES2021 ä¸­å¼•å…¥çš„ï¼‰ã€‚

+   åœ¨æœ¬ç« çš„åé¢éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†é‡åˆ° å·¥å…·å‡½æ•° `escapeForRegExp()`)ï¼Œå®ƒå°†å¸®åŠ©æˆ‘ä»¬å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºåŒ¹é…è¯¥å­—ç¬¦ä¸²å¤šæ¬¡çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ï¼Œ`'*'` å˜ä¸º `/\*/g`ï¼‰ã€‚

##### [46.15.7.2â€ƒ`string.replaceAll(searchValue, replacementValue)` (ES2021)

`.replaceAll()` çš„æ“ä½œæ–¹å¼å—å…¶ç¬¬ä¸€ä¸ªå‚æ•° `searchValue` çš„å½±å“ï¼š

+   å¸¦æœ‰ `/g` çš„æ­£åˆ™è¡¨è¾¾å¼ï¼šæ›¿æ¢æ­¤æ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰åŒ¹é…é¡¹ã€‚

    ```js
    > 'aaa'.replaceAll(/a/g, 'x')
    'xxx'

    ```

+   å­—ç¬¦ä¸²ï¼šæ›¿æ¢è¿™ä¸ªå­—ç¬¦ä¸²çš„æ‰€æœ‰å‡ºç°ï¼ˆå­—ç¬¦ä¸²æŒ‰å­—é¢æ„æ€è§£é‡Šï¼Œè€Œä¸æ˜¯ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚

    ```js
    > 'aaa'.replaceAll('a', 'x')
    'xxx'

    ```

+   æ²¡æœ‰å¸¦æœ‰ `/g` çš„æ­£åˆ™è¡¨è¾¾å¼ï¼šæŠ›å‡º `TypeError`ï¼ˆå› ä¸º `.replaceAll()` çš„ç›®çš„æ˜¯æ›¿æ¢å¤šä¸ªå‡ºç°ï¼‰ã€‚

    ```js
    > 'aaa'.replaceAll(/a/, 'x')
    TypeError: String.prototype.replaceAll called with
    a non-global RegExp argument

    ```

##### 46.15.7.3â€ƒ`.replace()` å’Œ `.replaceAll()` çš„å‚æ•° `replacementValue`

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªä½¿ç”¨äº†ç®€å•å­—ç¬¦ä¸²çš„ `replacementValue` å‚æ•°ï¼Œä½†å®ƒå¯ä»¥åšæ›´å¤šã€‚å¦‚æœå…¶å€¼ä¸ºï¼š

+   A stringï¼Œç„¶ååŒ¹é…é¡¹è¢«æ›¿æ¢ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²ã€‚å­—ç¬¦ `$` æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå…è®¸æˆ‘ä»¬æ’å…¥ç»„çš„æ•è·å’Œæ›´å¤šï¼ˆè¯¦æƒ…è¯·ç»§ç»­é˜…è¯»ï¼‰ã€‚

+   ç„¶åï¼Œå‡½æ•°å°†åŒ¹é…é¡¹æ›¿æ¢ä¸ºé€šè¿‡æ­¤å‡½æ•°è®¡ç®—å¾—åˆ°çš„å­—ç¬¦ä¸²ã€‚

##### 46.15.7.4â€ƒ`replacementValue` æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²

å¦‚æœæ›¿æ¢å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç¾å…ƒç¬¦å·æœ‰ç‰¹æ®Šå«ä¹‰ - å®ƒæ’å…¥ç”±æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ–‡æœ¬ï¼š

| æ–‡æœ¬ | ç»“æœ |
| --- | --- |
| `$$` | å•ä¸ª `$` |
| `$&` | å®Œæ•´åŒ¹é… |
| `` $` `` | åŒ¹é…å‰çš„æ–‡æœ¬ |
| `$'` | åŒ¹é…åçš„æ–‡æœ¬ |
| `$n` | ç¼–å·ç»„ `n` çš„æ•è· (`n` > 0) |
| `$<name>` | å‘½åç»„ `name` çš„æ•è·ï¼ˆES2018ï¼‰ |

ç¤ºä¾‹ï¼šæ’å…¥åŒ¹é…å­å­—ç¬¦ä¸²ä¹‹å‰ã€ä¹‹å†…å’Œä¹‹åçš„æ–‡æœ¬ã€‚

```js
> 'a1 a2'.replaceAll(/a/g, "($`|$&|$')")
'(|a|1 a2)1 (a1 |a|2)2'

```

ç¤ºä¾‹ï¼šæ’å…¥ç¼–å·ç»„çš„æ•è·ã€‚

```js
> const regExp = /^([A-Za-z]+): (.*)$/gv;
> 'first: Jane'.replaceAll(regExp, 'KEY: $1, VALUE: $2')
'KEY: first, VALUE: Jane'

```

ç¤ºä¾‹ï¼šæ’å…¥å‘½åç»„çš„æ•è·ã€‚

```js
> const regExp = /^(?<key>[A-Za-z]+): (?<value>.*)$/gv;
> 'first: Jane'.replaceAll(regExp, 'KEY: $<key>, VALUE: $<value>')
'KEY: first, VALUE: Jane'

```

![â€œç»ƒä¹ â€å›¾æ ‡](img/4fc2ec98bb44cc1f4de7c6a46d9dd043.png)â€‚**ç»ƒä¹ ï¼šé€šè¿‡ `.replace()` å’Œå‘½åç»„æ›´æ”¹å¼•å·**

`exercises/regexps/change_quotes_test.mjs`

##### 46.15.7.5â€ƒ`replacementValue` æ˜¯ä¸€ä¸ªå‡½æ•°

å¦‚æœæ›¿æ¢å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—æ¯ä¸ªæ›¿æ¢ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ‰¾åˆ°çš„æ¯ä¸ªéè´Ÿæ•´æ•°ä¹˜ä»¥äºŒã€‚

```js
assert.equal(
  '3 cats and 4 dogs'.replaceAll(/[0-9]+/g, (all) => 2 * Number(all)),
  '6 cats and 8 dogs'
);

```

æ›¿æ¢å‡½æ•°è·å–ä»¥ä¸‹å‚æ•°ã€‚æ³¨æ„å®ƒä»¬ä¸åŒ¹é…å¯¹è±¡å¤šä¹ˆç›¸ä¼¼ã€‚è¿™äº›å‚æ•°éƒ½æ˜¯ä½ç½®å‚æ•°ï¼Œä½†æˆ‘å·²ç»åŒ…æ‹¬äº†å¦‚ä½•å‘½åå®ƒä»¬ï¼š

+   `all`: å®Œæ•´åŒ¹é…

+   `g1`: ç¬¬ 1 ä¸ªç¼–å·ç»„çš„æ•è·

+   ç­‰ç­‰ã€‚

+   `index`: åŒ¹é…å‘ç”Ÿåœ¨å“ªé‡Œï¼Ÿ

+   `input`: æˆ‘ä»¬è¦æ›¿æ¢çš„å­—ç¬¦ä¸²

+   `groups` (ES2018): å‘½åç»„çš„æ•è·ï¼ˆä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚æ€»æ˜¯æœ€åä¸€ä¸ªå‚æ•°ã€‚

å¦‚æœæˆ‘ä»¬åªå¯¹ `groups` æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŠ€æœ¯ï¼š

```js
const result = 'first=jane, last=doe'.replace(
  /(?<key>[a-z]+)=(?<value>[a-z]+)/g,
  (...args) => { // (A)
    const groups = args.at(-1); // (B)
    const {key, value} = groups;
    return key.toUpperCase() + '=' + value.toUpperCase();
  });
assert.equal(result, 'FIRST=JANE, LAST=DOE');

```

ç”±äºè¡Œ A ä¸­çš„ å‰©ä½™å‚æ•°ï¼Œ`args` åŒ…å«ä¸€ä¸ªåŒ…å«æ‰€æœ‰å‚æ•°çš„æ•°ç»„ã€‚æˆ‘ä»¬åœ¨è¡Œ B ä¸­é€šè¿‡ æ•°ç»„æ–¹æ³• `.at()` è®¿é—®æœ€åä¸€ä¸ªå‚æ•°ã€‚

#### 46.15.8â€ƒ`regExp.test(str)`: æ˜¯å¦æœ‰åŒ¹é…? (ES3)

æ­£åˆ™è¡¨è¾¾å¼æ–¹æ³• `regExp.test(str)` å¦‚æœ `regExp` åŒ¹é… `str` åˆ™è¿”å› `true`ï¼š

```js
> /bc/.test('ABCD')
false
> /bc/i.test('ABCD')
true
> /\.mjs$/.test('main.mjs')
true

```

ä½¿ç”¨ `.test()` æˆ‘ä»¬é€šå¸¸åº”è¯¥é¿å…ä½¿ç”¨ `/g` æ ‡å¿—ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬é€šå¸¸æ¯æ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶éƒ½ä¸ä¼šå¾—åˆ°ç›¸åŒçš„ç»“æœï¼š

```js
> const r = /a/g;
> r.test('aab')
true
> r.test('aab')
true
> r.test('aab')
false

```

ç»“æœæ˜¯ç”±äºå­—ç¬¦ä¸²ä¸­å­˜åœ¨ä¸¤ä¸ª `/a/` åŒ¹é…ã€‚åœ¨æ‰¾åˆ°æ‰€æœ‰è¿™äº›åŒ¹é…ä¹‹åï¼Œ`.test()` è¿”å› `false`ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ`/g` å’Œ `/y` æ ‡å¿—ï¼Œä»¥åŠ `.lastIndex` å±æ€§ï¼ˆé«˜çº§ï¼‰â€ (Â§46.16)ã€‚

#### 46.15.9â€ƒ`string.search(regExp)`: åŒ¹é…å‘ç”Ÿåœ¨ä»€ä¹ˆç´¢å¼•? (ES3)

å­—ç¬¦ä¸²æ–¹æ³• `.search()` è¿”å› `regExp` åœ¨ `str` ä¸­åŒ¹é…çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼š

```js
> '_abc_'.search(/abc/)
1
> 'main.mjs'.search(/\.mjs$/)
4

```

#### 46.15.10â€ƒ`string.split(separator, limit?)`: åˆ†å‰²å­—ç¬¦ä¸² (ES3)

å°†å­—ç¬¦ä¸²åˆ†å‰²æˆç”±åˆ†éš”ç¬¦åˆ†éš”çš„å­å­—ç¬¦ä¸²æ•°ç»„ã€‚

åˆ†éš”ç¬¦å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š

```js
> 'a : b : c'.split(':')
[ 'a ', ' b ', ' c' ]

```

å®ƒä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼š

```js
> 'a x:yyy b'.split(/x+:y+/)
[ 'a ', ' b' ]
> 'a x:yyy b'.split(/(x+):(y+)/)
[ 'a ', 'x', 'yyy', ' b' ]

```

æœ€åä¸€æ¬¡è°ƒç”¨æ¼”ç¤ºäº†æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç»„æ‰€åšçš„æ•è·æˆä¸ºè¿”å›æ•°ç»„çš„å…ƒç´ ã€‚

å¦‚æœæˆ‘ä»¬å¸Œæœ›åˆ†éš”ç¬¦æˆä¸ºè¿”å›çš„å­—ç¬¦ä¸²ç‰‡æ®µçš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦æœ‰åè§†æ–­è¨€æˆ–å‰ç»æ–­è¨€çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚

```js
> 'a: b: c'.split(/(?<=:) */)
[ 'a:', 'b:', 'c' ]
> 'a :b :c'.split(/ *(?=:)/)
[ 'a', ':b', ':c' ]

```

å¤šäºäº†å‰ç»æ–­è¨€ï¼Œç”¨äºåˆ†å‰²çš„æ­£åˆ™è¡¨è¾¾å¼å°†å†’å·ç•™åœ¨ç‰‡æ®µä¸­ï¼Œå¹¶ä¸”åªç§»é™¤å†’å·å‰åæˆ–å…¶é—´çš„ç©ºæ ¼ã€‚

**é™·é˜±**ï¼š`.split('')` ä¼šæŒ‰ JavaScript å­—ç¬¦åˆ†å‰²ï¼Œä½†é€šå¸¸æˆ‘ä»¬å¸Œæœ›æŒ‰å›¾å½¢ç°‡æˆ–è‡³å°‘ Unicode ä»£ç ç‚¹åˆ†å‰²ã€‚å› æ­¤ï¼Œæœ€å¥½ä½¿ç”¨ `Intl.Segmenter` æˆ– `Array.from()` è¿›è¡Œåˆ†å‰²ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œæ–‡æœ¬çš„åŸå­ï¼šä»£ç ç‚¹ã€JavaScript å­—ç¬¦ã€å›¾å½¢ç°‡â€ï¼ˆÂ§22.7ï¼‰ã€‚

### 46.16 æ­£åˆ™è¡¨è¾¾å¼æ ‡å¿— `/g` å’Œ `/y`ï¼Œä»¥åŠå±æ€§ `.lastIndex`ï¼ˆé«˜çº§ï¼‰

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨æ­£åˆ™è¡¨è¾¾å¼æ ‡å¿— `/g` å’Œ `/y` çš„å·¥ä½œæ–¹å¼ä»¥åŠå®ƒä»¬å¦‚ä½•ä¾èµ–äºæ­£åˆ™è¡¨è¾¾å¼å±æ€§ `.lastIndex`ã€‚æˆ‘ä»¬è¿˜å°†å‘ç°ä¸€ä¸ªå…³äº `.lastIndex` çš„æœ‰è¶£ç”¨ä¾‹ï¼Œä½ å¯èƒ½è§‰å¾—å®ƒä»¤äººæƒŠè®¶ã€‚

#### 46.16.1 æ­£åˆ™è¡¨è¾¾å¼æ ‡å¿— `/g` å’Œ `/y`

æ¯ä¸ªæ–¹æ³•å¯¹ `/g` å’Œ `/y` çš„ååº”éƒ½ä¸åŒï¼›è¿™ç»™æˆ‘ä»¬ä¸€ä¸ªå¤§è‡´çš„ä¸€èˆ¬æ¦‚å¿µï¼š

+   `/g`ï¼ˆ`.global`ï¼ŒES3ï¼‰ï¼šæ­£åˆ™è¡¨è¾¾å¼åº”è¯¥å¤šæ¬¡åŒ¹é…ï¼Œåœ¨å­—ç¬¦ä¸²çš„ä»»ä½•ä½ç½®ã€‚

+   `/y`ï¼ˆ`.sticky`ï¼ŒES6ï¼‰ï¼šå­—ç¬¦ä¸²å†…çš„ä»»ä½•åŒ¹é…åº”ç«‹å³è·Ÿåœ¨å…ˆå‰çš„åŒ¹é…ä¹‹åï¼ˆåŒ¹é…â€œç²˜â€åœ¨ä¸€èµ·ï¼‰ã€‚

å¦‚æœæ­£åˆ™è¡¨è¾¾å¼æ—¢æ²¡æœ‰ `/g` æ ‡å¿—ä¹Ÿæ²¡æœ‰ `/y` æ ‡å¿—ï¼ŒåŒ¹é…åªä¼šå‘ç”Ÿä¸€æ¬¡ï¼Œå¹¶ä»å¼€å§‹å¤„å¼€å§‹ã€‚

æ— è®ºä½¿ç”¨ `/g` è¿˜æ˜¯ `/y`ï¼ŒåŒ¹é…éƒ½æ˜¯ç›¸å¯¹äºè¾“å…¥å­—ç¬¦ä¸²å†…éƒ¨çš„â€œå½“å‰ä½ç½®â€è¿›è¡Œçš„ã€‚è¯¥ä½ç½®å­˜å‚¨åœ¨æ­£åˆ™è¡¨è¾¾å¼å±æ€§ `.lastIndex` ä¸­ã€‚

æœ‰ä¸‰ç»„ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸å…³çš„æ–¹æ³•ï¼š

1.  å­—ç¬¦ä¸²æ–¹æ³• `.search(regExp)` å’Œ `.split(regExp)` å®Œå…¨å¿½ç•¥ `/g` å’Œ `/y`ï¼ˆä»¥åŠå› æ­¤çš„ `.lastIndex`ï¼‰ã€‚

1.  å½“è®¾ç½®äº† `/g` æˆ– `/y` æ—¶ï¼Œ`RegExp` æ–¹æ³• `.exec(str)` å’Œ `.test(str)` ä¼šå‘ç”Ÿå˜åŒ–ã€‚

    é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡é‡å¤è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ¥è·å–å¤šä¸ªåŒ¹é…ï¼Œæ¯æ¬¡è°ƒç”¨ï¼Œå®ƒè¿”å›å¦ä¸€ä¸ªç»“æœï¼ˆä¸€ä¸ªåŒ¹é…å¯¹è±¡æˆ– `true`ï¼‰æˆ–â€œç»“æœç»“æŸâ€å€¼ï¼ˆ`null` æˆ– `false`ï¼‰ã€‚

    ç¬¬äºŒï¼Œæ­£åˆ™è¡¨è¾¾å¼å±æ€§ `.lastIndex` ç”¨äºéå†è¾“å…¥å­—ç¬¦ä¸²ã€‚ä¸€æ–¹é¢ï¼Œ`.lastIndex` å†³å®šäº†åŒ¹é…çš„èµ·å§‹ä½ç½®ï¼š

    +   `/g` è¡¨ç¤ºåŒ¹é…å¿…é¡»ä» `.lastIndex` æˆ–ä¹‹åå¼€å§‹ã€‚

    +   `/y` è¡¨ç¤ºåŒ¹é…å¿…é¡»ä» `.lastIndex` å¼€å§‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„å¼€å§‹è¢«é”šå®šåˆ° `.lastIndex`ã€‚

        æ³¨æ„ï¼Œ`^` å’Œ `$` ä»ç„¶åƒå¾€å¸¸ä¸€æ ·å·¥ä½œï¼šå®ƒä»¬å°†åŒ¹é…é”šå®šåˆ°è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹æˆ–ç»“æŸï¼Œé™¤éè®¾ç½®äº† `.multiline`ã€‚ç„¶åå®ƒä»¬é”šå®šåˆ°è¡Œé¦–æˆ–è¡Œå°¾ã€‚

    å¦ä¸€æ–¹é¢ï¼Œ`.lastIndex` è¢«è®¾ç½®ä¸ºä¸Šä¸€ä¸ªåŒ¹é…çš„æœ€åç´¢å¼•åŠ ä¸€ã€‚

1.  å‰©ä½™çš„æ–¹æ³•åŒ…æ‹¬ï¼š

    +   å­—ç¬¦ä¸²æ–¹æ³• `.match(regExp)` å’Œ `.matchAll(regExp)`ï¼ˆä¸ä½¿ç”¨ `/g`ï¼‰

    +   å­—ç¬¦ä¸²æ–¹æ³• `.replace(regExp, str)` å’Œ `.replaceAll(regExp, str)`ï¼ˆå¦‚æœæ²¡æœ‰ `/g` åˆ™æŠ›å‡ºå¼‚å¸¸ï¼‰

    è¿™äº›æ–¹æ³•éƒ½å—åˆ°å½±å“å¦‚ä¸‹ï¼š

    +   `/g` å¯¼è‡´å¤šä¸ªåŒ¹é…é¡¹ã€‚

    +   `/y` å¯¼è‡´ä¸€ä¸ªå¿…é¡»ä» `.lastIndex` å¼€å§‹çš„å•ä¸ªåŒ¹é…é¡¹ã€‚

    +   `/gy` å¯¼è‡´æ²¡æœ‰é—´éš”çš„å¤šä¸ªåŒ¹é…é¡¹ã€‚

è¿™åªæ˜¯ä¸€ä¸ªåˆæ­¥æ¦‚è¿°ã€‚æ¥ä¸‹æ¥çš„ç« èŠ‚å°†æ›´æ·±å…¥åœ°æ¢è®¨ã€‚

#### 46.16.2â€ƒ/g å’Œ /y å¦‚ä½•å…·ä½“å½±å“æ–¹æ³•ï¼Ÿ

ä»¥ä¸‹æ–¹æ³•ä¸å— `/g` å’Œ `/y` çš„å½±å“ï¼š

+   `string.search(regExp)`

+   `string.split(regExp)`

##### 46.16.2.1â€ƒ`string.match(regExp)` (ES3)

åœ¨æ²¡æœ‰ `/g` å’Œ `/y` çš„æƒ…å†µä¸‹ï¼Œ`.match()` ä¼šå¿½ç•¥ `.lastIndex` å¹¶å§‹ç»ˆè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„åŒ¹é…å¯¹è±¡ã€‚

```js
> const re = /#/; re.lastIndex = 1;
> ['##-#'.match(re), re.lastIndex]
[{ 0: '#', index: 0, input: '##-#' }, 1]
> ['##-#'.match(re), re.lastIndex]
[{ 0: '#', index: 0, input: '##-#' }, 1]

```

ä½¿ç”¨ `/y` æ—¶ï¼ŒåŒ¹é…å¿…é¡»æ­£å¥½ä» `.lastIndex` å¼€å§‹ã€‚`.lastIndex` å°†è¢«æ›´æ–°ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…é¡¹ï¼Œåˆ™è¿”å› `null`ã€‚

```js
> const re = /#/y; re.lastIndex = 1;
> ['##-#'.match(re), re.lastIndex]
[{ 0: '#', index: 1, input: '##-#' }, 2]
> ['##-#'.match(re), re.lastIndex]
[null, 0]

```

ä½¿ç”¨ `/g` æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰åŒ¹é…é¡¹ï¼ˆç»„ 0ï¼‰ã€‚`.lastIndex` è¢«å¿½ç•¥å¹¶é‡ç½®ä¸ºé›¶ã€‚

```js
> const re = /#/g; re.lastIndex = 1;
> '##-#'.match(re)
['#', '#', '#']
> re.lastIndex
0

```

`/gy` çš„è¡Œä¸ºä¸ `/g` ç±»ä¼¼ï¼Œä½†åŒ¹é…é¡¹ä¹‹é—´ä¸å…è®¸æœ‰é—´éš”ï¼š

```js
> const re = /#/gy; re.lastIndex = 1;
> '##-#'.match(re)
['#', '#']
> re.lastIndex
0

```

##### 46.16.2.2â€ƒ`string.matchAll(regExp)` (ES2020)

å¦‚æœæ²¡æœ‰è®¾ç½® `/g`ï¼Œ`.matchAll()` ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š

```js
> const re = /#/y; re.lastIndex = 1;
> '##-#'.matchAll(re)
TypeError: String.prototype.matchAll called with
a non-global RegExp argument

```

å¦‚æœè®¾ç½®äº† `/g`ï¼ŒåŒ¹é…å°†ä» `.lastIndex` å¼€å§‹ï¼Œå¹¶ä¸”è¯¥å±æ€§ä¸ä¼šæ”¹å˜ï¼š

```js
> const re = /#/g; re.lastIndex = 1;
> Array.from('##-#'.matchAll(re))
[
  { 0: '#', index: 1, input: '##-#' },
  { 0: '#', index: 3, input: '##-#' },
]
> re.lastIndex
1

```

`/gy` çš„è¡Œä¸ºä¸ `/g` ç±»ä¼¼ï¼Œä½†åŒ¹é…é¡¹ä¹‹é—´ä¸å…è®¸æœ‰é—´éš”ï¼š

```js
> const re = /#/gy; re.lastIndex = 1;
> Array.from('##-#'.matchAll(re))
[
  { 0: '#', index: 1, input: '##-#' },
]
> re.lastIndex
1

```

##### 46.16.2.3â€ƒ`regExp.exec(str)` (ES3)

åœ¨æ²¡æœ‰ `/g` å’Œ `/y` çš„æƒ…å†µä¸‹ï¼Œ`.exec()` ä¼šå¿½ç•¥ `.lastIndex` å¹¶å§‹ç»ˆè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„åŒ¹é…å¯¹è±¡ï¼š

```js
> const re = /#/; re.lastIndex = 1;
> [re.exec('##-#'), re.lastIndex]
[{ 0: '#', index: 0, input: '##-#' }, 1]
> [re.exec('##-#'), re.lastIndex]
[{ 0: '#', index: 0, input: '##-#' }, 1]

```

ä½¿ç”¨ `/g` æ—¶ï¼ŒåŒ¹é…å¿…é¡»ä» `.lastIndex` æˆ–ä¹‹åå¼€å§‹ã€‚`.lastIndex` å°†è¢«æ›´æ–°ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…é¡¹ï¼Œåˆ™è¿”å› `null`ã€‚

```js
> const re = /#/g; re.lastIndex = 1;
> [re.exec('##-#'), re.lastIndex]
[{ 0: '#', index: 1, input: '##-#' }, 2]
> [re.exec('##-#'), re.lastIndex]
[{ 0: '#', index: 3, input: '##-#' }, 4]
> [re.exec('##-#'), re.lastIndex]
[null, 0]

```

ä½¿ç”¨ `/y` æ—¶ï¼ŒåŒ¹é…å¿…é¡»æ­£å¥½ä» `.lastIndex` å¼€å§‹ã€‚`.lastIndex` å°†è¢«æ›´æ–°ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…é¡¹ï¼Œåˆ™è¿”å› `null`ã€‚

```js
> const re = /#/y; re.lastIndex = 1;
> [re.exec('##-#'), re.lastIndex]
[{ 0: '#', index: 1, input: '##-#' }, 2]
> [re.exec('##-#'), re.lastIndex]
[null, 0]

```

ä½¿ç”¨ `/gy` æ—¶ï¼Œ`.exec()` çš„è¡Œä¸ºä¸ä½¿ç”¨ `/y` æ—¶ç›¸åŒã€‚

##### 46.16.2.4â€ƒ`string.replace(regExp, str)` (ES3)

åœ¨æ²¡æœ‰ `/g` å’Œ `/y` çš„æƒ…å†µä¸‹ï¼Œåªæ›¿æ¢ç¬¬ä¸€ä¸ªå‡ºç°ï¼š

```js
> const re = /#/; re.lastIndex = 1;
> '##-#'.replace(re, 'x')
'x#-#'
> re.lastIndex
1

```

ä½¿ç”¨ `/g` æ—¶ï¼Œå°†æ›¿æ¢æ‰€æœ‰å‡ºç°ã€‚`.lastIndex` è¢«å¿½ç•¥ä½†é‡ç½®ä¸ºé›¶ã€‚

```js
> const re = /#/g; re.lastIndex = 1;
> '##-#'.replace(re, 'x')
'xx-x'
> re.lastIndex
0

```

ä½¿ç”¨ `/y` æ—¶ï¼Œåªæ›¿æ¢ `.lastIndex` å¤„çš„ï¼ˆç¬¬ä¸€ä¸ªï¼‰å‡ºç°ã€‚`.lastIndex` å°†è¢«æ›´æ–°ã€‚

```js
> const re = /#/y; re.lastIndex = 1;
> '##-#'.replace(re, 'x')
'#x-#'
> re.lastIndex
2

```

`/gy` çš„è¡Œä¸ºç±»ä¼¼äº `/g`ï¼Œä½†åŒ¹é…é¡¹ä¹‹é—´ä¸å…è®¸æœ‰é—´éš”ï¼š

```js
> const re = /#/gy; re.lastIndex = 1;
> '##-#'.replace(re, 'x')
'xx-#'
> re.lastIndex
0

```

##### 46.16.2.5â€ƒ`string.replaceAll(regExp, str)` (ES2021)

`.replaceAll()` çš„è¡Œä¸ºç±»ä¼¼äº `.replace()`ï¼Œä½†å¦‚æœæœªè®¾ç½® `/g`ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š

```js
> const re = /#/y; re.lastIndex = 1;
> '##-#'.replaceAll(re, 'x')
TypeError: String.prototype.replaceAll called
with a non-global RegExp argument

```

##### 46.16.2.6â€ƒ`regExp.test(str)` (ES3)

æ­¤æ–¹æ³•çš„è¡Œä¸ºä¸ `.exec()` ç›¸åŒï¼Œä½†è¿”å› `true` è€Œä¸æ˜¯åŒ¹é…å¯¹è±¡ï¼Œè¿”å› `null` è€Œä¸æ˜¯ `false`ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ²¡æœ‰ `/g` æˆ– `/y`ï¼Œç»“æœæ€»æ˜¯ `true`ï¼š

```js
> const re = /#/; re.lastIndex = 1;
> [re.test('##-#'), re.lastIndex]
[true, 1]
> [re.test('##-#'), re.lastIndex]
[true, 1]

```

ä½¿ç”¨ `/g` æ—¶ï¼Œæœ‰ä¸¤ä¸ªåŒ¹é…é¡¹ï¼š

```js
> const re = /#/g; re.lastIndex = 1;
> [re.test('##-#'), re.lastIndex]
[true, 2]
> [re.test('##-#'), re.lastIndex]
[true, 4]
> [re.test('##-#'), re.lastIndex]
[false, 0]

```

ä½¿ç”¨ `/y` æ—¶ï¼Œåªæœ‰ä¸€ä¸ªåŒ¹é…é¡¹ï¼š

```js
> const re = /#/y; re.lastIndex = 1;
> [re.test('##-#'), re.lastIndex]
[true, 2]
> [re.test('##-#'), re.lastIndex]
[false, 0]

```

ä½¿ç”¨ `/gy` æ—¶ï¼Œ`.test()` çš„è¡Œä¸ºä¸ `/y` ç›¸åŒã€‚

#### 46.16.3â€ƒ/g å’Œ /y çš„å››ä¸ªé™·é˜±åŠå…¶å¤„ç†æ–¹æ³•

æˆ‘ä»¬å°†é¦–å…ˆæ¢è®¨ `/g` å’Œ `/y` çš„å››ä¸ªé™·é˜±ï¼Œç„¶åæ¢è®¨å¤„ç†è¿™äº›é™·é˜±çš„æ–¹æ³•ã€‚

##### 46.16.3.1â€ƒé™·é˜± 1ï¼šæˆ‘ä»¬æ— æ³•å°†å¸¦æœ‰ `/g` æˆ– `/y` çš„æ­£åˆ™è¡¨è¾¾å¼å†…è”

å¸¦æœ‰ `/g` çš„æ­£åˆ™è¡¨è¾¾å¼ä¸èƒ½å†…è”ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ `while` å¾ªç¯ä¸­ï¼Œæ¯æ¬¡æ£€æŸ¥æ¡ä»¶æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å› æ­¤ï¼Œå…¶ `.lastIndex` æ€»æ˜¯é›¶ï¼Œå¾ªç¯æ°¸è¿œä¸ä¼šç»ˆæ­¢ã€‚

```js
let matchObj;
// Infinite loop
while (matchObj = /a+/g.exec('bbbaabaaa')) {
  console.log(matchObj[0]);
}

```

ä½¿ç”¨ `/y` æ—¶ï¼Œé—®é¢˜ç›¸åŒã€‚

##### 46.16.3.2â€ƒé™·é˜± 2ï¼šç§»é™¤ `/g` æˆ– `/y` å¯èƒ½ä¼šç ´åä»£ç 

å¦‚æœä»£ç æœŸæœ›ä¸€ä¸ªå¸¦æœ‰ `/g` çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªéå† `.exec()` æˆ– `.test()` ç»“æœçš„å¾ªç¯ï¼Œé‚£ä¹ˆæ²¡æœ‰ `/g` çš„æ­£åˆ™è¡¨è¾¾å¼å¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯ï¼š

```js
function collectMatches(regExp, str) {
  const matches = [];
  let matchObj;
  // Infinite loop
  while (matchObj = regExp.exec(str)) {
    matches.push(matchObj[0]);
  }
  return matches;
}
collectMatches(/a+/, 'bbbaabaaa'); // Missing: flag /g

```

ä¸ºä»€ä¹ˆä¼šæœ‰æ— é™å¾ªç¯ï¼Ÿå› ä¸º `.exec()` æ€»æ˜¯è¿”å›ç¬¬ä¸€ä¸ªç»“æœï¼Œä¸€ä¸ªåŒ¹é…å¯¹è±¡ï¼Œè€Œä¸ä¼šè¿”å› `null`ã€‚

ä½¿ç”¨ `/y` æ—¶ï¼Œé—®é¢˜ç›¸åŒã€‚

##### 46.16.3.3â€ƒé™·é˜± 3ï¼šæ·»åŠ  `/g` æˆ– `/y` å¯èƒ½ä¼šç ´åä»£ç 

ä½¿ç”¨ `.test()` æ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼šå®ƒä¼šå—åˆ° `.lastIndex` çš„å½±å“ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç²¾ç¡®åœ°æ£€æŸ¥ä¸€æ¬¡æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦ä¸å­—ç¬¦ä¸²åŒ¹é…ï¼Œé‚£ä¹ˆæ­£åˆ™è¡¨è¾¾å¼å¿…é¡»æ²¡æœ‰ `/g`ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬é€šå¸¸æ¯æ¬¡è°ƒç”¨ `.test()` éƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœï¼š

```js
> const regExp = /^X/g;
> [regExp.test('Xa'), regExp.lastIndex]
[ true, 1 ]
> [regExp.test('Xa'), regExp.lastIndex]
[ false, 0 ]
> [regExp.test('Xa'), regExp.lastIndex]
[ true, 1 ]

```

ç¬¬ä¸€æ¬¡è°ƒç”¨ä¼šäº§ç”Ÿä¸€ä¸ªåŒ¹é…å¹¶æ›´æ–° `.lastIndex`ã€‚ç¬¬äºŒæ¬¡è°ƒç”¨æ‰¾ä¸åˆ°åŒ¹é…å¹¶é‡ç½® `.lastIndex` ä¸ºé›¶ã€‚

å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äº `.test()` çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¸ä¼šæ·»åŠ  `/g`ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ›¿æ¢å’Œæµ‹è¯•ï¼Œé‚£ä¹ˆé‡åˆ° `/g` çš„å¯èƒ½æ€§ä¼šå¢åŠ ã€‚

å†æ¬¡å¼ºè°ƒï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå­˜åœ¨äº `/y` ä¸Šï¼š

```js
> const regExp = /^X/y;
> regExp.test('Xa')
true
> regExp.test('Xa')
false
> regExp.test('Xa')
true

```

##### 46.16.3.4â€ƒé™·é˜± 4ï¼šå¦‚æœ `.lastIndex` ä¸æ˜¯é›¶ï¼Œä»£ç å¯èƒ½ä¼šäº§ç”Ÿæ„å¤–çš„ç»“æœ

å¦‚æœä¸€ä¸ªæ“ä½œä½¿ç”¨äº†å— `.lastIndex` å½±å“çš„æ­£åˆ™è¡¨è¾¾å¼æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»ç¡®ä¿ `.lastIndex` åœ¨å¼€å§‹æ—¶ä¸ºé›¶ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¾—åˆ°æ„å¤–çš„ç»“æœï¼š

```js
function countMatches(regExp, str) {
  let count = 0;
  while (regExp.test(str)) {
    count++;
  }
  return count;
}

const myRegExp = /a/g;
myRegExp.lastIndex = 4;
assert.equal(
  countMatches(myRegExp, 'babaa'), 1 // should be 3
);

```

é€šå¸¸ï¼Œ`.lastIndex` åœ¨æ–°åˆ›å»ºçš„æ­£åˆ™è¡¨è¾¾å¼ä¸­ä¸ºé›¶ï¼Œæˆ‘ä»¬ä¸ä¼šåƒåœ¨ä¾‹å­ä¸­é‚£æ ·æ˜¾å¼åœ°æ›´æ”¹å®ƒã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¤šæ¬¡ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œ`.lastIndex` ä»ç„¶å¯èƒ½ä¸æ˜¯é›¶ã€‚

##### 46.16.3.5â€ƒå¦‚ä½•é¿å… `/g` å’Œ `/y` çš„é™·é˜±

ä½œä¸ºå¤„ç† `/g` å’Œ `.lastIndex` çš„ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹å‰ä¸€ä¸ªä¾‹å­ä¸­çš„ `countMatches()`ã€‚æˆ‘ä»¬å¦‚ä½•é˜²æ­¢é”™è¯¯çš„æ­£åˆ™è¡¨è¾¾å¼ç ´åæˆ‘ä»¬çš„ä»£ç ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹ä¸‰ç§æ–¹æ³•ã€‚

###### 46.16.3.5.1â€ƒæŠ›å‡ºå¼‚å¸¸

é¦–å…ˆï¼Œå¦‚æœ `/g` æ²¡æœ‰è®¾ç½®æˆ– `.lastIndex` ä¸æ˜¯é›¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼š

```js
function countMatches(regExp, str) {
  if (!regExp.global) {
    throw new Error('Flag /g of regExp must be set');
  }
  if (regExp.lastIndex !== 0) {
    throw new Error('regExp.lastIndex must be zero');
  }

  let count = 0;
  while (regExp.test(str)) {
    count++;
  }
  return count;
}

```

###### 46.16.3.5.2â€ƒå…‹éš†æ­£åˆ™è¡¨è¾¾å¼

å…¶æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥å…‹éš†å‚æ•°ã€‚è¿™è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„ä¼˜ç‚¹ï¼Œå³ `regExp` ä¸ä¼šæ”¹å˜ã€‚

```js
function countMatches(regExp, str) {
  const cloneFlags = regExp.flags + (regExp.global ? '' : 'g');
  const clone = new RegExp(regExp, cloneFlags);

  let count = 0;
  while (clone.test(str)) {
    count++;
  }
  return count;
}

```

###### 46.16.3.5.3â€ƒä½¿ç”¨ä¸å— `.lastIndex` æˆ–æ ‡å¿—å½±å“çš„æ“ä½œ

å‡ ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ“ä½œä¸å— `.lastIndex` æˆ–æ ‡å¿—çš„å½±å“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå­˜åœ¨ `/g`ï¼Œ`.match()` ä¼šå¿½ç•¥ `.lastIndex`ï¼š

```js
function countMatches(regExp, str) {
  if (!regExp.global) {
    throw new Error('Flag /g of regExp must be set');
  }
  return (str.match(regExp) ?? []).length;
}

const myRegExp = /a/g;
myRegExp.lastIndex = 4;
assert.equal(countMatches(myRegExp, 'babaa'), 3); // OK!

```

åœ¨è¿™é‡Œï¼Œ`countMatches()` å³ä½¿æ²¡æœ‰æ£€æŸ¥æˆ–ä¿®å¤ `.lastIndex` ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚

#### 46.16.4 ä½¿ç”¨ `.lastIndex` çš„ç”¨ä¾‹ï¼šä»ç»™å®šç´¢å¼•å¼€å§‹åŒ¹é…

é™¤äº†åœ¨å¤šæ¬¡åŒ¹é…æ—¶å­˜å‚¨å½“å‰ä½ç½®å¤–ï¼Œ`.lastIndex` è¿˜å¯ä»¥ç”¨äºï¼š

+   åœ¨ç»™å®šä½ç½®ç²¾ç¡®åŒ¹é…ä¸€æ¬¡ï¼ˆé€šè¿‡æ ‡å¿— `/y`ï¼‰

+   åœ¨ç»™å®šä½ç½®æˆ–ä¹‹ååŒ¹é…ä¸€æ¬¡ï¼ˆé€šè¿‡æ ‡å¿— `/g`ï¼‰

æˆ‘ä»¬æ¥ä¸‹æ¥å°†æŸ¥çœ‹ç¤ºä¾‹ã€‚

##### 46.16.4.1 ç¤ºä¾‹ï¼šæ£€æŸ¥æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦åœ¨ç»™å®šç´¢å¼•å¤„åŒ¹é…

ç”±äº `.test()` å— `/y` å’Œ `.lastIndex` çš„å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ£€æŸ¥æ­£åˆ™è¡¨è¾¾å¼ `regExp` æ˜¯å¦åœ¨ç»™å®šçš„ `index` å¤„ä¸å­—ç¬¦ä¸² `str` åŒ¹é…ï¼š

```js
function startsWith(regExp, str, index) {
  if (!regExp.sticky || regExp.global) {
    throw new Error('Flag /y must be set. Flag /g must not be set.');
  }
  regExp.lastIndex = index;
  return regExp.test(str);
}
assert.equal(
  startsWith(/x+/y, 'aaxxx', 0), false
);
assert.equal(
  startsWith(/x+/y, 'aaxxx', 2), true
);

```

ç”±äº `/y`ï¼Œ`regExp` é”šå®šåˆ° `.lastIndex`ã€‚

æ³¨æ„ï¼Œæˆ‘ä»¬ä¸å¾—ä½¿ç”¨æ–­è¨€ `^`ï¼Œè¿™å°†ä½¿ `regExp` é”šå®šåˆ°è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ã€‚

##### 46.16.4.2 ç¤ºä¾‹ï¼šä»ç»™å®šç´¢å¼•å¼€å§‹æŸ¥æ‰¾åŒ¹é…ä½ç½®

`.search()` å…è®¸æˆ‘ä»¬æ‰¾åˆ°æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„ä½ç½®ï¼š

```js
> '#--#'.search(/#/)
0

```

å¯æƒœï¼Œæˆ‘ä»¬æ— æ³•æ›´æ”¹ `.search()` å¼€å§‹æŸ¥æ‰¾åŒ¹é…çš„ä½ç½®ã€‚ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `.exec()` è¿›è¡Œæœç´¢ï¼š

```js
function searchFrom(regExp, str, index) {
  if (!regExp.global || regExp.sticky) {
    throw new Error('Flag /g must be set. Flag /y must not be set.');
  }
  regExp.lastIndex = index;
  const match = regExp.exec(str);
  if (match) {
    return match.index;
  } else {
    return -1;
  }
}

assert.equal(
  searchFrom(/#/g, '#--#', 0), 0
);
assert.equal(
  searchFrom(/#/g, '#--#', 1), 3
);

```

##### 46.16.4.3 ç¤ºä¾‹ï¼šåœ¨ç»™å®šç´¢å¼•å¤„æ›¿æ¢å‡ºç°

å½“æ²¡æœ‰ `/g` å¹¶ä¸”æœ‰ `/y` æ—¶ï¼Œ`.replace()` ä¼šè¿›è¡Œä¸€æ¬¡æ›¿æ¢â€”â€”å¦‚æœ `.lastIndex` å¤„æœ‰åŒ¹é…é¡¹ï¼š

```js
function replaceOnceAt(str, regExp, replacement, index) {
  if (!regExp.sticky || regExp.global) {
    throw new Error('Flag /y must be set. Flag /g must not be set.');
  }
  regExp.lastIndex = index;
  return str.replace(regExp, replacement);
}
assert.equal(
  replaceOnceAt('aa aaaa a', /a+/y, 'X', 0), 'X aaaa a')
;
assert.equal(
  replaceOnceAt('aa aaaa a', /a+/y, 'X', 3), 'aa X a'
);
assert.equal(
  replaceOnceAt('aa aaaa a', /a+/y, 'X', 8), 'aa aaaa X'
);

```

#### 46.16.5 `.lastIndex` çš„ç¼ºç‚¹å’Œä¼˜ç‚¹

æ­£åˆ™è¡¨è¾¾å¼å±æ€§ `.lastIndex` æœ‰ä¸¤ä¸ªæ˜¾è‘—çš„ç¼ºç‚¹ï¼š

+   è¿™ä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼å…·æœ‰çŠ¶æ€ï¼š

    +   æˆ‘ä»¬ç°åœ¨å¿…é¡»æ³¨æ„æ­£åˆ™è¡¨è¾¾å¼çš„çŠ¶æ€ä»¥åŠæˆ‘ä»¬å¦‚ä½•å…±äº«å®ƒä»¬ã€‚

    +   å¯¹äºè®¸å¤šç”¨ä¾‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½é€šè¿‡å†»ç»“æ¥ä½¿å®ƒä»¬ä¸å¯å˜ã€‚

+   `.lastIndex` åœ¨æ­£åˆ™è¡¨è¾¾å¼æ“ä½œä¸­çš„æ”¯æŒä¸ä¸€è‡´ã€‚

ä¼˜ç‚¹æ˜¯ï¼Œ`.lastIndex` ä¹Ÿæä¾›äº†é¢å¤–çš„æœ‰ç”¨åŠŸèƒ½ï¼šæˆ‘ä»¬å¯ä»¥æŒ‡å®šåŒ¹é…åº”è¯¥å¼€å§‹çš„ä½ç½®ï¼ˆå¯¹äºæŸäº›æ“ä½œï¼‰ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™ç§åŠŸèƒ½åº”è¯¥é€šè¿‡ä¸€ä¸ªæ–­è¨€å¦‚ `\G`ï¼ˆä¸æ ‡å¿— `/y` ç›¸æ¯”ï¼‰ä»¥åŠä½œä¸ºå„ç§æ­£åˆ™è¡¨è¾¾å¼ç›¸å…³æ–¹æ³•çš„å‚æ•°çš„ç´¢å¼•ï¼ˆä¸æ­£åˆ™è¡¨è¾¾å¼å±æ€§ `.lastIndex` ç›¸æ¯”ï¼‰æ¥æä¾›ã€‚ä½†æ€»æ¯”æ²¡æœ‰å¥½ã€‚

### 46.17 `RegExp.escape()`ï¼šè½¬ä¹‰æ–‡æœ¬ä»¥ä¾¿åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨ (ES2025)

å¯¹äºå­—ç¬¦ä¸² `text`ï¼Œ`RegExp.escape(text)` åˆ›å»ºä¸€ä¸ªä¸ `text` åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ã€‚

åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å…·æœ‰ç‰¹æ®Šæ„ä¹‰çš„å­—ç¬¦ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œå¿…é¡»è¿›è¡Œè½¬ä¹‰ï¼š

```js
> RegExp.escape('(*)')
'\\(\\*\\)'

```

æ³¨æ„ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼åæ–œæ éƒ½å‡ºç°äº†ä¸¤æ¬¡ï¼šå…¶ä¸­ä¸€ä¸ªæ˜¯å®é™…çš„åæ–œæ ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨å­—ç¬¦ä¸²å­—é¢é‡ä¸­å°†å…¶è½¬ä¹‰ï¼š

```js
> '\\(\\*\\)' === String.raw`\(\*\)`
true

```

æ²¡æœ‰ç‰¹æ®Šæ„ä¹‰çš„å­—ç¬¦ä¸éœ€è¦è½¬ä¹‰ï¼š

```js
> RegExp.escape('_abc123')
'_abc123'

```

#### 46.17.1 `RegExp.escape()` çš„ç”¨ä¾‹ï¼šæ›¿æ¢æ‰€æœ‰æ–‡æœ¬çš„å‡ºç°

è½¬ä¹‰çš„ç»å…¸ç”¨ä¾‹æ˜¯æœç´¢å’Œæ›¿æ¢æ–‡æœ¬ï¼š

```js
function replacePlainText(str, searchText, replace) {
  const searchRegExp = new RegExp(
    RegExp.escape(searchText),
    'gu'
  );
  return str.replace(searchRegExp, replace)
}
assert.equal(
  replacePlainText('(a) and (a)', '(a)', '@'),
  '@ and @'
);

```

ç„¶è€Œï¼Œè‡ª ES2021 ä»¥æ¥ï¼Œæˆ‘ä»¬æœ‰äº† `.replaceAll()`ï¼š

```js
assert.equal(
  '(a) and (a)'.replaceAll('(a)', '@'),
  '@ and @'
);

```

#### 46.17.2 `RegExp.escape()` çš„ç”¨ä¾‹ï¼šæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†å¿…é¡»åŒ¹é…ç»™å®šçš„æ–‡æœ¬

ä»¥ä¸‹ä»£ç ç§»é™¤äº† `str` ä¸­æ‰€æœ‰æœªå¼•ç”¨çš„ `text` å‡ºç°ï¼š

```js
function removeUnquotedText(str, text) {
  const regExp = new RegExp(
    `(?<!â€œ)${RegExp.escape(text)}(?!â€)`,
    'gu'
  );
  return str.replaceAll(regExp, 'â€¢');
}
assert.equal(
  removeUnquotedText('â€œyesâ€ and yes and â€œyesâ€', 'yes'),
  'â€œyesâ€ and â€¢ and â€œyesâ€'
);

```

åŒæ ·çš„æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨æ¥æŸ¥æ‰¾æˆ–è®¡æ•°æœªå¼•ç”¨çš„æ–‡æœ¬ã€‚

![å›¾æ ‡â€œç»ƒä¹ â€](img/4fc2ec98bb44cc1f4de7c6a46d9dd043.png) **ç»ƒä¹ ï¼šæœç´¢åŒ…å«é€šé…ç¬¦çš„æ–‡æœ¬**

âœ… `exercises/regexps/includes-with-elision_test.mjs`

### 46.18 åŒ¹é…æ‰€æœ‰æˆ–æ— å†…å®¹

æœ‰æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€ä¸ªåŒ¹é…æ‰€æœ‰æˆ–æ— å†…å®¹çš„æ­£åˆ™è¡¨è¾¾å¼ - ä¾‹å¦‚ï¼Œä½œä¸ºé»˜è®¤å€¼ã€‚

+   åŒ¹é…æ‰€æœ‰å†…å®¹ï¼š`/(?:)/`

    ç©ºç»„ `()` åŒ¹é…æ‰€æœ‰å†…å®¹ã€‚æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºéæ•è·ç»„ï¼ˆé€šè¿‡ `?:`ï¼‰ï¼Œä»¥é¿å…ä¸å¿…è¦çš„æ“ä½œã€‚

    ```js
    > /(?:)/.test('')
    true
    > /(?:)/.test('abc')
    true

    ```

+   åŒ¹é…æ— å†…å®¹ï¼š`/.^/`

    `^` ä»…åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ã€‚ç‚¹å·å°†åŒ¹é…æ‰©å±•åˆ°ç¬¬ä¸€ä¸ªå­—ç¬¦ä¹‹å¤–ï¼Œç°åœ¨ `^` ä¸å†åŒ¹é…ã€‚

    ```js
    > /.^/.test('')
    false
    > /.^/.test('abc')
    false

    ```

æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡ä¸èƒ½ä¸ºç©ºï¼Œå› ä¸º `//` å¼€å§‹äº†ä¸€ä¸ªå•è¡Œæ³¨é‡Šã€‚å› æ­¤ï¼Œåœ¨å½“å‰æƒ…å†µä¸‹ï¼Œä½¿ç”¨å‰ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç¬¬ä¸€ä¸ªï¼š

```js
> new RegExp('')
/(?:)/

```

### 46.19 ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›´æ˜“äºä½¿ç”¨çš„æŠ€å·§

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨æˆ‘ä»¬å¯ä»¥ä½¿æ­£åˆ™è¡¨è¾¾å¼æ›´å®¹æ˜“ä½¿ç”¨çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ä½œä¸ºç¤ºä¾‹ï¼š

```js
const RE_API_SIGNATURE =
  /^(new |get )?([A-Za-z0-9_.\[\]]+)/;

```

ç›®å‰ï¼Œå®ƒä»ç„¶ç›¸å½“æ™¦æ¶©ã€‚ä¸€æ—¦æˆ‘ä»¬åˆ°è¾¾â€œä¸é‡è¦çš„ç©ºç™½â€ï¼Œå®ƒå°†æ›´å®¹æ˜“ç†è§£ã€‚

#### 46.19.1 æç¤ºï¼šä½¿ç”¨æ ‡å¿— `/v`

å¦‚æœæˆ‘ä»¬åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ·»åŠ æ ‡å¿— `/v`ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°æ›´å°‘çš„æ€ªå¼‚è¡Œä¸ºå’Œæ›´å¤šåŠŸèƒ½ï¼š

```js
const RE_API_SIGNATURE =
  /^(new |get )?([A-Za-z0-9_.\[\]]+)/v;

```

`/v` åœ¨è¿™ä¸ªç‰¹å®šæƒ…å†µä¸‹æ²¡æœ‰æ”¹å˜ä»»ä½•ä¸œè¥¿ï¼Œä½†å®ƒæœ‰åŠ©äºæˆ‘ä»¬åœ¨æ·»åŠ å…·æœ‰å¤šä¸ªä»£ç ç‚¹çš„å›¾å½¢ç¾¤é›†æˆ–æƒ³è¦å­—ç¬¦ç±»ä¸­çš„é›†åˆè¿ç®—ç­‰åŠŸèƒ½æ—¶ã€‚

#### 46.19.2 æç¤ºï¼šæŒ‰å­—æ¯é¡ºåºæ’åºæ ‡å¿—

å¦‚æœæœ‰å¤šä¸ªæ ‡å¿—ï¼Œæˆ‘ä»¬åº”è¯¥ æŒ‰å­—æ¯é¡ºåºæ’åºæ ‡å¿— - ä¾‹å¦‚ï¼š

```js
/pattern/giv

```

è¿™æ ·å¯ä»¥ä½¿é¡ºåºä¸€è‡´ï¼Œè¿™ä¹Ÿæ˜¯ JavaScript æ˜¾ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼ï¼š

```js
> String(/pattern/vgi)
'/pattern/giv'

```

#### 46.19.3 æç¤ºï¼šä½¿ç”¨å‘½åæ•è·ç»„

æˆ‘ä»¬çš„æ­£åˆ™è¡¨è¾¾å¼åŒ…å«ä¸¤ä¸ªä½ç½®æ•è·ç»„ã€‚å¦‚æœæˆ‘ä»¬ç»™å®ƒä»¬å‘½åï¼Œå®ƒä»¬å°†æè¿°å…¶ç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦çš„é¢å¤–æ–‡æ¡£æ›´å°‘ï¼š

```js
const RE_API_SIGNATURE =
  /^(?<prefix>new |get )?(?<name>[A-Za-z0-9_.\[\]]+)/;

```

#### 46.19.4 æç¤ºï¼šé€šè¿‡ `#` ä½¿ç”¨ä¸é‡è¦çš„ç©ºç™½å’Œè¡Œæ³¨é‡Š

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä»ç„¶ç›¸å½“éš¾ä»¥é˜…è¯»ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ç©ºæ ¼å’Œæ¢è¡Œç¬¦æ¥æ”¹å˜è¿™ä¸€ç‚¹ã€‚ç”±äºæ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡ä¸å…è®¸æˆ‘ä»¬è¿™æ ·åšï¼Œæˆ‘ä»¬ä½¿ç”¨åº“ [Regex+](https://github.com/slevithan/regex)ï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†æ¨¡æ¿æ ‡ç­¾ `regex`ï¼š

```js
import {regex} from 'regex';

const RE_API_SIGNATURE = regex`
 ^
 (?<prefix>
 new \x20  # constructor
 |
 get \x20  # getter
 )?
 (?<name>
 # Square brackets are needed for symbol keys
 [
 A-Z a-z 0-9 _
 .
 \[ \]
 ]+
 )
`;

```

æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­å¿½ç•¥ç©ºç™½çš„åŠŸèƒ½è¢«ç§°ä¸º**ä¸é‡è¦çš„ç©ºç™½**ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº†ä¸€ä¸ªåä¸º**å†…è”æ³¨é‡Š**çš„åŠŸèƒ½â€”â€”å®ƒä»¥äº•å·ç¬¦å·ï¼ˆ`#`ï¼‰å¼€å§‹ã€‚

ä¸¤ä¸ªè§‚å¯Ÿç»“æœï¼š

+   ç”±äºæ‰€æœ‰ç©ºæ ¼éƒ½è¢«ç§»é™¤ï¼Œæˆ‘ä»¬ä½¿ç”¨åå…­è¿›åˆ¶è½¬ä¹‰ç¬¦ `\x20` æ¥è¡¨ç¤ºåœ¨ `new` å’Œ `get` ä¹‹åæœ‰ä¸€ä¸ªç©ºæ ¼ã€‚

+   å¾ˆé—æ†¾ï¼Œè¡Œæ³¨é‡Šä¸å…è®¸åœ¨å­—ç¬¦ç±»å†…éƒ¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå…³äºæ–¹æ‹¬å·çš„æ³¨é‡Šåœ¨å­—ç¬¦ç±»ä¹‹å‰ã€‚

åœ¨æœªæ¥ï¼ŒJavaScript å¯èƒ½ä¼šé€šè¿‡æ ‡å¿— `/x`ï¼ˆ[ECMAScript ææ¡ˆ](https://github.com/tc39/proposal-regexp-x-mode)ï¼‰å†…ç½®å¯¹ä¸é‡è¦çš„ç©ºç™½çš„æ”¯æŒã€‚

ä½¿ç”¨ `regex` æ¨¡æ¿æ ‡ç­¾ï¼Œä»¥ä¸‹æ ‡å¿—å§‹ç»ˆå¤„äºæ´»åŠ¨çŠ¶æ€ï¼š

+   æ ‡å¿— `/v`

+   æ ‡å¿— `/x`ï¼ˆæ¨¡æ‹Ÿï¼‰é€šè¿‡ `#` å¯ç”¨ä¸é‡è¦çš„ç©ºç™½å’Œè¡Œæ³¨é‡Šã€‚

+   æ ‡å¿— `/n`ï¼ˆæ¨¡æ‹Ÿï¼‰å¯ç”¨**ä»…å‘½åæ•è·æ¨¡å¼**ï¼Œè¿™é˜²æ­¢äº†ç¼–å·ç»„è¿›è¡Œæ•è·ã€‚æ¢å¥è¯è¯´ï¼šï¼ˆæ¨¡å¼ï¼‰è¢«å¤„ç†æˆï¼ˆ?:æ¨¡å¼ï¼‰ã€‚

#### 46.19.5 æç¤ºï¼šä¸ºæ‚¨çš„æ­£åˆ™è¡¨è¾¾å¼ç¼–å†™æµ‹è¯•

ä¸ºäº†ç¡®ä¿æ­£åˆ™è¡¨è¾¾å¼æŒ‰é¢„æœŸå·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¶ç¼–å†™æµ‹è¯•ã€‚è¿™äº›æ˜¯é’ˆå¯¹ `RE_API_SIGNATURE` çš„æµ‹è¯•ï¼š

```js
assert.deepEqual(
  getCaptures(`get Map.prototype.size`),
  {
    prefix: 'get ',
    name: 'Map.prototype.size',
  }
);
assert.deepEqual(
  getCaptures(`new Array(len = 0)`),
  {
    prefix: 'new ',
    name: 'Array',
  }
);
assert.deepEqual(
  getCaptures(`Array.prototype.push(...items)`),
  {
    prefix: undefined,
    name: 'Array.prototype.push',
  }
);
assert.deepEqual(
  getCaptures(`Map.prototype[Symbol.iterator]()`),
  {
    prefix: undefined,
    name: 'Map.prototype[Symbol.iterator]',
  }
);

function getCaptures(apiSignature) {
  const match = RE_API_SIGNATURE.exec(apiSignature);
  // Spread so that the result does not have a null prototype
  // and is easier to compare.
  return {...match.groups};
}

```

#### 46.19.6 æç¤ºï¼šåœ¨æ‚¨çš„æ–‡æ¡£ä¸­æåŠç¤ºä¾‹

çœ‹åˆ°åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œæœ‰åŠ©äºç†è§£æ­£åˆ™è¡¨è¾¾å¼åº”è¯¥åšä»€ä¹ˆï¼š

```js
/**
 * Matches API signatures â€“ e.g.:
 * ```

* `get Map.prototype.size`

* `new Array(len = 0)`

* `Array.prototype.push(...items)`

* `Map.prototype[Symbol.iterator]()`

* ```js
 */
const RE_API_SIGNATURE = regex`
 Â·Â·Â·
`;

```

ä¸€äº›æ–‡æ¡£å·¥å…·å…è®¸æˆ‘ä»¬åœ¨æ–‡æ¡£æ³¨é‡Šä¸­å¼•ç”¨å•å…ƒæµ‹è¯•ï¼Œå¹¶åœ¨æ–‡æ¡£ä¸­æ˜¾ç¤ºå®ƒä»¬çš„ä»£ç ã€‚è¿™æ¯”æˆ‘ä»¬ä¸Šé¢æ‰€åšçš„æ˜¯ä¸€ç§å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚

#### 46.19.7 å¥–åŠ±æç¤ºï¼šä½¿ç”¨æ’å€¼æ¥é‡ç”¨æ¨¡å¼

Regex+ åº“å…è®¸æˆ‘ä»¬æ’å€¼æ­£åˆ™è¡¨è¾¾å¼ç‰‡æ®µï¼ˆâ€œæ¨¡å¼â€ï¼‰ï¼Œè¿™æœ‰åŠ©äºé‡ç”¨ã€‚ä»¥ä¸‹ç¤ºä¾‹å®šä¹‰äº†ä¸€ç§ç®€å•çš„æ ‡è®°è¯­æ³•ï¼Œå®ƒè®©äººè”æƒ³åˆ° HTMLï¼š

```js
import { pattern, regex } from 'regex';

const LABEL = pattern`[a-z\-]+`;
const ARGS = pattern`
 (?<args>
 \x20+
 ${LABEL}
 )*
`;
const NAME = pattern`
 (?<name> ${LABEL} )
`;

const TAG = regex`
 (?<openingTag>
 \[
 \x20*
 ${NAME}
 ${ARGS}
 \x20*
 \]
 )
 |
 (?<singletonTag>
 \[
 \x20*
 ${NAME}
 ${ARGS}
 \x20*
 / \]
 )
`;

assert.deepEqual(
  TAG.exec('[pre js line-numbers]').groups,
  {
    openingTag: '[pre js line-numbers]',
    name: 'pre',
    args: ' line-numbers',
    singletonTag: undefined,
    __proto__: null,
  }
);

assert.deepEqual(
  TAG.exec('[hr /]').groups,
  {
    openingTag: undefined,
    name: 'hr',
    args: undefined,
    singletonTag: '[hr /]',
    __proto__: null,
  }
);

```

æ­£åˆ™è¡¨è¾¾å¼ `TAG` ä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ç‰‡æ®µ `NAME` å’Œ `ARGS` ä¸¤æ¬¡â€”â€”è¿™å‡å°‘äº†å†—ä½™ã€‚

#### 46.19.8 å¥–åŠ±æç¤ºï¼šæ— éœ€åº“çš„ä¸é‡è¦ç©ºç™½

é€šè¿‡ä»¥ä¸‹æŠ€å·§ï¼Œæˆ‘ä»¬ä¸éœ€è¦åº“å°±å¯ä»¥ç¼–å†™å…·æœ‰ä¸é‡è¦çš„ç©ºç™½æ ¼å¼çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š

```js
const RE_API_SIGNATURE = new RegExp(
  String.raw`
 ^
 (?<prefix>
 new \x20
 |
 get \x20
 )?
 (?<name>
 [
 A-Z a-z 0-9 _
 .
 \[ \]
 ]+
 )
 `.replaceAll(/\s+/g, ''), // (A)
  'v'
);
assert.equal(
  String(RE_API_SIGNATURE),
  String.raw`/^(?<prefix>new\x20|get\x20)?(?<name>[A-Za-z0-9_.\[\]]+)/v`
);

```

è¿™æ®µä»£ç æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

+   String.raw å¯ç”¨ä¸¤ä»¶äº‹ï¼š

    +   æˆ‘ä»¬ä¸éœ€è¦ä¸ºè¿™ç§å­—ç¬¦ä¸²å­—é¢é‡è½¬ä¹‰æ­£åˆ™è¡¨è¾¾å¼åæ–œæ ã€‚

    +   æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥è·¨è¶Šå¤šè¡Œã€‚

+   `.replaceAll()` ç§»é™¤æ‰€æœ‰ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ï¼‰ï¼Œä½¿å¾—æœ€ç»ˆç»“æœçœ‹èµ·æ¥å‡ ä¹ä¸æ­£åˆ™è¡¨è¾¾å¼çš„åˆå§‹ç‰ˆæœ¬ç›¸åŒã€‚ä¸è¿‡æœ‰ä¸€ä¸ªåŒºåˆ«ï¼šç”±äºå­—é¢ç©ºæ ¼è¢«ç§»é™¤ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æ‰¾åˆ°ä¸€ç§ä¸åŒçš„æ–¹å¼æ¥æŒ‡å®š `new` å’Œ `get` åé¢æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚ä¸€ä¸ªé€‰é¡¹æ˜¯åå…­è¿›åˆ¶è½¬ä¹‰ç¬¦ `\x20`ï¼šåå…­è¿›åˆ¶ 20ï¼ˆåè¿›åˆ¶ 32ï¼‰æ˜¯ç©ºæ ¼çš„ä»£ç ç‚¹ã€‚

æˆ‘ä»¬ç”šè‡³å¯ä»¥åƒè¿™æ ·æ¨¡æ‹Ÿå†…è”æ³¨é‡Šï¼š

```js
// Template tag function
const cmt = () => '';
const RE = new RegExp(
 String.raw`
 a+ ${cmt`one or more as`}
 `.replaceAll(/\s+/g, ''),
 'v'
);
assert.equal(
 String(RE), '/a+/v'
);

```

å¾ˆé—æ†¾ï¼Œå®ƒçš„è¯­æ³•æ¯”æˆ‘æƒ³çš„è¦å¤æ‚ã€‚

#### 46.19.9â€ƒç»“è®ºï¼šè¿™æ˜¯æ­£åˆ™è¡¨è¾¾å¼åº”è¯¥è¢«ç¼–å†™çš„æ–¹å¼

è®¸å¤šäººä¸å–œæ¬¢æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªåŸå› å°±æ˜¯å®ƒä»¬å‘ç°æ­£åˆ™è¡¨è¾¾å¼éš¾ä»¥é˜…è¯»ã€‚ç„¶è€Œï¼Œåœ¨ä¸é‡è¦çš„ç©ºç™½å’Œæ³¨é‡Šçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé—®é¢˜å°±å°å¾—å¤šã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼çš„æ­£ç¡®æ–¹å¼ï¼šæƒ³æƒ³å¦‚æœæ²¡æœ‰ç©ºç™½å’Œæ³¨é‡Šï¼ŒJavaScript ä»£ç ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚

### 46.20â€ƒå¿«é€Ÿå‚è€ƒï¼šæ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½

#### 46.20.1â€ƒæ€»ç»“ï¼š`.global` (`/g`) å’Œ `.sticky` (`/y`)

ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•å®Œå…¨ä¸å— `/g` å’Œ `/y` çš„å½±å“ï¼š

+   `String.prototype.search()`

+   `String.prototype.split()`

æ­¤è¡¨è§£é‡Šäº†å‰©ä½™çš„æ­£åˆ™è¡¨è¾¾å¼ç›¸å…³æ–¹æ³•å¦‚ä½•å—è¿™ä¸¤ä¸ªæ ‡å¿—çš„å½±å“ï¼ˆå¦‚æœæ—¢æ²¡æœ‰ `/g` ä¹Ÿæ²¡æœ‰ `/y`ï¼Œåˆ™ `regExp.lastIndex` æ€»æ˜¯ä¼šè¢«å¿½ç•¥ï¼‰ï¼š

|  | æ ‡å¿— | å°Šé‡ `.lastIndex`ï¼Ÿ | æ›´æ–° `.lastIndex`ï¼Ÿ |
| --- | --- | --- | --- |
| `s.match` | `/y` | âœ” | âœ” |
|  | `/g /gy` | âœ˜ | 0 |
| `s.matchAll` | `/g /gy` | âœ” | âœ˜ |
| `r.exec` | `/g /y /gy` | âœ” | âœ” |
| `s.replace` | `/y` | âœ” | âœ” |
|  | `/g /gy` | âœ˜ | 0 |
| `s.replaceAll` | `/g /gy` | âœ˜ | 0 |
| `r.test` | `/g /y /gy` | âœ” | âœ” |

![å›¾æ ‡â€œå¤–éƒ¨â€](img/38e6ff55e8d602659f3cdb8893e63f62.png)â€‚**æ›´é•¿çš„æ¦‚è¿°**

æˆ‘åœ¨ç½‘ä¸Šå‘å¸ƒäº†ä¸€ä¸ªæ›´é•¿çš„è¡¨æ ¼ï¼ˆ[a longer table](https://gist.github.com/rauschma/5c90e6c19923611521a61e199d8cb15b)ï¼‰ï¼Œè¯¥è¡¨æ ¼æ˜¯é€šè¿‡ Node.js è„šæœ¬åˆ›å»ºçš„ã€‚

#### 46.20.2â€ƒ`String.prototype.*`: åŒ¹é…å’Œæœç´¢

+   `String.prototype.match(regExpOrString)`

    ES3 | `/y` å°Šé‡å¹¶æ›´æ–° `.lastIndex` | `/g /gy` å¿½ç•¥å¹¶é‡ç½® `.lastIndex`

    +   (1 of 3) `regExpOrString` æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

        å¦‚æœ `regExpOrString` æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæ²¡æœ‰ `/g` çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼ˆæƒ³æƒ³ `new RegExp()` çš„å‚æ•°ï¼‰ã€‚è¯¥æ­£åˆ™è¡¨è¾¾å¼å°†æŒ‰ä¸‹ä¸€é¡¹ä¸­æ‰€è¿°ä½¿ç”¨ã€‚

    +   (2 of 3) `regExpOrString` æ˜¯ä¸€ä¸ªæ²¡æœ‰ `/g` çš„ RegExpã€‚

        ```js
        match(
          regExpOrString: string | RegExp
        ): null | RegExpMatchArray

        interface RegExpMatchArray extends Array<string> {
          index: number;
          input: string;
          groups: undefined | {
            [key: string]: string
          };
        }

        ```

        å¦‚æœ `regExpOrString` æ˜¯ä¸€ä¸ªæ²¡æœ‰è®¾ç½® `/g` æ ‡å¿—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆ `.match()` è¿”å›å­—ç¬¦ä¸²ä¸­ `regExpOrString` çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…é¡¹ï¼Œåˆ™è¿”å› `null`ã€‚

        +   ç¼–å·æ•è·ç»„æˆä¸ºæ•°ç»„å…ƒç´ ï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ `RegExpMatchArray` æ‰©å±•äº† `Array`ï¼‰ã€‚

        +   å‘½åæ•è·ç»„^(ES2018) æˆä¸º `.groups` çš„å±æ€§ã€‚

        ç¤ºä¾‹ï¼š

        ```js
        > 'ababb'.match(/a(b+)/)
        { 0: 'ab', 1: 'b', index: 0, input: 'ababb', groups: undefined }
        > 'ababb'.match(/a(?<bs>b+)/)
        { 0: 'ab', 1: 'b', index: 0, input: 'ababb', groups: { bs: 'b' } }
        > 'abab'.match(/x/)
        null

        ```

    +   (3 of 3) `regExpOrString` æ˜¯å¸¦æœ‰ `/g` çš„ RegExpã€‚

        ```js
        match(
          regExpOrString: RegExp
        ): null | Array<string>

        ```

        å¦‚æœ `regExpOrString` çš„ `/g` æ ‡å¿—è¢«è®¾ç½®ï¼Œ`.match()` è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰åŒ¹é…é¡¹çš„æ•°ç»„æˆ–å¦‚æœæ²¡æœ‰åŒ¹é…é¡¹ï¼Œåˆ™è¿”å› `null`ã€‚

        ```js
        > 'ababb'.match(/a(b+)/g)
        [ 'ab', 'abb' ]
        > 'ababb'.match(/a(?<bs>b+)/g)
        [ 'ab', 'abb' ]
        > 'abab'.match(/x/g)
        null

        ```

+   `String.prototype.matchAll(regExp)`

    ES2020 | `/g /gy` å°Šé‡å¹¶ä¿ç•™ `.lastIndex`

    ```js
    matchAll(regexp: RegExp): Iterator<RegExpExecArray>
    interface RegExpMatchArray extends Array<string> {
      index: number;
      input: string;
      groups: undefined | {
        [key: string]: string
      };
    }

    ```

    +   å¦‚æœæ²¡æœ‰è®¾ç½®æ ‡å¿— `/g`ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

    +   è¿”å›é›¶ä¸ªæˆ–å¤šä¸ªåŒ¹é…çš„è¿­ä»£å™¨ã€‚æ¯ä¸ªåŒ¹é…é¡¹ï¼š

        +   ç¼–å·æ•è·ç»„æˆä¸ºæ•°ç»„å…ƒç´ ï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ `RegExpMatchArray` æ‰©å±• `Array`ï¼‰ã€‚ 

        +   å‘½åæ•è·ç»„ ^ (ES2018) æˆä¸º `.groups` çš„å±æ€§ã€‚

    ç¤ºä¾‹ï¼š

    ```js
    > 'yes'.matchAll(/(y|s)/gv).toArray()
    [
      { 0: 'y', 1: 'y', index: 0, input: 'yes', groups: undefined },
      { 0: 's', 1: 's', index: 2, input: 'yes', groups: undefined },
    ]

    ```

+   `String.prototype.search(regExpOrString)`

    ES3 | å¿½ç•¥ `.lastIndex`

    è¿”å› `regExpOrString` åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°çš„ç´¢å¼•ã€‚å¦‚æœ `regExpOrString` æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒè¢«ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ˆæƒ³æƒ³ `new RegExp()` çš„å‚æ•°ï¼‰ã€‚

    ```js
    > 'a2b'.search(/[0-9]/)
    1
    > 'a2b'.search('[0-9]')
    1

    ```

#### 46.20.3â€ƒ`String.prototype.*`: åˆ†å‰²å’Œæ›¿æ¢

+   `String.prototype.split(separator, limit?)`

    ES3 | å¿½ç•¥ `.lastIndex`

    ```js
    split(separator: string | RegExp, limit?: number): Array<string>

    ```

    åˆ†éš”ç¬¦å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå®ƒè¢«è§£é‡Šä¸ºçº¯æ–‡æœ¬ï¼Œè€Œä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼‰æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚

    ç¤ºä¾‹ï¼š

    ```js
    // Splitting with a string
    assert.deepEqual(
      'a.b.c'.split('.'),
      [ 'a', 'b', 'c' ]
    );

    // Splitting with a regular expression
    assert.deepEqual(
      'a x:yyy b'.split(/x+:y+/),
      [ 'a ', ' b' ]
    );

    // Group captures appear in the result
    assert.deepEqual(
      'a x:yyy b'.split(/(x+):(y+)/),
      [ 'a ', 'x', 'yyy', ' b' ]
    );

    ```

    å¦‚æœæˆ‘ä»¬å¸Œæœ›åˆ†éš”ç¬¦æˆä¸ºè¿”å›çš„å­—ç¬¦ä¸²ç‰‡æ®µçš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦æœ‰ å‘åæŸ¥æ‰¾æ–­è¨€ æˆ– å‘å‰æŸ¥æ‰¾æ–­è¨€ çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š

    ```js
    > 'a: b: c'.split(/(?<=:) */)
    [ 'a:', 'b:', 'c' ]
    > 'a :b :c'.split(/ *(?=:)/)
    [ 'a', ':b', ':c' ]

    ```

    **é™·é˜±**ï¼š`.split('')` å°†åˆ†å‰²æˆ JavaScript å­—ç¬¦ï¼Œä½†é€šå¸¸æˆ‘ä»¬å¸Œæœ›åˆ†å‰²æˆå›¾å½¢ç°‡æˆ–è‡³å°‘ Unicode ä»£ç ç‚¹ã€‚å› æ­¤ï¼Œæœ€å¥½ä½¿ç”¨ `Array.from()` æˆ– `Intl.Segmenter` è¿›è¡Œåˆ†å‰²ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… â€œæ–‡æœ¬çš„åŸå­ï¼šä»£ç ç‚¹ã€JavaScript å­—ç¬¦ã€å›¾å½¢ç°‡â€ï¼ˆÂ§22.7ï¼‰ã€‚

+   `String.prototype.replace(searchValue, replaceValue)`

    ES3 | `/y` å°Šé‡å¹¶æ›´æ–° `.lastIndex` | `/g /gy` å¿½ç•¥å¹¶é‡ç½® `.lastIndex`

    å…³äºæ­¤æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æœ¬ç« å‰é¢çš„ å…¶éƒ¨åˆ†ã€‚

    +   (1 of 2) `searchValue` æ˜¯æ²¡æœ‰ `/g` çš„å­—ç¬¦ä¸²æˆ– RegExpã€‚

        ```js
        replace(
          searchValue: string | RegExp,
          replaceValue: string | (...args: any[]) => string
        ): string

        ```

        ä¸ `.replaceAll()` çš„å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼Œä½†åªæ›¿æ¢ç¬¬ä¸€ä¸ªå‡ºç°ï¼š

        ```js
        > 'x.x.'.replace('.', '#') // interpreted literally
        'x#x.'
        > 'x.x.'.replace(/./, '#')
        '#.x.'

        ```

    +   (1 of 2) `searchValue` æ˜¯å¸¦æœ‰ `/g` çš„ RegExpã€‚

        ```js
        replace(
          searchValue: RegExp,
          replaceValue: string | (...args: any[]) => string
        ): string

        ```

        ä¸ `.replaceAll()` å®Œå…¨ç›¸åŒï¼š

        ```js
        > 'x.x.'.replace(/./g, '#')
        '####'
        > 'x.x.'.replace(/\./g, '#')
        'x#x#'

        ```

+   `String.prototype.replaceAll(searchValue, replaceValue)`

    ES2021 | `/g /gy` å¿½ç•¥å¹¶é‡ç½® `.lastIndex`

    +   (1 of 2) `replaceValue` æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

        ```js
        replaceAll(
          searchValue: string | RegExp,
          replaceValue: string
        ): string

        ```

        å°† `searchValue` çš„æ‰€æœ‰åŒ¹é…é¡¹æ›¿æ¢ä¸º `replaceValue`ã€‚å¦‚æœ `searchValue` æ˜¯æ²¡æœ‰ `/g` æ ‡å¿—çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™æŠ›å‡º `TypeError`ã€‚

        ```js
        > 'x.x.'.replaceAll('.', '#') // interpreted literally
        'x#x#'
        > 'x.x.'.replaceAll(/./g, '#')
        '####'
        > 'x.x.'.replaceAll(/./, '#')
        TypeError: String.prototype.replaceAll called with
        a non-global RegExp argument

        ```

        `replaceValue` ä¸­çš„ç‰¹æ®Šå­—ç¬¦åŒ…æ‹¬ï¼š

        +   `$$`: å˜æˆ `$`

        +   `$n`: å˜æˆç¼–å·ç»„ `n` çš„æ•è·ï¼ˆé—æ†¾çš„æ˜¯ï¼Œ`$0` ä»£è¡¨å­—ç¬¦ä¸² `'$0'`ï¼Œå®ƒä¸æŒ‡å‘å®Œæ•´åŒ¹é…ï¼‰

        +   `$&`: å˜æˆå®Œæ•´åŒ¹é…

        +   `` $` ``: å˜æˆåŒ¹é…é¡¹ä¹‹å‰çš„å†…å®¹

        +   `$'`: å˜æˆåŒ¹é…é¡¹ä¹‹åçš„å†…å®¹

        +   `$<name>` å˜æˆå‘½åç»„ `name` çš„æ•è·

    +   (2 of 2) `replaceValue` æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚

        ```js
        replaceAll(
          searchValue: string | RegExp,
          replaceValue: (...args: any[]) => string
        ): string

        ```

        å¦‚æœç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™å‡ºç°è¢«å…¶è¿”å›çš„å­—ç¬¦ä¸²æ›¿æ¢ã€‚å…¶å‚æ•° `args` æ˜¯ï¼š

        +   `matched: string`. å®Œæ•´åŒ¹é…

        +   `g1: string|undefined`ã€‚ç¼–å·ç»„ 1 çš„æ•è·

        +   `g2: string|undefined`ã€‚ç¼–å·ç»„ 2 çš„æ•è·

        +   (ç­‰ç­‰ã€‚)

        +   `offset: number`ã€‚åŒ¹é…åœ¨è¾“å…¥å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ï¼Ÿ

        +   `input: string`ã€‚æ•´ä¸ªè¾“å…¥å­—ç¬¦ä¸²

        ```js
        const regexp = /([0-9]{2})\.([0-9]{4})/g;
        const replacer = (all, month, year) => `|${year}-${month}|`;
        assert.equal(
          'a 12.1995 b'.replaceAll(regexp, replacer),
          'a |1995-12| b'
        );

        ```

        å‘½åæ•è·ç»„ (ES2018) ä¹Ÿå—æ”¯æŒã€‚å¦‚æœæœ‰ï¼Œåˆ™ä¼šåœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¯¥å¯¹è±¡çš„å±æ€§åŒ…å«æ•è·ï¼š

        ```js
        const regexp = /(?<month>[0-9]{2})\.(?<year>[0-9]{4})/g;
        const replacer = (...args) => {
          const groups = args.at(-1);
          return `|${groups.year}-${groups.month}|`;
        };
        assert.equal(
          'a 12.1995 b'.replaceAll(regexp, replacer),
          'a |1995-12| b'
        );

        ```

#### 46.20.4â€ƒ`RegExp.prototype.*`

+   `RegExp.prototype.test(string)`

    ES3 | `/g /y /gy` å°Šé‡å¹¶æ›´æ–° `.lastIndex`

    ```js
    test(string: string): boolean

    ```

    å¦‚æœæ¥æ”¶å™¨ä¸ `string` åŒ¹é…ï¼Œåˆ™è¿”å› `true`ï¼š

    ```js
    > /^# /.test('# comment')
    true
    > /^# /.test('#comment')
    false
    > /^# /.test('abc')
    false

    ```

    **é™·é˜±ï¼š** ä¸è¦ä½¿ç”¨å¸¦æœ‰æ ‡å¿— `/g` çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ç„¶å `regExp.test()` å°†ä» `regExp.lastIndex` å¼€å§‹åŒ¹é…ï¼Œå¹¶æ›´æ–°è¯¥å±æ€§ã€‚

+   `RegExp.prototype.exec(string)`

    ES3 | `/g /y /gy` å°Šé‡å¹¶æ›´æ–° `.lastIndex`

    +   (1 of 2) æ¥æ”¶å™¨æ˜¯ä¸€ä¸ªæ²¡æœ‰ `/g` çš„ RegExpã€‚

        æ²¡æœ‰æ ‡å¿— `/g`ï¼Œ`regExp.exec(string)` çš„è¡Œä¸ºç±»ä¼¼äº `string.match(regExp)`ï¼ˆ#qref-String.prototype.matchï¼‰ - å®ƒè¿”å›ä¸€ä¸ªå•ç‹¬çš„åŒ¹é…å¯¹è±¡ã€‚

    +   (2 of 2) æ¥æ”¶å™¨æ˜¯ä¸€ä¸ªå¸¦æœ‰ `/g` çš„ RegExpã€‚

        ```js
        exec(string: string): RegExpExecArray | null

        interface RegExpExecArray extends Array<string> {
          index: number;
          input: string;
          groups: undefined | {
            [key: string]: string
          };
        }

        ```

        å¦‚æœ `regExp` æœ‰æ ‡å¿— `/g`ï¼Œåˆ™ `regExp.exec(str)` è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä» `regExp.lastIndex` å¼€å§‹çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ - å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…é¡¹ï¼Œåˆ™è¿”å› `null`ã€‚å®ƒè¿˜ä¼šæ›´æ–° `regExp.lastIndex`ï¼Œä½¿å…¶æŒ‡å‘åŒ¹é…ä¹‹åçš„ç´¢å¼•ã€‚

        +   ç¼–å·æ•è·ç»„æˆä¸ºæ•°ç»„å…ƒç´ ï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ `RegExpExecArray` æ‰©å±•äº† `Array`ï¼‰ã€‚

        +   å‘½åæ•è·ç»„ (ES2018) æˆä¸º `.groups` çš„å±æ€§ã€‚

        ç¤ºä¾‹ï¼š

        ```js
        > const regExp = /(a+)b/g, str = 'ab aab';

        > regExp.exec(str)
        {0: 'ab', 1: 'a', index: 0, input: 'ab aab', groups: undefined}
        > regExp.lastIndex
        2

        > regExp.exec(str)
        {0: 'aab', 1: 'aa', index: 3, input: 'ab aab', groups: undefined}
        > regExp.lastIndex
        6

        > regExp.exec(str)
        null
        > regExp.lastIndex
        0

        ```
