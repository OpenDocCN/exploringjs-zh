<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>11 Assertion API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>11 Assertion API</h1>
<blockquote>原文：<a href="https://exploringjs.com/js/book/ch_assertion-api.html">https://exploringjs.com/js/book/ch_assertion-api.html</a></blockquote>

        
    
    
    
<nav class="local-toc">
  <ol>
    <li>
      <a href="#assertions-in-software-development">11.1 Assertions in software development</a>
    </li>
    <li>
      <a href="#how-assertions-are-used-in-this-book">11.2 How assertions are used in this book</a>
      <ol>
        <li>
          <a href="#documenting-results-in-code-examples-via-assertions">11.2.1 Documenting results in code examples via assertions</a>
        </li>
        <li>
          <a href="#implementing-testdriven-exercises-via-assertions">11.2.2 Implementing test-driven exercises via assertions</a>
        </li>
      </ol>
    </li>
    <li>
      <a href="#normal-comparison-vs-deep-comparison">11.3 Normal comparison vs. deep comparison</a>
    </li>
    <li>
      <a href="#quick-reference-module-assert">11.4 Quick reference: module <code>assert</code></a>
      <ol>
        <li>
          <a href="#normal-equality-assertequal">11.4.1 Normal equality: <code>assert.equal()</code></a>
        </li>
        <li>
          <a href="#deep-equality-assertdeepequal">11.4.2 Deep equality: <code>assert.deepEqual()</code></a>
        </li>
        <li>
          <a href="#assert.throws">11.4.3 Expecting exceptions: <code>assert.throws()</code></a>
        </li>
        <li>
          <a href="#always-fail-assertfail">11.4.4 Always fail: <code>assert.fail()</code></a>
        </li>
      </ol>
    </li>
  </ol>
</nav>
<h3 id="assertions-in-software-development"><a class="heading-id-link" href="#assertions-in-software-development">11.1 Assertions in software development</a></h3>
<p><span id="index-entry-assertion"/></p>
<p>In software development, <em>assertions</em> state facts about values or pieces of code that must be true. If they aren’t, an exception is thrown. Node.js supports assertions via its built-in module <code>assert</code> – for example:</p>
<pre class="language-js">
<code><span class="hljs-keyword">import</span> assert <span class="hljs-keyword">from</span> <span class="hljs-string">'node:assert/strict'</span>;</code>
<code>assert.<span class="hljs-title function_">equal</span>(<span class="hljs-number">3</span> + <span class="hljs-number">5</span>, <span class="hljs-number">8</span>);</code>
</pre>
<p>This assertion states that the expected result of 3 plus 5 is 8. The import statement uses <a href="https://nodejs.org/api/assert.html#assert_strict_mode">the recommended <code>strict</code> version</a> of <code>assert</code>.</p>
<h3 id="how-assertions-are-used-in-this-book"><a class="heading-id-link" href="#how-assertions-are-used-in-this-book">11.2 How assertions are used in this book</a></h3>
<p>In this book, assertions are used in two ways: to document results in code examples and to implement test-driven exercises.</p>
<h4 id="documenting-results-in-code-examples-via-assertions"><a class="heading-id-link" href="#documenting-results-in-code-examples-via-assertions">11.2.1 Documenting results in code examples via assertions</a></h4>
<p>In code examples, assertions express expected results. Take, for example, the following function:</p>
<pre class="language-js">
<code><span class="hljs-keyword">function</span> <span class="hljs-title function_">id</span>(<span class="hljs-params">x</span>) {</code>
<code>  <span class="hljs-keyword">return</span> x;</code>
<code>}</code>
</pre>
<p><code>id()</code> returns its parameter. We can show it in action via an assertion:</p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">equal</span>(<span class="hljs-title function_">id</span>(<span class="hljs-string">'abc'</span>), <span class="hljs-string">'abc'</span>);</code>
</pre>
<p>In the examples, I usually omit the statement for importing <code>assert</code>.</p>
<p>The motivation behind using assertions is:</p>
<ul>
  <li>
    We can specify precisely what is expected.
  </li>
  <li>
    Code examples can be tested automatically, which ensures that they really work.
  </li>
</ul>
<h4 id="implementing-testdriven-exercises-via-assertions"><a class="heading-id-link" href="#implementing-testdriven-exercises-via-assertions">11.2.2 Implementing test-driven exercises via assertions</a></h4>
<p>The exercises for this book are test-driven, via the test framework Mocha. Checks inside the tests are made via methods of <code>assert</code>.</p>
<p>The following is an example of such a test:</p>
<pre class="language-js">
<code><span class="hljs-comment">// For the exercise, we must implement the function hello().</span></code>
<code><span class="hljs-comment">// The test checks if we have done it properly.</span></code>
<code><span class="hljs-title function_">test</span>(<span class="hljs-string">'First exercise'</span>, <span class="hljs-function">() =&gt;</span> {</code>
<code>  assert.<span class="hljs-title function_">equal</span>(<span class="hljs-title function_">hello</span>(<span class="hljs-string">'world'</span>), <span class="hljs-string">'Hello world!'</span>);</code>
<code>  assert.<span class="hljs-title function_">equal</span>(<span class="hljs-title function_">hello</span>(<span class="hljs-string">'Jane'</span>), <span class="hljs-string">'Hello Jane!'</span>);</code>
<code>  assert.<span class="hljs-title function_">equal</span>(<span class="hljs-title function_">hello</span>(<span class="hljs-string">'John'</span>), <span class="hljs-string">'Hello John!'</span>);</code>
<code>  assert.<span class="hljs-title function_">equal</span>(<span class="hljs-title function_">hello</span>(<span class="hljs-string">''</span>), <span class="hljs-string">'Hello !'</span>);</code>
<code>});</code>
</pre>
<p>For more information, see <a href="ch_exercises.html#ch_exercises">“Getting started with exercises” (§12)</a>.</p>
<h3 id="normal-comparison-vs-deep-comparison"><a class="heading-id-link" href="#normal-comparison-vs-deep-comparison">11.3 Normal comparison vs. deep comparison</a></h3>
<p>The strict <code>equal()</code> uses <code>===</code> to compare values. Therefore, an object is only equal to itself – even if another object has the same content (because <code>===</code> does not compare the contents of objects, only their identities):</p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">notEqual</span>({<span class="hljs-attr">foo</span>: <span class="hljs-number">1</span>}, {<span class="hljs-attr">foo</span>: <span class="hljs-number">1</span>});</code>
</pre>
<p><code>deepEqual()</code> is a better choice for comparing objects:</p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">deepEqual</span>({<span class="hljs-attr">foo</span>: <span class="hljs-number">1</span>}, {<span class="hljs-attr">foo</span>: <span class="hljs-number">1</span>});</code>
</pre>
<p>This method works for Arrays, too:</p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">notEqual</span>([<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>], [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]);</code>
<code>assert.<span class="hljs-title function_">deepEqual</span>([<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>], [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]);</code>
</pre>
<h3 id="quick-reference-module-assert"><a class="heading-id-link" href="#quick-reference-module-assert">11.4 Quick reference: module <code>assert</code></a></h3>
<p><span id="index-entry-assert--module-"/></p>
<p>For the full documentation, see <a href="https://nodejs.org/api/assert.html">the Node.js docs</a>.</p>
<h4 id="normal-equality-assertequal"><a class="heading-id-link" href="#normal-equality-assertequal">11.4.1 Normal equality: <code>assert.equal()</code></a></h4>
<ul>
  <li>
    <p><code id="qref-assert.equal">assert.equal(actual, expected, message?)</code></p>
    <p><code>actual === expected</code> must be <code>true</code>. If not, an <code>AssertionError</code> is thrown.</p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">equal</span>(<span class="hljs-number">3</span>+<span class="hljs-number">3</span>, <span class="hljs-number">6</span>);</code>
</pre>
  </li>
  <li>
    <p><code id="qref-assert.notEqual">assert.notEqual(actual, expected, message?)</code></p>
    <p><code>actual !== expected</code> must be <code>true</code>. If not, an <code>AssertionError</code> is thrown.</p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">notEqual</span>(<span class="hljs-number">3</span>+<span class="hljs-number">3</span>, <span class="hljs-number">22</span>);</code>
</pre>
  </li>
</ul>
<p>The optional last parameter <code>message</code> can be used to explain what is asserted. If the assertion fails, the message is used to set up the <code>AssertionError</code> that is thrown.</p>
<pre class="language-js">
<code><span class="hljs-keyword">let</span> e;</code>
<code><span class="hljs-keyword">try</span> {</code>
<code>  <span class="hljs-keyword">const</span> x = <span class="hljs-number">3</span>;</code>
<code>  assert.<span class="hljs-title function_">equal</span>(x, <span class="hljs-number">8</span>, <span class="hljs-string">'x must be 8'</span>)</code>
<code>} <span class="hljs-keyword">catch</span> (err) {</code>
<code>  assert.<span class="hljs-title function_">equal</span>(</code>
<code>    <span class="hljs-title class_">String</span>(err),</code>
<code>    <span class="hljs-string">'AssertionError [ERR_ASSERTION]: x must be 8\n\n3 !== 8\n'</span>);</code>
<code>}</code>
</pre>
<h4 id="deep-equality-assertdeepequal"><a class="heading-id-link" href="#deep-equality-assertdeepequal">11.4.2 Deep equality: <code>assert.deepEqual()</code></a></h4>
<ul>
  <li>
    <p><code id="qref-assert.deepEqual">assert.deepEqual(actual, expected, message?)</code></p>
    <p><code>actual</code> must be deeply equal to <code>expected</code>. If not, an <code>AssertionError</code> is thrown.</p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">deepEqual</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]);</code>
<code>assert.<span class="hljs-title function_">deepEqual</span>([], []);</code>
<code/>
<code><span class="hljs-comment">// To .equal(), an object is only equal to itself:</span></code>
<code>assert.<span class="hljs-title function_">notEqual</span>([], []);</code>
</pre>
  </li>
  <li>
    <p><code id="qref-assert.notDeepEqual">assert.notDeepEqual(actual, expected, message?)</code></p>
    <p><code>actual</code> must not be deeply equal to <code>expected</code>. If it is, an <code>AssertionError</code> is thrown.</p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">notDeepEqual</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]);</code>
</pre>
  </li>
</ul>
<h4 id="assert.throws"><a class="heading-id-link" href="#assert.throws">11.4.3 Expecting exceptions: <code>assert.throws()</code></a></h4>
<p>If we want to (or expect to) receive an exception, we need <code>assert.throws()</code>: This function calls its first parameter, the function <code>callback</code>, and only succeeds if it throws an exception. Additional parameters can be used to specify what that exception must look like.</p>
<ul>
  <li>
    <p><code>assert.throws(callback, message?): void</code></p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">throws</span>(</code>
<code>  <span class="hljs-function">() =&gt;</span> {</code>
<code>    <span class="hljs-literal">null</span>.<span class="hljs-property">prop</span>;</code>
<code>  }</code>
<code>);</code>
</pre>
  </li>
  <li>
    <p><code>assert.throws(callback, errorClass, message?): void</code></p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">throws</span>(</code>
<code>  <span class="hljs-function">() =&gt;</span> {</code>
<code>    <span class="hljs-literal">null</span>.<span class="hljs-property">prop</span>;</code>
<code>  },</code>
<code>  <span class="hljs-title class_">TypeError</span></code>
<code>);</code>
</pre>
  </li>
  <li>
    <p><code>assert.throws(callback, errorRegExp, message?): void</code></p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">throws</span>(</code>
<code>  <span class="hljs-function">() =&gt;</span> {</code>
<code>    <span class="hljs-literal">null</span>.<span class="hljs-property">prop</span>;</code>
<code>  },</code>
<code>  <span class="hljs-regexp">/^TypeError: Cannot read properties of null \(reading 'prop'\)$/</span></code>
<code>);</code>
</pre>
  </li>
  <li>
    <p><code>assert.throws(callback, errorObject, message?): void</code></p>
<pre class="language-js">
<code>assert.<span class="hljs-title function_">throws</span>(</code>
<code>  <span class="hljs-function">() =&gt;</span> {</code>
<code>    <span class="hljs-literal">null</span>.<span class="hljs-property">prop</span>;</code>
<code>  },</code>
<code>  {</code>
<code>    <span class="hljs-attr">name</span>: <span class="hljs-string">'TypeError'</span>,</code>
<code>    <span class="hljs-attr">message</span>: <span class="hljs-string">"Cannot read properties of null (reading 'prop')"</span>,</code>
<code>  }</code>
<code>);</code>
</pre>
  </li>
</ul>
<h4 id="always-fail-assertfail"><a class="heading-id-link" href="#always-fail-assertfail">11.4.4 Always fail: <code>assert.fail()</code></a></h4>
<ul>
  <li>
    <p><code id="qref-assert.fail">assert.fail(messageOrError?)</code></p>
    <p>By default, it throws an <code>AssertionError</code> when it is called. That is occasionally useful for unit testing. <code>messageOrError</code> can be:</p>
    <ul>
      <li>
        A string. That enables to override the default error message.
      </li>
      <li>
        An instance of <code>Error</code> (or a subclass). That enables us to throw a different value.
      </li>
    </ul>
<pre class="language-js">
<code><span class="hljs-keyword">try</span> {</code>
<code>  <span class="hljs-title function_">functionThatShouldThrow</span>();</code>
<code>  assert.<span class="hljs-title function_">fail</span>();</code>
<code>} <span class="hljs-keyword">catch</span> (_) {</code>
<code>  <span class="hljs-comment">// Success</span></code>
<code>}</code>
</pre>
  </li>
</ul>

    
      
</body>
</html>