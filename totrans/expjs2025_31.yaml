- en: 26 Exception handling
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://exploringjs.com/js/book/ch_exception-handling.html](https://exploringjs.com/js/book/ch_exception-handling.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[26.1 Motivation: throwing and catching exceptions](#motivation-throwing-and-catching-exceptions)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.2 `throw`](#throw)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.2.1 What values should we throw?](#what-values-should-we-throw)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.3 The `try` statement](#try-statement)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.3.1 The `try` block](#the-try-block)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.3.2 The `catch` clause](#the-catch-clause)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.3.3 The `finally` clause](#the-finally-clause)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.4 The superclass of all built-in exception classes: `Error`](#class-Error)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.4.1 `Error.prototype.name`](#errorprototypename)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.4.2 Error instance property `.message`](#error.message)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.4.3 Error instance property `.stack`](#error-stack)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.5 Chaining errors: the instance property `.cause` ^(ES2022)](#error-cause)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.5.1 Why would we want to chain errors?](#why-would-we-want-to-chain-errors)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.5.2 Should we store context data in `.cause`?](#should-we-store-context-data-in-cause)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.6 Subclasses of `Error`](#subclasses-of-error)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.6.1 The built-in subclasses of `Error`](#built-in-error-subclasses)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[26.6.2 Subclassing `Error`](#subclassing-error)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: This chapter covers how JavaScript handles exceptions.
  prefs: []
  type: TYPE_NORMAL
- en: '![Icon “details”](../Images/38ba63de820aae6f94a019538ae0f222.png) **Why doesn’t
    JavaScript throw exceptions more often?**'
  prefs: []
  type: TYPE_NORMAL
- en: JavaScript didn’t support exceptions until ES3\. That explains why they are
    used sparingly by the language and its standard library.
  prefs: []
  type: TYPE_NORMAL
- en: '[26.1 Motivation: throwing and catching exceptions](#motivation-throwing-and-catching-exceptions)'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Consider the following code. It reads profiles stored in files into an Array
    with instances of class `Profile`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Let’s examine what happens in line B: An error occurred, but the best place
    to handle the problem is not the current location, it’s line A. There, we can
    skip the current file and move on to the next one.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Therefore:'
  prefs: []
  type: TYPE_NORMAL
- en: In line B, we use a `throw` statement to indicate that there was a problem.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In line A, we use a `try-catch` statement to handle the problem.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'When we throw, the following constructs are active:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: One by one, `throw` exits the nested constructs, until it encounters a `try`
    statement. Execution continues in the `catch` clause of that `try` statement.
  prefs: []
  type: TYPE_NORMAL
- en: '[26.2 `throw`](#throw)'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This is the syntax of the `throw` statement:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '[26.2.1 What values should we throw?](#what-values-should-we-throw)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Any value can be thrown in JavaScript. However, it’s best to use instances
    of `Error` or a subclass because they support additional features such as stack
    traces and error chaining (see [“The superclass of all built-in exception classes:
    `Error`” (§26.4)](#class-Error)).'
  prefs: []
  type: TYPE_NORMAL
- en: 'That leaves us with the following options:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Using class `Error` directly. That is less limiting in JavaScript than in a
    more static language because we can add our own properties to instances:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Using one of [the subclasses of `Error`](#built-in-error-subclasses) such as
    `TypeError` or `RangeError`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Subclassing `Error` (more details are explained [later](#subclassing-error)):'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '[26.3 The `try` statement](#try-statement)'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The maximal version of the `try` statement looks as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'We can combine these clauses as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '`try-catch`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`try-finally`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`try-catch-finally`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[26.3.1 The `try` block](#the-try-block)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The `try` block can be considered the body of the statement. This is where we
    execute the regular code.
  prefs: []
  type: TYPE_NORMAL
- en: '[26.3.2 The `catch` clause](#the-catch-clause)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'If an exception is thrown somewhere inside the `try` block (which may happen
    deeply nested inside the tree of function/method calls) then execution switches
    to the `catch` clause where the parameter refers to the exception. After that,
    execution normally continues after the `try` statement. That may change if:'
  prefs: []
  type: TYPE_NORMAL
- en: There is a `return`, `break`, or `throw` inside the `catch` block.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There is a `finally` clause (which is always executed before the `try` statement
    ends).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The following code demonstrates that the value that is thrown in line A is indeed
    caught in line B.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE7][PRE8]js try {  // ··· } catch {  // ··· }  [PRE9]js function throws(func)
    {  try {  func();  } catch {  return; // everything OK  }  throw new Error(''Function
    didn’t throw an exception!''); }  [PRE10]js const resource = createResource();
    try {  // Work with `resource`. Errors may be thrown. } finally {  resource.destroy();
    }  [PRE11]js let finallyWasExecuted = false; assert.throws(  () => {  try {  throw
    new Error(); // (A)  } finally {  finallyWasExecuted = true;  }  },  Error );
    assert.equal(finallyWasExecuted, true);  [PRE12]js let finallyWasExecuted = false;
    function func() {  try {  return; // (A)  } finally {  finallyWasExecuted = true;  }
    } func(); assert.equal(finallyWasExecuted, true);  [PRE13]js class Error {  //
    Actually a prototype data property  get name(): string {  return ''Error'';  }  `//
    Instance properties`  `message: string;`  `cause?: unknown; // ES2022`  `stack:
    string; // non-standard but widely supported`  `` `constructor(`  `message: string
    = '''',`  `options?: ErrorOptions // ES2022`  `) {}` `}` `interface ErrorOptions
    {`  `cause?: unknown; // ES2022` `}` ``  [PRE14]js[PRE15] Alas, we don’t see the
    cause if we convert an error to a string or look at its `.stack`.    #### [26.5.2 Should
    we store context data in `.cause`?](#should-we-store-context-data-in-cause)    `error.cause`
    is not just for instances of `Error`; any data we store in it is displayed properly:    [PRE16]   [PRE17]
    class MyCustomError extends Error {  constructor(message, options) {  super(message,
    options);  // ···  } }  [PRE18]` [PRE19][PRE20][PRE21][PRE22]``````'
  prefs: []
  type: TYPE_NORMAL
