- en: 39 WeakSets (WeakSet) ES6 (advanced)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://exploringjs.com/js/book/ch_weaksets.html](https://exploringjs.com/js/book/ch_weaksets.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[39.1 How are WeakSets different from Sets?](#sets-vs-weaksets)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[39.2 Use case for WeakSets: marking objects](#marking-objects-via-weaksets)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[39.2.1 Example: Marking objects as safe to use with a method](#example-marking-objects-as-safe-to-use-with-a-method)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[39.3 WeakSet API](#weakset-api)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[39.1 How are WeakSets different from Sets?](#sets-vs-weaksets)'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'WeakSets are similar to Sets, with the following differences:'
  prefs: []
  type: TYPE_NORMAL
- en: They can hold objects without preventing those objects from being garbage-collected.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'They are black boxes: we only get any data out of a WeakSet if we have both
    the WeakSet and a value. The only methods that are supported are `.add()`, `.delete()`,
    `.has()`. See the section on [WeakMaps as black boxes](ch_weakmaps.html#weakmaps-as-black-boxes)
    for an explanation of why WeakSets don’t allow iteration, looping, and clearing.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[39.2 Use case for WeakSets: marking objects](#marking-objects-via-weaksets)'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Given that we can’t iterate over the elements of WeakSets, there are not that
    many use cases for them.
  prefs: []
  type: TYPE_NORMAL
- en: 'We can use WeakSets to mark objects – for example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: In line A, we mark `obj` as saved.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In line B, we check if `obj` is saved.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In line C, `obj` can be garbage-collected even though it is an element of the
    data structure `isSaved`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'In a way, we created a boolean property for `obj`, but stored it externally.
    If `isSaved` were a property, the previous code would look as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: '[39.2.1 Example: Marking objects as safe to use with a method](#example-marking-objects-as-safe-to-use-with-a-method)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'The following code demonstrates how a class can ensure that its methods are
    only applied to instances that were created by it (based on [code by Domenic Denicola](https://esdiscuss.org/topic/actual-weakset-use-cases#content-1)):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]` `method() {`  `if (!instancesOfSafeClass.has(this)) {`  `throw new
    TypeError(''Incompatible object!'');`  `}`  `}` `}`  [PRE3] [PRE4]'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
