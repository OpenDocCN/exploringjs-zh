- en: 11 Assertion API
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 11 断言 API
- en: 原文：[https://exploringjs.com/js/book/ch_assertion-api.html](https://exploringjs.com/js/book/ch_assertion-api.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://exploringjs.com/js/book/ch_assertion-api.html](https://exploringjs.com/js/book/ch_assertion-api.html)
- en: '[11.1 Assertions in software development](#assertions-in-software-development)'
  id: totrans-2
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[11.1 软件开发中的断言](#assertions-in-software-development)'
- en: '[11.2 How assertions are used in this book](#how-assertions-are-used-in-this-book)'
  id: totrans-3
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[11.2 本书中使用断言的方式](#how-assertions-are-used-in-this-book)'
- en: '[11.2.1 Documenting results in code examples via assertions](#documenting-results-in-code-examples-via-assertions)'
  id: totrans-4
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[11.2.1 通过断言在代码示例中记录结果](#documenting-results-in-code-examples-via-assertions)'
- en: '[11.2.2 Implementing test-driven exercises via assertions](#implementing-testdriven-exercises-via-assertions)'
  id: totrans-5
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[11.2.2 通过断言实现测试驱动练习](#implementing-testdriven-exercises-via-assertions)'
- en: '[11.3 Normal comparison vs. deep comparison](#normal-comparison-vs-deep-comparison)'
  id: totrans-6
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[11.3 正常比较与深度比较](#normal-comparison-vs-deep-comparison)'
- en: '[11.4 Quick reference: module `assert`](#quick-reference-module-assert)'
  id: totrans-7
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[11.4 快速参考：模块 `assert`](#quick-reference-module-assert)'
- en: '[11.4.1 Normal equality: `assert.equal()`](#normal-equality-assertequal)'
  id: totrans-8
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[11.4.1 正常相等：`assert.equal()`](#normal-equality-assertequal)'
- en: '[11.4.2 Deep equality: `assert.deepEqual()`](#deep-equality-assertdeepequal)'
  id: totrans-9
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[11.4.2 深度相等：`assert.deepEqual()`](#deep-equality-assertdeepequal)'
- en: '[11.4.3 Expecting exceptions: `assert.throws()`](#assert.throws)'
  id: totrans-10
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[11.4.3 期望异常：`assert.throws()`](#assert.throws)'
- en: '[11.4.4 Always fail: `assert.fail()`](#always-fail-assertfail)'
  id: totrans-11
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[11.4.4 总是失败：`assert.fail()`](#always-fail-assertfail)'
- en: '[11.1 Assertions in software development](#assertions-in-software-development)'
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[11.1 软件开发中的断言](#assertions-in-software-development)'
- en: 'In software development, *assertions* state facts about values or pieces of
    code that must be true. If they aren’t, an exception is thrown. Node.js supports
    assertions via its built-in module `assert` – for example:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在软件开发中，*断言*用于声明关于值或代码片段的事实，这些事实必须是真实的。如果不是，则会抛出异常。Node.js 通过其内置模块 `assert` 支持断言
    – 例如：
- en: '[PRE0]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This assertion states that the expected result of 3 plus 5 is 8\. The import
    statement uses [the recommended `strict` version](https://nodejs.org/api/assert.html#assert_strict_mode)
    of `assert`.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 此断言声明期望的结果是 3 加 5 等于 8。导入语句使用了[推荐的 `strict` 版本](https://nodejs.org/api/assert.html#assert_strict_mode)的
    `assert`。
- en: '[11.2 How assertions are used in this book](#how-assertions-are-used-in-this-book)'
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[11.2 本书中使用断言的方式](#how-assertions-are-used-in-this-book)'
- en: 'In this book, assertions are used in two ways: to document results in code
    examples and to implement test-driven exercises.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，断言以两种方式使用：在代码示例中记录结果以及实现测试驱动练习。
- en: '[11.2.1 Documenting results in code examples via assertions](#documenting-results-in-code-examples-via-assertions)'
  id: totrans-18
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[11.2.1 通过断言在代码示例中记录结果](#documenting-results-in-code-examples-via-assertions)'
- en: 'In code examples, assertions express expected results. Take, for example, the
    following function:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在代码示例中，断言表达期望的结果。例如，以下函数：
- en: '[PRE1]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '`id()` returns its parameter. We can show it in action via an assertion:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '`id()` 返回其参数。我们可以通过断言来展示其作用：'
- en: '[PRE2]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: In the examples, I usually omit the statement for importing `assert`.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在示例中，我通常省略导入 `assert` 的语句。
- en: 'The motivation behind using assertions is:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 使用断言背后的动机是：
- en: We can specify precisely what is expected.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们可以精确地指定期望的内容。
- en: Code examples can be tested automatically, which ensures that they really work.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代码示例可以自动测试，这确保了它们确实有效。
- en: '[11.2.2 Implementing test-driven exercises via assertions](#implementing-testdriven-exercises-via-assertions)'
  id: totrans-27
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[11.2.2 通过断言实现测试驱动练习](#implementing-testdriven-exercises-via-assertions)'
- en: The exercises for this book are test-driven, via the test framework Mocha. Checks
    inside the tests are made via methods of `assert`.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 本书的学习练习是通过测试框架 Mocha 驱动的。测试中的检查是通过 `assert` 的方法进行的。
- en: 'The following is an example of such a test:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一个此类测试的示例：
- en: '[PRE3]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: For more information, see [“Getting started with exercises” (§12)](ch_exercises.html#ch_exercises).
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 更多信息，请参阅[“开始练习”（§12）](ch_exercises.html#ch_exercises)。
- en: '[11.3 Normal comparison vs. deep comparison](#normal-comparison-vs-deep-comparison)'
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[11.3 正常比较与深度比较](#normal-comparison-vs-deep-comparison)'
- en: 'The strict `equal()` uses `===` to compare values. Therefore, an object is
    only equal to itself – even if another object has the same content (because `===`
    does not compare the contents of objects, only their identities):'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 严格的 `equal()` 使用 `===` 来比较值。因此，一个对象仅等于自身 – 即使另一个对象具有相同的内容（因为 `===` 不比较对象的内容，只比较它们的标识）：
- en: '[PRE4]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '`deepEqual()` is a better choice for comparing objects:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '`deepEqual()` 是比较对象的更好选择：'
- en: '[PRE5]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'This method works for Arrays, too:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 此方法也适用于数组：
- en: '[PRE6]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[11.4 Quick reference: module `assert`](#quick-reference-module-assert)'
  id: totrans-39
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[11.4 快速参考：模块 `assert`](#quick-reference-module-assert)'
- en: For the full documentation, see [the Node.js docs](https://nodejs.org/api/assert.html).
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 对于完整的文档，请参阅 [Node.js 文档](https://nodejs.org/api/assert.html)。
- en: '[11.4.1 Normal equality: `assert.equal()`](#normal-equality-assertequal)'
  id: totrans-41
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[11.4.1 正常相等：`assert.equal()`](#normal-equality-assertequal)'
- en: '`assert.equal(actual, expected, message?)`'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`assert.equal(actual, expected, message?)`'
- en: '`actual === expected` must be `true`. If not, an `AssertionError` is thrown.'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`actual === expected` 必须为 `true`。如果不为真，将抛出 `AssertionError`。'
- en: '[PRE7]'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '`assert.notEqual(actual, expected, message?)`'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`assert.notEqual(actual, expected, message?)`'
- en: '`actual !== expected` must be `true`. If not, an `AssertionError` is thrown.'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`actual !== expected` 必须为 `true`。如果不为真，将抛出 `AssertionError`。'
- en: '[PRE8]'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The optional last parameter `message` can be used to explain what is asserted.
    If the assertion fails, the message is used to set up the `AssertionError` that
    is thrown.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 可选的最后一个参数 `message` 可以用来解释所断言的内容。如果断言失败，该消息用于设置抛出的 `AssertionError`。
- en: '[PRE9]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[11.4.2 Deep equality: `assert.deepEqual()`](#deep-equality-assertdeepequal)'
  id: totrans-50
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[11.4.2 深度相等：`assert.deepEqual()`](#deep-equality-assertdeepequal)'
- en: '`assert.deepEqual(actual, expected, message?)`'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`assert.deepEqual(actual, expected, message?)`'
- en: '`actual` must be deeply equal to `expected`. If not, an `AssertionError` is
    thrown.'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`actual` 必须与 `expected` 深度相等。如果不相等，将抛出 `AssertionError`。'
- en: '[PRE10]'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '`assert.notDeepEqual(actual, expected, message?)`'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`assert.notDeepEqual(actual, expected, message?)`'
- en: '`actual` must not be deeply equal to `expected`. If it is, an `AssertionError`
    is thrown.'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`actual` 必须与 `expected` 不深度相等。如果相等，将抛出 `AssertionError`。'
- en: '[PRE11]'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[11.4.3 Expecting exceptions: `assert.throws()`](#assert.throws)'
  id: totrans-57
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[11.4.3 期望异常：`assert.throws()`](#assert.throws)'
- en: 'If we want to (or expect to) receive an exception, we need `assert.throws()`:
    This function calls its first parameter, the function `callback`, and only succeeds
    if it throws an exception. Additional parameters can be used to specify what that
    exception must look like.'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要（或期望）收到一个异常，我们需要 `assert.throws()`：这个函数调用它的第一个参数，即函数 `callback`，并且只有当它抛出异常时才成功。可以使用额外的参数来指定那个异常必须看起来像什么。
- en: '`assert.throws(callback, message?): void`'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`assert.throws(callback, message?): void`'
- en: '[PRE12]'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '`assert.throws(callback, errorClass, message?): void`'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`assert.throws(callback, errorClass, message?): void`'
- en: '[PRE13]'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '`assert.throws(callback, errorRegExp, message?): void`'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`assert.throws(callback, errorRegExp, message?): void`'
- en: '[PRE14]'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '`assert.throws(callback, errorObject, message?): void`'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`assert.throws(callback, errorObject, message?): void`'
- en: '[PRE15]'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '[11.4.4 Always fail: `assert.fail()`](#always-fail-assertfail)'
  id: totrans-67
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[11.4.4 始终失败：`assert.fail()`](#always-fail-assertfail)'
- en: '`assert.fail(messageOrError?)`'
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`assert.fail(messageOrError?)`'
- en: 'By default, it throws an `AssertionError` when it is called. That is occasionally
    useful for unit testing. `messageOrError` can be:'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 默认情况下，当它被调用时，它会抛出 `AssertionError`。这在单元测试中偶尔很有用。"messageOrError" 可以是：
- en: A string. That enables to override the default error message.
  id: totrans-70
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个字符串。这允许覆盖默认的错误信息。
- en: An instance of `Error` (or a subclass). That enables us to throw a different
    value.
  id: totrans-71
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Error` 的一个实例（或其子类）。这使我们能够抛出不同的值。'
- en: '[PRE16]'
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
