<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>12 Getting started with exercises</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>12 Getting started with exercises</h1>
<blockquote>原文：<a href="https://exploringjs.com/js/book/ch_exercises.html">https://exploringjs.com/js/book/ch_exercises.html</a></blockquote>

        
    
    
    
<nav class="local-toc">
  <ol>
    <li>
      <a href="#exercises">12.1 Exercises</a>
      <ol>
        <li>
          <a href="#installing-the-exercises">12.1.1 Installing the exercises</a>
        </li>
        <li>
          <a href="#running-exercises">12.1.2 Running exercises</a>
        </li>
      </ol>
    </li>
    <li>
      <a href="#unit-tests-in-javascript">12.2 Unit tests in JavaScript</a>
      <ol>
        <li>
          <a href="#a-typical-test">12.2.1 A typical test</a>
        </li>
        <li>
          <a href="#async-tests-mocha">12.2.2 Asynchronous tests in Mocha</a>
        </li>
      </ol>
    </li>
  </ol>
</nav>
<p>Throughout most chapters, there are boxes that point to exercises. These are a paid feature, but a comprehensive preview is available. This chapter explains how to get started with them.</p>
<h3 id="exercises"><a class="heading-id-link" href="#exercises">12.1 Exercises</a></h3>
<p><span id="index-entry-exercises--getting-started-with"/></p>
<h4 id="installing-the-exercises"><a class="heading-id-link" href="#installing-the-exercises">12.1.1 Installing the exercises</a></h4>
<p>To install the exercises:</p>
<ul>
  <li>
    Download and unzip <code>exploring-js-code.zip</code>
  </li>
  <li>
    Follow the instructions in <code>README.txt</code>
  </li>
</ul>
<h4 id="running-exercises"><a class="heading-id-link" href="#running-exercises">12.1.2 Running exercises</a></h4>
<ul>
  <li>
    Exercises are referred to by path in this book.
    <ul>
      <li>
        For example: <code>exercises/exercises/first_module_test.mjs</code>
      </li>
    </ul>
  </li>
  <li>
    Within each file:
    <ul>
      <li>
        The first line contains the command for running the exercise.
      </li>
      <li>
        The following lines describe what you have to do.
      </li>
    </ul>
  </li>
</ul>
<h3 id="unit-tests-in-javascript"><a class="heading-id-link" href="#unit-tests-in-javascript">12.2 Unit tests in JavaScript</a></h3>
<p><span id="index-entry-unit-test"/></p>
<p>All exercises in this book are tests that are run via the test framework <a href="https://mochajs.org">Mocha</a>. This section gives a brief introduction.</p>
<h4 id="a-typical-test"><a class="heading-id-link" href="#a-typical-test">12.2.1 A typical test</a></h4>
<p>Typical test code is split into two parts:</p>
<ul>
  <li>
    Part 1: the code to be tested.
  </li>
  <li>
    Part 2: the tests for the code.
  </li>
</ul>
<p>Take, for example, the following two files:</p>
<ul>
  <li>
    <code>id.mjs</code> (code to be tested)
  </li>
  <li>
    <code>id_test.mjs</code> (tests)
  </li>
</ul>
<h5 id="part-1-the-code"><a class="heading-id-link" href="#part-1-the-code">12.2.1.1 Part 1: the code</a></h5>
<p>The code itself resides in <code>id.mjs</code>:</p>
<pre class="language-js">
<code><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">id</span>(<span class="hljs-params">x</span>) {</code>
<code>  <span class="hljs-keyword">return</span> x;</code>
<code>}</code>
</pre>
<p>The key thing here is: everything we want to test must be exported. Otherwise, the test code can’t access it.</p>
<h5 id="part-2-the-tests"><a class="heading-id-link" href="#part-2-the-tests">12.2.1.2 Part 2: the tests</a></h5>
<div class="boxout">
  <p><img src="../Images/0fb62b2fc33a72829ae9fb174dedd0d2.png" class="boxout-icon" height="24" alt="Icon “reading”" data-original-src="https://exploringjs.com/js/book/icon/reading.svg"/> <strong>Don’t worry about the exact details of tests</strong></p>
  <div class="boxout-vspace"/>
  <p>You don’t need to worry about the exact details of tests: They are always implemented for you. Therefore, you only need to read them, but not write them.</p>
</div>
<p>The tests for the code reside in <code>id_test.mjs</code>:</p>
<pre class="language-js">
<code><span class="hljs-comment">/* npm t demos/exercises/id_test.mjs</span></code>
<code/>
<code><span class="hljs-comment">Instructions: Implement id.mjs</span></code>
<code><span class="hljs-comment">*/</span></code>
<code><span class="hljs-title function_">suite</span>(<span class="hljs-string">'id_test.mjs'</span>);</code>
<code/>
<code><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> assert <span class="hljs-keyword">from</span> <span class="hljs-string">'node:assert/strict'</span>;</code>
<code><span class="hljs-keyword">import</span> {id} <span class="hljs-keyword">from</span> <span class="hljs-string">'./id.mjs'</span>;</code>
<code/>
<code><span class="hljs-title function_">test</span>(<span class="hljs-string">'My test'</span>, <span class="hljs-function">() =&gt;</span> {</code>
<code>  assert.<span class="hljs-title function_">equal</span>(</code>
<code>    <span class="hljs-title function_">id</span>(<span class="hljs-string">'abc'</span>), <span class="hljs-string">'abc'</span></code>
<code>  );</code>
<code>});</code>
</pre>
<p>What’s inside this file?</p>
<ul>
  <li>
    It starts with the command for running the test.
  </li>
  <li>
    Next are instructions for how to implement the solution.
  </li>
  <li>
    <code>suite()</code> provides a title for the tests in this file.
  </li>
  <li>
    We use the Node.js <code>assert</code> module in <em>strict</em> mode.
  </li>
  <li>
    Function <code>test()</code> defines named test cases.
  </li>
  <li>
    The core of the test is <code>assert.equal()</code> checking the result of the imported function <code>id()</code>. That’s the function we have to implement.
  </li>
</ul>
<p>To run the test, we execute the following command in a shell:</p>
<pre class="language-txt">
<code>npm t demos/exercises/id_test.mjs</code>
</pre>
<p>The <code>t</code> is an abbreviation for <code>test</code>. That is, the long version of this command is:</p>
<pre class="language-txt">
<code>npm test demos/exercises/id_test.mjs</code>
</pre>
<div class="boxout">
  <p><img src="../Images/4fc2ec98bb44cc1f4de7c6a46d9dd043.png" class="boxout-icon" height="24" alt="Icon “exercise”" data-original-src="https://exploringjs.com/js/book/icon/exercise.svg"/> <strong>Exercise: Your first exercise</strong></p>
  <div class="boxout-vspace"/>
  <p>The following exercise gives you a first taste of what exercises are like:</p>
  <ul>
    <li>
      <code>exercises/exercises/first_module_test.mjs</code>
    </li>
  </ul>
</div>
<h4 id="async-tests-mocha"><a class="heading-id-link" href="#async-tests-mocha">12.2.2 Asynchronous tests in Mocha</a></h4>
<div class="boxout">
  <p><img src="../Images/0fb62b2fc33a72829ae9fb174dedd0d2.png" class="boxout-icon" height="24" alt="Icon “reading”" data-original-src="https://exploringjs.com/js/book/icon/reading.svg"/> <strong>Reading</strong></p>
  <div class="boxout-vspace"/>
  <p>You may want to postpone reading this section until you get to the chapters on asynchronous programming.</p>
</div>
<p>Writing tests for asynchronous code requires extra work: The test receives its results later and has to signal to Mocha that it isn’t finished yet when it returns. The following subsections examine three ways of doing so.</p>
<h5 id="asynchronicity-via-callbacks"><a class="heading-id-link" href="#asynchronicity-via-callbacks">12.2.2.1 Asynchronicity via callbacks</a></h5>
<p>If the callback we pass to <code>test()</code> has a parameter (e.g., <code>done</code>), Mocha switches to callback-based asynchronicity. When we are done with our asynchronous work, we have to call <code>done</code>:</p>
<pre class="language-js">
<code><span class="hljs-title function_">test</span>(<span class="hljs-string">'divideCallback'</span>, <span class="hljs-function">(<span class="hljs-params">done</span>) =&gt;</span> {</code>
<code>  <span class="hljs-title function_">divideCallback</span>(<span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-function">(<span class="hljs-params">error, result</span>) =&gt;</span> {</code>
<code>    <span class="hljs-keyword">if</span> (error) {</code>
<code>      <span class="hljs-title function_">done</span>(error);</code>
<code>    } <span class="hljs-keyword">else</span> {</code>
<code>      assert.<span class="hljs-title function_">strictEqual</span>(result, <span class="hljs-number">2</span>);</code>
<code>      <span class="hljs-title function_">done</span>();</code>
<code>    }</code>
<code>  });</code>
<code>});</code>
</pre>
<p>This is what <code>divideCallback()</code> looks like:</p>
<pre class="language-js">
<code><span class="hljs-keyword">function</span> <span class="hljs-title function_">divideCallback</span>(<span class="hljs-params">x, y, callback</span>) {</code>
<code>  <span class="hljs-keyword">if</span> (y === <span class="hljs-number">0</span>) {</code>
<code>    <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Division by zero'</span>));</code>
<code>  } <span class="hljs-keyword">else</span> {</code>
<code>    <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, x / y);</code>
<code>  }</code>
<code>}</code>
</pre>
<h5 id="asynchronicity-via-promises"><a class="heading-id-link" href="#asynchronicity-via-promises">12.2.2.2 Asynchronicity via Promises</a></h5>
<p>If a test returns a Promise, Mocha switches to Promise-based asynchronicity. A test is considered successful if the Promise is fulfilled and failed if the Promise is rejected or if a settlement takes longer than a timeout.</p>
<pre class="language-js">
<code><span class="hljs-title function_">test</span>(<span class="hljs-string">'dividePromise 1'</span>, <span class="hljs-function">() =&gt;</span> {</code>
<code>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">dividePromise</span>(<span class="hljs-number">8</span>, <span class="hljs-number">4</span>)</code>
<code>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {</code>
<code>    assert.<span class="hljs-title function_">strictEqual</span>(result, <span class="hljs-number">2</span>);</code>
<code>  });</code>
<code>});</code>
</pre>
<p><code>dividePromise()</code> is implemented as follows:</p>
<pre class="language-js">
<code><span class="hljs-keyword">function</span> <span class="hljs-title function_">dividePromise</span>(<span class="hljs-params">x, y</span>) {</code>
<code>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</code>
<code>    <span class="hljs-keyword">if</span> (y === <span class="hljs-number">0</span>) {</code>
<code>      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Division by zero'</span>));</code>
<code>    } <span class="hljs-keyword">else</span> {</code>
<code>      <span class="hljs-title function_">resolve</span>(x / y);</code>
<code>    }</code>
<code>  });</code>
<code>}</code>
</pre>
<h5 id="async-functions-as-test-bodies"><a class="heading-id-link" href="#async-functions-as-test-bodies">12.2.2.3 Async functions as test “bodies”</a></h5>
<p>Async functions always return Promises. Therefore, an async function is a convenient way of implementing an asynchronous test. The following code is equivalent to the previous example.</p>
<pre class="language-js">
<code><span class="hljs-title function_">test</span>(<span class="hljs-string">'dividePromise 2'</span>, <span class="hljs-keyword">async</span> () =&gt; {</code>
<code>  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">dividePromise</span>(<span class="hljs-number">8</span>, <span class="hljs-number">4</span>);</code>
<code>  assert.<span class="hljs-title function_">strictEqual</span>(result, <span class="hljs-number">2</span>);</code>
<code>  <span class="hljs-comment">// No explicit return necessary!</span></code>
<code>});</code>
</pre>
<p>We don’t need to explicitly return anything: The implicitly returned <code>undefined</code> is used to fulfill the Promise returned by this async function. And if the test code throws an exception, then the async function takes care of rejecting the returned Promise.</p>

    
      
</body>
</html>