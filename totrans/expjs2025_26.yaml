- en: 22 Strings
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://exploringjs.com/js/book/ch_strings.html](https://exploringjs.com/js/book/ch_strings.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[22.1 Cheat sheet: strings](#cheat-sheet-strings)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.1.1 Working with strings](#working-with-strings)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.1.2 JavaScript characters vs. code points vs. grapheme clusters](#javascript-characters-vs-code-points-vs-grapheme-clusters)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.1.3 String methods](#string-methods)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.2 Plain string literals](#plain-string-literals)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.2.1 Escaping](#escaping)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.3 Accessing JavaScript characters](#accessing-javascript-characters)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.4 String concatenation](#string-concatenation)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.4.1 String concatenation via `+`](#string-concatenation-via-plus)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.4.2 Concatenating via Arrays (`.push()` and `.join()`)](#string-concatenation-via-arrays)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.5 Converting values to strings in JavaScript has pitfalls](#converting-values-to-strings)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.5.1 Example: code that is problematic](#example-code-that-is-problematic)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.5.2 Four common ways of converting values to strings](#four-common-ways-of-converting-values-to-strings)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.5.3 Using `JSON.stringify()` to convert values to strings](#using-jsonstringify-to-convert-values-to-strings)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.5.4 Solutions](#solutions)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.5.5 Customizing how objects are converted to strings](#customizing-how-objects-are-converted-to-strings)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.6 Comparing strings](#comparing-strings)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.7 Atoms of text: code points, JavaScript characters, grapheme clusters](#atoms-of-text)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.7.1 Working with code units (JavaScript characters)](#working-with-code-units-javascript-characters)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.7.2 Working with code points](#working-with-code-points)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.7.3 Working with grapheme clusters](#working-with-grapheme-clusters)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.8 Quick reference: Strings](#quickref-string)'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.8.1 Converting to string](#converting-to-string)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.8.2 Numeric values of text atoms](#numeric-values-of-text-atoms)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.8.3 `String.prototype.*`: regular expression methods](#stringprototype-regular-expression-methods)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.8.4 `String.prototype.*`: finding and matching](#stringprototype-finding-and-matching)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.8.5 `String.prototype.*`: extracting](#stringprototype-extracting)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.8.6 `String.prototype.*`: combining](#stringprototype-combining)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.8.7 `String.prototype.*`: transforming](#stringprototype-transforming)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.8.8 Sources of this quick reference](#sources-of-this-quick-reference)'
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[22.1 Cheat sheet: strings](#cheat-sheet-strings)'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Strings are primitive values in JavaScript and immutable. That is, string-related
    operations always produce new strings and never change existing strings.
  prefs: []
  type: TYPE_NORMAL
- en: '[22.1.1 Working with strings](#working-with-strings)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Literals for strings:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Backslashes are used to:'
  prefs: []
  type: TYPE_NORMAL
- en: Escape literal delimiters (first 2 lines of previous example)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Represent special characters:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`\\` represents a backslash'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`\n` represents a newline'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`\r` represents a carriage return'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`\t` represents a tab'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Inside a `String.raw` tagged template (line A), backslashes are treated as
    normal characters:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Convertings values to strings:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Copying parts of a string
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '[PRE4][PRE5]` Concatenating strings:    [PRE6]   [PRE7][PRE8] #### [22.1.2 JavaScript
    characters vs. code points vs. grapheme clusters](#javascript-characters-vs-code-points-vs-grapheme-clusters)    *   **Code
    points** are 21-bit Unicode characters. *   **JavaScript characters** are 16-bit
    UTF-16 code units. To encode a code point, we need one to two code units. Most
    code points fit into one code unit. *   **Grapheme clusters** are *user-perceived
    characters* and represent written symbols. Most grapheme clusters are only one
    code point long, but they can also be longer – e.g., some emojis.    Example –
    a grapheme cluster that consists of multiple code points:    [PRE9]    For more
    information on how to handle text, see [“Atoms of text: code points, JavaScript
    characters, grapheme clusters” (§22.7)](#atoms-of-text).    #### [22.1.3 String
    methods](#string-methods)    This subsection gives a brief overview of the string
    API. There is [a more comprehensive quick reference](#quickref-string) at the
    end of this chapter.    Finding substrings:    [PRE10]   [PRE11][PRE12]``js[PRE13]`js`
    [PRE14] ![Icon “details”](../Images/38ba63de820aae6f94a019538ae0f222.png) **Concatenating
    via `+` is efficient**    Using `+` to assemble strings is quite efficient because
    most JavaScript engines internally optimize it.    ![Icon “exercise”](../Images/4fc2ec98bb44cc1f4de7c6a46d9dd043.png) **Exercise:
    Concatenating strings**    `exercises/strings/concat_string_array_test.mjs`    ####
    [22.4.2 Concatenating via Arrays (`.push()` and `.join()`)](#string-concatenation-via-arrays)    Occasionally,
    taking a detour via an Array can be useful for concatenating strings – especially
    if there is to be a separator between them (such as `'', ''` in line A):    [PRE15]    ###
    [22.5 Converting values to strings in JavaScript has pitfalls](#converting-values-to-strings)    Converting
    values to strings in JavaScript is more complicated than it might seem:    *   Most
    approaches have values they can’t handle. *   We don’t always see all of the data.    ####
    [22.5.1 Example: code that is problematic](#example-code-that-is-problematic)    Can
    you spot the problem in the following code?    [PRE16]    For some values, this
    code throws an exception in line A:    [PRE17]    Read on for more information.    ####
    [22.5.2 Four common ways of converting values to strings](#four-common-ways-of-converting-values-to-strings)    1.  `String(v)`
    2.  `v.toString()` 3.  `'''' + v` 4.  `` `${v}` ``    The following table shows
    how these operations fare with various values (#4 produces the same results as
    #3).     |  | `String(v)` | `'''' + v` | `v.toString()` | | --- | --- | --- |
    --- | | `undefined` | `''undefined''` | `''undefined''` | **TypeError** | | `null`
    | `''null''` | `''null''` | **TypeError** | | `true` | `''true''` | `''true''`
    | `''true''` | | `123` | `''123''` | `''123''` | `''123''` | | `123n` | `''123''`
    | `''123''` | `''123''` | | `"abc"` | `''abc''` | `''abc''` | `''abc''` | | `Symbol()`
    | `''Symbol()''` | **TypeError** | `''Symbol()''` | | `{a:1}` | `''[object Object]''`
    | `''[object Object]''` | `''[object Object]''` | | `[''a'']` | `''a''` | `''a''`
    | `''a''` | | `{__proto__:null}` | **TypeError** | **TypeError** | **TypeError**
    | | `Symbol.prototype` | **TypeError** | **TypeError** | **TypeError** | | `()
    => {}` | `''() => {}''` | `''() => {}''` | `''() => {}''` |    Let’s explore why
    some of these values produce exceptions or results that aren’t very useful.    #####
    [22.5.2.1 Tricky values: symbols](#tricky-values-symbols)    Symbols must be converted
    to strings explicitly (via `String()` or `.toString()`). Conversion via concatenation
    throws an exception:    [PRE18]    Why is that? The intent is to prevent accidentally
    converting a symbol property key to a string (which is also a valid property key).    #####
    [22.5.2.2 Tricky values: objects with `null` prototypes](#tricky-values-objects-with-null-prototypes)    It’s
    obvious why `v.toString()` doesn’t work if there is no method `.toString()`. However,
    the other conversion operations call the following methods in the following order
    and use the first primitive value that is returned (after converting it to string):    *   `v[Symbol.toPrimitive]()`
    *   `v.toString()` *   `v.valueOf()`    If none of these methods are present,
    a `TypeError` is thrown.    [PRE19]   [PRE20]`` Where might we encounter objects
    with `null` prototypes?    *   [“Objects with `null` prototypes as dictionaries”
    (§30.9.11.4)](ch_objects.html#dictionary-objects-with-null-prototypes) *   [“Objects
    with `null` prototypes as fixed lookup tables” (§30.9.11.5)](ch_objects.html#lookup-tables-with-null-prototypes)
    *   [“`null` prototypes in the standard library” (§30.9.11.6)](ch_objects.html#null-prototypes-in-standard-library)    #####
    [22.5.2.3 Tricky values: objects in general](#tricky-values-objects-in-general)    Plain
    objects have default string representations that are not very useful:    [PRE21]    Arrays
    have better string representations, but they still hide much information:    [PRE22]   [PRE23]`
    [PRE24] ##### [22.5.2.4 Tricky value: `Symbol.prototype`](#tricky-value-symbolprototype)    You’ll
    probably never encounter the value `Symbol.prototype` (the object that provides
    symbols with methods) in the wild but it’s an interesting edge case: `Symbol.prototype[Symbol.toPrimitive]()`
    throws an exception if `this` isn’t a symbol. That explains why converting `Symbol.prototype`
    to a string doesn’t work:    [PRE25]js    #### [22.5.3 Using `JSON.stringify()`
    to convert values to strings](#using-jsonstringify-to-convert-values-to-strings)    The
    JSON data format is a text representation of JavaScript values. Therefore, [`JSON.stringify()`](ch_json.html#JSON.stringify)
    can also be used to convert values to strings. It works especially well for objects
    and Arrays where the normal conversion to string has significant deficiencies:    [PRE26]js    `JSON.stringify()`
    is OK with objects whose prototypes are `null`:    [PRE27]js    On major downside
    is that `JSON.stringify()` only supports the following values:    *   Primitive
    values:     *   `null`     *   Booleans     *   Numbers (except for `NaN` and
    `Infinity`)     *   Strings *   Non-primitive values:     *   Arrays     *   Objects
    (except for functions)    For most other values, we get `undefined` as a result
    (and not a string):    [PRE28]js    Bigints cause exceptions:    [PRE29]js    Properties
    with `undefined`-producing values are omitted:    [PRE30]js    Array elements
    whose values produce `undefined`, are stringified as `null`:    [PRE31]js    The
    following table summarizes the results of `JSON.stringify(v)`:     |  | `JSON.stringify(v)`
    | | --- | --- | | `undefined` | `undefined` | | `null` | `''null''` | | `true`
    | `''true''` | | `123` | `''123''` | | `123n` | **TypeError** | | `''abc''` |
    `''"abc"''` | | `Symbol()` | `undefined` | | `{a:1}` | `''{"a":1}''` | | `[''a'']`
    | `''["a"]''` | | `() => {}` | `undefined` | | `{__proto__:null}` | `''{}''` |
    | `Symbol.prototype` | `''{}''` |    For more information, see [“Details on how
    data is converted to JSON” (§48.3.1.3)](ch_json.html#json-stringify-details).    #####
    [22.5.3.1 Multiline output](#multiline-output)    By default, `JSON.stringify()`
    returns a single line of text. However the optional third parameter enables multiline
    output and lets us specify how much to indent – for example:    [PRE32]js    #####
    [22.5.3.2 Displaying strings via `JSON.stringify()`](#displaying-strings-via-jsonstringify)    `JSON.stringify()`
    is useful for displaying arbitrary strings:    *   The result always fits into
    a single line. *   Invisible characters such as newlines and tabs become visible.    Example:    [PRE33]js    Output:    [PRE34]js    ####
    [22.5.4 Solutions](#solutions)    Alas, there are no good built-in solutions for
    stringification that work all the time. In this section, we’ll explore a short
    function that works for all simple use cases, along with solutions for more sophisticated
    use cases.    ##### [22.5.4.1 Short solution: a custom `toString()` function](#short-solution-a-custom-tostring-function)    What
    would a simple solution for stringification look like?    `JSON.stringify()` works
    well for a lot of data, especially plain objects and Arrays. If it can’t stringify
    a given value, it returns `undefined` instead of a string – unless the value is
    a bigint. Then it throws an exception.    Therefore, we can use the following
    function for stringification:    [PRE35]js    For values that are not supported
    by `JSON.stringify()`, we use `String()` as a fallback (line A). That function
    only throws for the following two values – which are both handled well by `JSON.stringify()`:    *   `{__proto__:null}`
    *   `Symbol.prototype`    The following table summarizes the results of `toString()`:     |  |
    `toString()` | | --- | --- | | `undefined` | `''undefined''` | | `null` | `''null''`
    | | `true` | `''true''` | | `123` | `''123''` | | `123n` | `''123n''` | | `''abc''`
    | `''"abc"''` | | `Symbol()` | `''Symbol()''` | | `{a:1}` | `''{"a":1}''` | |
    `[''a'']` | `''["a"]''` | | `() => {}` | `''() => {}''` | | `{__proto__:null}`
    | `''{}''` | | `Symbol.prototype` | `''{}''` |    ##### [22.5.4.2 Library for
    stringifying values](#library-for-stringifying-values)    *   The library [stringify-object](https://github.com/sindresorhus/stringify-object)
    by Sindre Sorhus: “Stringify an object/array like `JSON.stringify` just without
    all the double-quotes”    ##### [22.5.4.3 Node.js functions for stringifying values](#nodejs-functions-for-stringifying-values)    Node.js
    has several built-in functions that provide sophisticated support for converting
    JavaScript values to strings – e.g.:    *   [`util.inspect(obj)`](https://nodejs.org/api/util.html#utilinspectobject-options)
    “returns a string representation of `obj` that is intended for debugging”. *   [`util.format(format,
    ...args)`](https://nodejs.org/api/util.html#utilformatformat-args) “returns a
    formatted string using the first argument as a printf-like format string which
    can contain zero or more format specifiers”.    These functions can even handle
    circular data:    [PRE36]js   [PRE37]`js [PRE38]js`` [PRE39]js[PRE40][PRE41][PRE42][PRE43]js[PRE44]js`
    [PRE45]```'
  prefs: []
  type: TYPE_NORMAL
