- en: 48 Creating and parsing JSON (JSON)
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 48 创建和解析JSON（JSON）
- en: 原文：[https://exploringjs.com/js/book/ch_json.html](https://exploringjs.com/js/book/ch_json.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://exploringjs.com/js/book/ch_json.html](https://exploringjs.com/js/book/ch_json.html)
- en: '[48.1 The discovery and standardization of JSON](#the-discovery-and-standardization-of-json)'
  id: totrans-2
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.1 JSON的发现和标准化](#the-discovery-and-standardization-of-json)'
- en: '[48.1.1 JSON’s grammar is frozen](#json-grammar-is-frozen)'
  id: totrans-3
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.1.1 JSON的语法已冻结](#json-grammar-is-frozen)'
- en: '[48.2 JSON syntax](#json-syntax)'
  id: totrans-4
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.2 JSON语法](#json-syntax)'
- en: '[48.3 The `JSON` API](#json-api)'
  id: totrans-5
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.3 `JSON` API](#json-api)'
- en: '[48.3.1 `JSON.stringify(data, replacer?, space?)`](#JSON.stringify)'
  id: totrans-6
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.3.1 `JSON.stringify(data, replacer?, space?)`](#JSON.stringify)'
- en: '[48.3.2 `JSON.parse(text, reviver?)`](#JSON.parse)'
  id: totrans-7
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.3.2 `JSON.parse(text, reviver?)`](#JSON.parse)'
- en: '[48.3.3 Example: converting to and from JSON](#example-converting-to-and-from-json)'
  id: totrans-8
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.3.3 示例：转换为和从JSON转换](#example-converting-to-and-from-json)'
- en: '[48.4 Customizing stringification and parsing (advanced)](#json-replacers-revivers)'
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.4 自定义序列化和解析（高级）](#json-replacers-revivers)'
- en: '[48.4.1 `.stringfy()`: specifying which properties of objects to stringify](#stringfy-specifying-which-properties-of-objects-to-stringify)'
  id: totrans-10
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.4.1 `.stringify()`: 指定要序列化对象的哪些属性](#stringfy-specifying-which-properties-of-objects-to-stringify)'
- en: '[48.4.2 `.stringify()` and `.parse()`: value visitors](#json-value-visitors)'
  id: totrans-11
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.4.2 `.stringify()`和`.parse()`: 值访问者](#json-value-visitors)'
- en: '[48.4.3 Example: visiting values](#example-visiting-values)'
  id: totrans-12
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.4.3 示例：访问值](#example-visiting-values)'
- en: '[48.4.4 Example: stringifying unsupported values](#example-stringifying-unsupported-values)'
  id: totrans-13
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.4.4 示例：序列化不受支持的价值](#example-stringifying-unsupported-values)'
- en: '[48.4.5 Example: parsing unsupported values](#example-parsing-unsupported-values)'
  id: totrans-14
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.4.5 示例：解析不受支持的价值](#example-parsing-unsupported-values)'
- en: '[48.5 FAQ](#faq)'
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.5 常见问题解答](#faq)'
- en: '[48.5.1 Why doesn’t JSON support comments?](#why-doesnt-json-support-comments)'
  id: totrans-16
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[48.5.1 为什么JSON不支持注释？](#why-doesnt-json-support-comments)'
- en: 'JSON (“JavaScript Object Notation”) is a storage format that uses text to encode
    data. Its syntax is a subset of JavaScript expressions. As an example, consider
    the following text, stored in a file `jane.json`:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: JSON（“JavaScript对象表示法”）是一种使用文本编码数据的存储格式。其语法是JavaScript表达式的子集。例如，考虑以下存储在文件`jane.json`中的文本：
- en: '[PRE0]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: JavaScript has the global namespace object `JSON` that provides methods for
    creating and parsing JSON.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: JavaScript有一个全局命名空间对象`JSON`，它提供了创建和解析JSON的方法。
- en: '[48.1 The discovery and standardization of JSON](#the-discovery-and-standardization-of-json)'
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[48.1 JSON的发现和标准化](#the-discovery-and-standardization-of-json)'
- en: 'A specification for JSON was published by Douglas Crockford in 2001, at [`json.org`](http://json.org/).
    He explains:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 2001年，Douglas Crockford发布了JSON规范，在[`json.org`](http://json.org/)。他解释说：
- en: I discovered JSON. I do not claim to have invented JSON because it already existed
    in nature. What I did was I found it, I named it, I described how it was useful.
    I don't claim to be the first person to have discovered it; I know that there
    are other people who discovered it at least a year before I did. The earliest
    occurrence I've found was, there was someone at Netscape who was using JavaScript
    array literals for doing data communication as early as 1996, which was at least
    five years before I stumbled onto the idea.
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我发现了JSON。我并不声称发明了JSON，因为它在自然界中已经存在。我所做的是我发现它，我为它命名，我描述了它的用途。我不声称自己是第一个发现它的人；我知道至少有其他人在我之前一年就发现了它。我找到的最早记录是，早在1996年，有人在Netscape使用JavaScript数组字面量进行数据通信，这至少比我偶然想到这个想法早五年。
- en: 'Later, JSON was standardized as [ECMA-404](https://ecma-international.org/publications-and-standards/standards/ecma-404/):'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 后来，JSON被标准化为[ECMA-404](https://ecma-international.org/publications-and-standards/standards/ecma-404/)：
- en: '1st edition: October 2013'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第1版：2013年10月
- en: '2nd edition: December 2017'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第2版：2017年12月
- en: '[48.1.1 JSON’s grammar is frozen](#json-grammar-is-frozen)'
  id: totrans-26
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[48.1.1 JSON的语法已冻结](#json-grammar-is-frozen)'
- en: 'Quoting the ECMA-404 standard:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 引用ECMA-404标准：
- en: Because it is so simple, it is not expected that the JSON grammar will ever
    change. This gives JSON, as a foundational notation, tremendous stability.
  id: totrans-28
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 由于它非常简单，因此预计JSON语法永远不会改变。这使得作为基础符号的JSON具有巨大的稳定性。
- en: Therefore, JSON will never get improvements such as optional trailing commas,
    comments, or unquoted keys – independently of whether or not they are considered
    desirable. However, that still leaves room for creating supersets of JSON that
    compile to plain JSON.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，JSON永远不会得到像可选尾随逗号、注释或未引用键这样的改进——无论它们是否被认为是可取的。然而，这仍然为创建编译为纯JSON的超集留出了空间。
- en: '[48.2 JSON syntax](#json-syntax)'
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[48.2 JSON语法](#json-syntax)'
- en: 'JSON consists of the following parts of JavaScript:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: JSON由以下JavaScript部分组成：
- en: 'Compound:'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 复合：
- en: 'Object literals:'
  id: totrans-33
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对象字面量：
- en: Property keys are double-quoted strings.
  id: totrans-34
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 属性键是双引号字符串。
- en: Property values are JSON values.
  id: totrans-35
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 属性值是 JSON 值。
- en: No trailing commas are allowed.
  id: totrans-36
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不允许有尾随逗号。
- en: 'Array literals:'
  id: totrans-37
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数组字面量：
- en: Elements are JSON values.
  id: totrans-38
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 元素是 JSON 值。
- en: No holes or trailing commas are allowed.
  id: totrans-39
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不允许有孔或尾随逗号。
- en: 'Atomic:'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 原子：
- en: '`null` (but not `undefined`)'
  id: totrans-41
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`null`（但不是 `undefined`）'
- en: Booleans
  id: totrans-42
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 布尔值
- en: Numbers (excluding `NaN`, `+Infinity`, `-Infinity`)
  id: totrans-43
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数字（不包括 `NaN`，`+Infinity`，`-Infinity`）
- en: Strings (must be double-quoted)
  id: totrans-44
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 字符串（必须使用双引号）
- en: As a consequence, we can’t (directly) represent cyclic structures in JSON.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们无法（直接）在 JSON 中表示循环结构。
- en: '[48.3 The `JSON` API](#json-api)'
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[48.3 JSON API](#json-api)'
- en: 'The global namespace object `JSON` contains two methods for working with JSON
    data:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 全局命名空间对象 `JSON` 包含两个用于处理 JSON 数据的方法：
- en: '`JSON.stringify(data, replacer?, space?)`'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`JSON.stringify(data, replacer?, space?)`'
- en: '`JSON.parse(text, reviver?)`'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`JSON.parse(text, reviver?)`'
- en: The next sections explain how those methods work.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的章节将解释这些方法是如何工作的。
- en: '[48.3.1 `JSON.stringify(data, replacer?, space?)`](#JSON.stringify)'
  id: totrans-51
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[48.3.1 `JSON.stringify(data, replacer?, space?)`](#JSON.stringify)'
- en: This method converts JavaScript `data` to a JSON string. In this section, we
    ignore the parameter `replacer`; it is explained in [“Customizing stringification
    and parsing (advanced)” (§48.4)](#json-replacers-revivers).
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 此方法将 JavaScript `data` 转换为 JSON 字符串。在本节中，我们忽略参数 `replacer`；它将在“自定义序列化和解析（高级）”中解释（§48.4）。
- en: '[48.3.1.1 Result: a single line of text](#result-a-single-line-of-text)'
  id: totrans-53
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: '[48.3.1.1 结果：单行文本](#result-a-single-line-of-text)'
- en: 'If we only provide the first argument, `.stringify()` returns a single line
    of text:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们只提供第一个参数，`.stringify()` 返回单行文本：
- en: '[PRE1]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '[48.3.1.2 Result: a tree of indented lines](#result-a-tree-of-indented-lines)'
  id: totrans-56
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: '[48.3.1.2 结果：缩进行树](#result-a-tree-of-indented-lines)'
- en: 'If you provide a non-negative integer for `space`, then `.stringify()` returns
    one or more lines and indents by `space` spaces per level of nesting:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你提供一个非负整数作为 `space`，那么 `.stringify()` 会返回一行或多行，并且每层嵌套缩进 `space` 个空格：
- en: '[PRE2]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '[48.3.1.3 Details on how data is converted to JSON](#json-stringify-details)'
  id: totrans-59
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: '[48.3.1.3 数据转换为 JSON 的细节](#json-stringify-details)'
- en: '**Primitive values:**'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '**原始值**：'
- en: 'Supported primitive values are stringified as expected:'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持的基本值会按预期序列化：
- en: '[PRE3]'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Unsupported numbers: the string `''null''`'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不支持的数字：字符串 `'null'`
- en: '[PRE4]'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Bigints (no matter where they appear): `TypeError`'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 大整数（无论它们出现在哪里）：`TypeError`
- en: '[PRE5]'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Other unsupported primitive values are not stringified; they produce the result
    `undefined`:'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 其他不支持的原始值不会被序列化；它们产生结果 `undefined`：
- en: '[PRE6]'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '**Objects:**'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '**对象**：'
- en: 'If an object has a method `.toJSON()`, then the result of that method is stringified:'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果一个对象有 `.toJSON()` 方法，那么该方法的结果会被序列化：
- en: '[PRE7]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Dates have a method `.toJSON()` that returns a string:'
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 日期有一个 `.toJSON()` 方法，它返回一个字符串：
- en: '[PRE8]'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Wrapped primitive values are unwrapped and stringified:'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包装的基本值会被解包并序列化：
- en: '[PRE9]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'An unsupported `undefined`-producing value is stringified as `null` inside
    an Array:'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 产生 `undefined` 的不支持的值在数组内部会被序列化为 `null`：
- en: '[PRE10]'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'All other objects – except for functions – are stringified as object literals.
    If a property has an unsupported `undefined`-producing value, it is omitted:'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有其他对象（除了函数）都会被序列化为对象字面量。如果属性有产生 `undefined` 的不支持的值，则该属性会被省略：
- en: '[PRE11]'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Functions are not stringified:'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 函数不会被序列化：
- en: '[PRE12]'
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '**Circular data:** `JSON.stringify()` throws an exception if data is circular:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '**循环数据**：如果数据是循环的，`JSON.stringify()` 会抛出异常：'
- en: '[PRE13]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '[48.3.2 `JSON.parse(text, reviver?)`](#JSON.parse)'
  id: totrans-84
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[48.3.2 `JSON.parse(text, reviver?)`](#JSON.parse)'
- en: This method converts a JSON `text` to a JavaScript value. In this section, we
    ignore the parameter `reviver`; it is explained in [“Customizing stringification
    and parsing (advanced)” (§48.4)](#json-replacers-revivers).
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 此方法将 JSON `text` 转换为 JavaScript 值。在本节中，我们忽略参数 `reviver`；它将在“自定义序列化和解析（高级）”中解释（§48.4）。
- en: 'Example:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 示例：
- en: '[PRE14]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '[48.3.3 Example: converting to and from JSON](#example-converting-to-and-from-json)'
  id: totrans-88
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[48.3.3 示例：转换为和从 JSON](#example-converting-to-and-from-json)'
- en: The following class implements conversions from (line A) and to (line B) JSON.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 以下类实现了从（行 A）到（行 B）JSON 的转换。
- en: '[PRE15]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Converting JSON to a point: We use the static method `Point.fromJson()` to
    parse JSON and create an instance of `Point`.'
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将 JSON 转换为点：我们使用静态方法 `Point.fromJson()` 解析 JSON 并创建 `Point` 实例。
- en: '[PRE16]'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Converting a point to JSON: `JSON.stringify()` internally calls [the previously
    mentioned method `.toJSON()`](#json-stringify-details).'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将点转换为 JSON：`JSON.stringify()` 内部调用之前提到的 `.toJSON()` 方法（#json-stringify-details）。
- en: '[PRE17]'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![Icon “exercise”](../Images/4fc2ec98bb44cc1f4de7c6a46d9dd043.png) **Exercise:
    Converting an object to and from JSON**'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '![图标“练习”](../Images/4fc2ec98bb44cc1f4de7c6a46d9dd043.png) **练习：将对象转换为 JSON
    并从 JSON 转换**'
- en: '`exercises/json/to_from_json_test.mjs`'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '`exercises/json/to_from_json_test.mjs`'
- en: '[48.4 Customizing stringification and parsing (advanced)](#json-replacers-revivers)'
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[48.4 自定义字符串化和解析（高级）](#json-replacers-revivers)'
- en: 'Stringification and parsing can be customized as follows:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 字符串化和解析可以按以下方式自定义：
- en: '`JSON.stringify(data, replacer?, space?)`'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`JSON.stringify(data, replacer?, space?)`'
- en: 'The optional parameter `replacer` contains either:'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 可选参数 `replacer` 包含以下内容之一：
- en: An Array with names of properties. If a value in `data` is stringified as an
    object literal, then only the mentioned properties are considered. All other properties
    are ignored.
  id: totrans-101
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个包含属性名称的数组。如果 `data` 中的值被转换为对象字面量，则仅考虑提到的属性。所有其他属性都将被忽略。
- en: A *value visitor*, a function that can transform JavaScript data before it is
    stringified.
  id: totrans-102
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 *值访问者*，一个可以在数据被转换为字符串之前对其进行转换的函数。
- en: '`JSON.parse(text, reviver?)`'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`JSON.parse(text, reviver?)`'
- en: The optional parameter `reviver` contains a value visitor that can transform
    the parsed JSON data before it is returned.
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 可选参数 `reviver` 包含一个值访问者，可以在返回之前转换解析后的 JSON 数据。
- en: '[48.4.1 `.stringfy()`: specifying which properties of objects to stringify](#stringfy-specifying-which-properties-of-objects-to-stringify)'
  id: totrans-105
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[48.4.1 `.stringfy()`：指定要转换为字符串的对象属性](#stringfy-specifying-which-properties-of-objects-to-stringify)'
- en: 'If the second parameter of `.stringify()` is an Array, then only object properties,
    whose names are mentioned there, are included in the result:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 `.stringify()` 的第二个参数是一个数组，那么只有名称在该数组中提到的对象属性会被包含在结果中：
- en: '[PRE18]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[48.4.2 `.stringify()` and `.parse()`: value visitors](#json-value-visitors)'
  id: totrans-108
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[48.4.2 `.stringify()` 和 `.parse()`：值访问者](#json-value-visitors)'
- en: 'What I call a *value visitor* is a function that transforms JavaScript data:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 我所说的 *值访问者* 是一个转换 JavaScript 数据的函数：
- en: '`JSON.stringify()` lets the value visitor in its parameter `replacer` transform
    JavaScript data before it is stringified.'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`JSON.stringify()` 允许其参数 `replacer` 中的值访问者在数据被转换为字符串之前对其进行转换。'
- en: '`JSON.parse()` lets the value visitor in its parameter `reviver` transform
    parsed JavaScript data before it is returned.'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`JSON.parse()` 允许其参数 `reviver` 中的值访问者在返回之前转换解析后的 JavaScript 数据。'
- en: In this section, JavaScript data is considered to be a tree of values. If the
    data is atomic, it is a tree that only has a root. All values in the tree are
    fed to the value visitor, one at a time. Depending on what the visitor returns,
    the current value is omitted, changed, or preserved.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，JavaScript 数据被视为值的树。如果数据是原子的，它只有一个根的树。树中的所有值都依次传递给值访问者。根据访问者返回的内容，当前值将被省略、更改或保留。
- en: 'A value visitor has the following type signature:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 一个值访问者有以下类型签名：
- en: '[PRE19]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The parameters are:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 参数包括：
- en: '`value`: The current value.'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`value`: 当前值。'
- en: '`this`: Parent of current value. The parent of the root value `r` is `{'''':
    r}`.'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`this`: 当前值的父级。根值 `r` 的父级是 `{'''': r}`。'
- en: 'Note: `this` is an implicit parameter and only available if the value visitor
    is an ordinary function.'
  id: totrans-118
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 注意：`this` 是一个隐式参数，仅在值访问者是一个普通函数时才可用。
- en: '`key`: Key or index of the current value inside its parent. The key of the
    root value is `''''`.'
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`key`: 当前值在其父级中的键或索引。根值的键是 `''''`。'
- en: 'The value visitor can return:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 值访问者可以返回：
- en: '`value`: means there won’t be any change.'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`value`: 表示不会有任何变化。'
- en: 'A different value `x`: leads to `value` being replaced with `x` in the output
    tree.'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个不同的值 `x`：导致输出树中的 `value` 被替换为 `x`。
- en: '`undefined`: leads to `value` being omitted in the output tree.'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`undefined`: 导致输出树中省略 `value`。'
- en: '[48.4.3 Example: visiting values](#example-visiting-values)'
  id: totrans-124
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[48.4.3 示例：访问值](#example-visiting-values)'
- en: 'The following code shows in which order a value visitor sees values:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码显示了值访问者看到值的顺序：
- en: '[PRE20]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: As we can see, the replacer of `JSON.stringify()` visits values top-down (root
    first, leaves last). The rationale for going in that direction is that we are
    converting JavaScript values to JSON values. And a single JavaScript object may
    be expanded into a tree of JSON-compatible values.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，`JSON.stringify()` 的替换器是自顶向下访问值（先根后叶）。这样做的原因是我们正在将 JavaScript 值转换为 JSON
    值。一个单一的 JavaScript 对象可能扩展为一个 JSON 兼容值的树。
- en: In contrast, the reviver of `JSON.parse()` visits values bottom-up (leaves first,
    root last). The rationale for going in that direction is that we are assembling
    JSON values into JavaScript values. Therefore, we need to convert the parts before
    we can convert the whole.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 与之相反，`JSON.parse()` 的恢复者是从下往上访问值的（先访问叶子节点，后访问根节点）。选择这种方向的逻辑是我们正在将 JSON 值组装成
    JavaScript 值。因此，我们需要在转换整体之前先转换部分。
- en: '[48.4.4 Example: stringifying unsupported values](#example-stringifying-unsupported-values)'
  id: totrans-129
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[48.4.4 示例：将不支持的数据类型转换为字符串](#example-stringifying-unsupported-values)'
- en: '`JSON.stringify()` has no special support for regular expression objects –
    it stringifies them as if they were plain objects:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '`JSON.stringify()` 对正则表达式对象没有特殊支持——它将它们当作普通对象来序列化：'
- en: '[PRE21]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'We can fix that via a replacer:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过一个替换者来修复这个问题：
- en: '[PRE22]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '[48.4.5 Example: parsing unsupported values](#example-parsing-unsupported-values)'
  id: totrans-134
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[48.4.5 示例：解析不支持的数据类型](#example-parsing-unsupported-values)'
- en: 'To `JSON.parse()` the result from the previous section, we need a reviver:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 要 `JSON.parse()` 上一个节点的结果，我们需要一个恢复者：
- en: '[PRE23]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '[48.5 FAQ](#faq)'
  id: totrans-137
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[48.5 常见问题解答](#faq)'
- en: '[48.5.1 Why doesn’t JSON support comments?](#why-doesnt-json-support-comments)'
  id: totrans-138
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[48.5.1 为什么 JSON 不支持注释？](#why-doesnt-json-support-comments)'
- en: 'Douglas Crockford explains why in [a Google+ post from 1 May 2012](https://web.archive.org/web/20190308024153/https://plus.google.com/+DouglasCrockfordEsq/posts/RK8qyGVaGSr):'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: Douglas Crockford 在 [2012 年 5 月 1 日的一篇 Google+ 帖子](https://web.archive.org/web/20190308024153/https://plus.google.com/+DouglasCrockfordEsq/posts/RK8qyGVaGSr)中解释了原因：
- en: I removed comments from JSON because I saw people were using them to hold parsing
    directives, a practice which would have destroyed interoperability. I know that
    the lack of comments makes some people sad, but it shouldn't.
  id: totrans-140
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我从 JSON 中移除了注释，因为我看到人们正在使用它们来保存解析指令，这种做法会破坏互操作性。我知道缺少注释会让一些人感到难过，但这不应该。
- en: ''
  id: totrans-141
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Suppose you are using JSON to keep configuration files, which you would like
    to annotate. Go ahead and insert all the comments you like. Then pipe it through
    JSMin [a minifier for JavaScript] before handing it to your JSON parser.
  id: totrans-142
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 假设你正在使用 JSON 来保存配置文件，你希望对其进行注释。你可以插入所有喜欢的注释。然后通过 JSMin [一个 JavaScript 压缩器] 处理它，然后再将其交给你的
    JSON 解析器。
